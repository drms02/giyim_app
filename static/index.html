<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#8c8bfb">
    <title>Bugün Ne Giysem</title>
    <link rel="manifest" href="/manifest.json">

<link rel="apple-touch-icon" href="/static/logo.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Bugün Ne Giysem">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
:root {
    --primary-color: #6c5ce7; 
    --text-dark: #2d3436;
    --text-light: #636e72;
    --border-color: rgba(255, 255, 255, 0.4); /* Yarı saydam beyaz çerçeve */
    --card-bg: rgba(255, 255, 255, 0.65); 
    
    --radius-xl: 24px;
    --radius-md: 16px;
    --shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15); /* Daha yumuşak, derin gölge */
}

[data-theme="dark"] {
    --bg-color: #0f0c29; 
    --card-bg: rgba(30, 30, 60, 0.7); /* Koyu buzlu cam */
    --primary-color: #a2a1ff;
    --text-dark: #dfe6e9;
    --text-light: #b2bec3;
    --border-color: rgba(255, 255, 255, 0.1);
    --shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
}

* { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Poppins', sans-serif; -webkit-tap-highlight-color: transparent; }

body {
    background: linear-gradient(-45deg, #a18cd1, #fbc2eb, #8fd3f4, #84fab0);
    background-size: 400% 400%;
    animation: gradientBG 15s ease infinite; /* Renkler yavaşça akar */
    
    color: var(--text-dark);
    padding-bottom: 90px;
    min-height: 100vh;
    transition: color 0.3s;
}

[data-theme="dark"] body {
    background: linear-gradient(-45deg, #0f0c29, #302b63, #24243e);
    background-size: 400% 400%;
    animation: gradientBG 15s ease infinite;
}

@keyframes gradientBG {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

.clothing-card, .daily-hero, .feed-card, .profile-main-card, 
.modern-header-bar, .showcase-card, .accessory-premium-card, 
.category-card, .setting-item, .wardrobe-item {
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border: 1px solid var(--border-color) !important;
}

/* --- MAKYAJ 5: MODERN YÜZEN NAVBAR --- */

.bottom-navbar {
    /* Eski stillerin üzerine yazıyoruz */
    bottom: 20px !important; /* Alttan boşluk */
    left: 20px !important;
    right: 20px !important;
    border-radius: 25px !important; /* Yuvarlak kenarlar */
    
    background: rgba(255, 255, 255, 0.85) !important; /* Yarı saydam */
    backdrop-filter: blur(15px) !important; /* Buzlu cam efekti */
    -webkit-backdrop-filter: blur(15px) !important;
    
    border: 1px solid rgba(255, 255, 255, 0.5) !important;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1) !important; /* Derin gölge */
    padding: 0 15px !important;
}

[data-theme="dark"] .bottom-navbar {
    background: rgba(30, 30, 40, 0.85) !important;
    border: 1px solid rgba(255, 255, 255, 0.1) !important;
}
        .page { display: none; padding-top: 20px; animation: fadeIn 0.3s; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        #custom-toast {
            visibility: hidden; min-width: 250px; background-color: rgba(30, 30, 30, 0.95);
            color: #fff; text-align: center; border-radius: 50px; padding: 14px 24px;
            position: fixed; z-index: 10001; left: 50%; bottom: 100px; transform: translateX(-50%);
            font-size: 14px; font-weight: 500; box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            opacity: 0; transition: opacity 0.3s, bottom 0.3s; backdrop-filter: blur(5px);
        }
        #custom-toast.show { visibility: visible; opacity: 1; bottom: 110px; }

        #page-intro { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: linear-gradient(135deg, #ffffff 0%, #f4f6ff 100%); z-index: 9999; display: none; flex-direction: column; justify-content: center; align-items: center; padding: 40px; text-align: center; }
        .intro-logo { width: 140px; height: 140px; margin-bottom: 30px; border-radius: 35px; box-shadow: 0 20px 40px rgba(140, 139, 251, 0.25); animation: float 6s ease-in-out infinite; }
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-15px); } 100% { transform: translateY(0px); } }
        .intro-title { font-size: 26px; font-weight: 700; margin-bottom: 10px; color: #2d2d2d; }
        .intro-text { font-size: 15px; color: #888; margin-bottom: 40px; line-height: 1.5; max-width: 280px; }
        .name-input { width: 100%; max-width: 280px; padding: 18px; background: white; border: none; border-radius: 20px; font-size: 16px; margin-bottom: 15px; outline: none; text-align: center; box-shadow: 0 5px 20px rgba(0,0,0,0.05); color: #2d2d2d; }
        .intro-btn { width: 200px; padding: 18px; background: linear-gradient(90deg, #8c8bfb 0%, #a2a1ff 100%); color: white; border: none; border-radius: 50px; font-size: 16px; font-weight: 600; box-shadow: 0 10px 25px rgba(140, 139, 251, 0.4); cursor: pointer; transition: transform 0.2s; margin-top: 10px;}
        .intro-btn:active { transform: scale(0.95); }

        .header { padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; position: relative; }
        .header-left { display: flex; flex-direction: column; }
        .app-title { font-size: 22px; font-weight: 700; color: var(--primary-color); margin: 0; line-height: 1.2; }
        .current-date { 
    font-size: 14px;       /* 12px'den 20px'e çıkardık (Bayağı büyüdü) */
    font-weight: 700;      /* Yazıyı kalınlaştırdık */
    color: var(--text-dark); /* Gri yerine siyah yaptık */
    margin-top: 5px; 
    margin-bottom: 10px;   /* Altına biraz boşluk bıraktık */
    letter-spacing: 0.5px; /* Harf aralığını hafif açtık, daha modern durur */
}
        
        .mini-weather-btn { 
            background: var(--card-bg); border: 1px solid var(--border-color); padding: 8px 14px; 
            border-radius: 20px; font-size: 13px; font-weight: 600; color: var(--text-dark);
            display: flex; align-items: center; gap: 6px; box-shadow: var(--shadow); 
            cursor: pointer; transition: transform 0.2s;
        }
        .mini-weather-btn:active { transform: scale(0.95); }
        .mini-weather-btn i { font-size: 16px; color: var(--primary-color); }

        .daily-hero { margin: 0 20px 20px 20px; background: var(--card-bg); border-radius: 20px; padding: 15px; display: flex; align-items: center; gap: 15px; box-shadow: var(--shadow); position: relative; overflow: hidden; border: 1px solid var(--border-color); cursor: pointer; }
        .daily-hero::before { content: ''; position: absolute; top: 0; left: 0; width: 5px; height: 100%; background: var(--primary-color); }
        .hero-img-box { width: 70px; height: 70px; background: var(--bg-color); border-radius: 15px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .hero-img { width: 90%; height: 90%; object-fit: contain; }
        .hero-content { flex: 1; }
        .hero-title { font-size: 14px; font-weight: 700; color: var(--text-dark); margin-bottom: 4px; }
        .hero-desc { font-size: 11px; color: var(--text-light); line-height: 1.4; }
        .hero-refresh { position: absolute; top: 10px; right: 10px; font-size: 18px; color: var(--text-light); cursor: pointer; }

        .filter-row { display: flex; gap: 10px; padding: 0 20px 20px 20px; }
        .filter-select-btn { flex: 1; padding: 15px; background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 16px; font-size: 13px; color: var(--text-dark); display: flex; justify-content: space-between; align-items: center; cursor: pointer; box-shadow: var(--shadow); transition: 0.2s; }
        .filter-select-btn span { font-weight: 600; }
        .filter-select-btn i { color: var(--primary-color); font-size: 18px; }

        .action-area { display: flex; flex-direction: column; gap: 10px; padding: 0 20px 20px 20px; }
        .action-row-top { display: flex; gap: 10px; width: 100%; align-items: center;}
        .magic-btn { flex: 1; height: 50px; background: linear-gradient(135deg, #8c8bfb 0%, #a2a1ff 100%); color: white; border: none; border-radius: var(--radius-md); font-size: 14px; font-weight: 600; box-shadow: 0 10px 20px rgba(140, 139, 251, 0.3); display: flex; align-items: center; justify-content: center; gap: 5px; cursor: pointer; transition: 0.2s; white-space: nowrap; }
        .magic-btn:active { transform: scale(0.98); }
        
/* --- BUNU GİYECEĞİM BUTONU (PREMIUM TASARIM) --- */

/* --- BUNU GİYECEĞİM BUTONU (PREMIUM TASARIM) --- */

#btn-wear-container {
    display: none; /* Başlangıçta gizli */
    width: 100%;
    padding: 15px 0 30px 0; /* Alttan biraz boşluk bırakalım */
    justify-content: center;
    align-items: center;
    z-index: 900;
}

#btn-wear-container.show {
    display: flex;
    animation: slideUpFade 0.6s cubic-bezier(0.16, 1, 0.3, 1); /* Yaylanarak yukarı çıkma */
}

.magic-btn.wear {
    position: relative; /* Efektler için gerekli */
    width: 90%; /* SAĞ VE SOLDAN BOŞLUK İÇİN %90 */
    max-width: 380px; /* Çok geniş ekranlarda devasa olmasın */
    height: 60px; /* Daha dolgun, premium yükseklik */
    
    /* Premium Yeşil Gradyan */
    background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);
    
    color: white;
    border: none;
    border-radius: 20px; /* Modern yumuşak köşeler (Tam yuvarlak değil, 'Squircle' tarzı) */
    
    font-size: 17px;
    font-weight: 700;
    letter-spacing: 0.5px;
    text-transform: uppercase; /* Harfleri büyük yap */
    
    box-shadow: 0 10px 30px rgba(0, 184, 148, 0.4), 
                inset 0 1px 0 rgba(255, 255, 255, 0.3); /* Üstte ince camsı çizgi */
    
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    
    cursor: pointer;
    overflow: hidden; /* Işık efekti dışarı taşmasın */
    transition: all 0.3s ease;
}

.magic-btn.wear i {
    font-size: 22px;
}

.magic-btn.wear:active {
    transform: scale(0.96);
    box-shadow: 0 5px 15px rgba(0, 184, 148, 0.5);
}

/* --- PARLAMA EFEKTİ (SHINE ANIMATION) --- */
.magic-btn.wear::after {
    content: '';
    position: absolute;
    top: 0;
    left: -150%;
    width: 100%;
    height: 100%;
    
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
    transform: skewX(-20deg);
    
    animation: premiumShine 3s infinite;
}

@keyframes premiumShine {
    0% { left: -150%; }
    20% { left: 150%; } /* Hızlıca geç */
    100% { left: 150%; } /* Bekle */
}

@keyframes slideUpFade {
    0% { opacity: 0; transform: translateY(40px); }
    100% { opacity: 1; transform: translateY(0); }
}
        .icon-btn { flex: 0 0 50px; height: 50px; background: var(--card-bg); border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center; font-size: 24px; color: var(--text-light); cursor: pointer; box-shadow: var(--shadow); transition: 0.3s; border: 1px solid var(--border-color); }
        
        .outfit-wrapper { padding: 0 20px 20px 20px; background: var(--bg-color); transition: background 0.3s; }
        .outfit-container { display: flex; flex-direction: column; gap: 15px; }
        
        .clothing-card { 
            background: var(--card-bg); 
            border-radius: var(--radius-xl); 
            height: 160px; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            box-shadow: var(--shadow); 
            position: relative; 
            transition: transform 0.3s; 
            border: 1px solid var(--border-color); 
        }

        .clothing-img { width: 90%; height: 90%; object-fit: contain; filter: drop-shadow(0 5px 5px rgba(0,0,0,0.1)); display: none; z-index: 2; position: relative; }
        .placeholder-state { text-align: center; color: var(--text-light); font-size: 12px;}
        .placeholder-state i { font-size: 30px; margin-bottom: 5px; }
        .ai-msg { display: none !important; }
        .wear-count-badge { position: absolute; top: 8px; left: 8px; background: rgba(0, 0, 0, 0.6); color: #fff; font-size: 10px; font-weight: bold; padding: 2px 6px; border-radius: 8px; display: flex; align-items: center; gap: 3px; backdrop-filter: blur(2px); z-index: 2; }
        .wear-count-badge i { font-size: 10px; color: #fab1a0; }

        .category-container { padding: 0 20px; display: flex; flex-direction: column; gap: 15px; }
        .category-card { background: var(--card-bg); border-radius: 20px; padding: 20px; display: flex; align-items: center; justify-content: space-between; box-shadow: var(--shadow); border: 1px solid var(--border-color); cursor: pointer; transition: transform 0.2s; height: 100px; }
        .cat-info { display: flex; flex-direction: column; gap: 5px; }
        .cat-name { font-size: 18px; font-weight: 600; color: var(--text-dark); }
        .cat-count { font-size: 12px; color: var(--text-light); }
        .cat-icon { width: 50px; height: 50px; background: #eef0ff; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 28px; color: var(--primary-color); }

        #wardrobe-detail-view { display: none; padding: 0 0 20px 0; }
        .detail-header { padding: 10px 20px; display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
        .back-btn { font-size: 24px; cursor: pointer; color: var(--text-dark); }
        .detail-title { font-size: 18px; font-weight: 600; color: var(--text-dark); }
        .wardrobe-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 12px; padding: 0 20px 20px 20px; }
        .wardrobe-item { background: var(--card-bg); border-radius: 16px; aspect-ratio: 1 / 1; padding: 10px; position: relative; box-shadow: var(--shadow); display: flex; align-items: center; justify-content: center; border: 1px solid var(--border-color); cursor: pointer; }
        .wardrobe-item img { width: 100%; height: 100%; object-fit: contain; }
        
        .fab-add { position: fixed; bottom: 100px; right: 20px; width: 55px; height: 55px; background: var(--primary-color); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 30px; box-shadow: 0 5px 15px rgba(140, 139, 251, 0.4); z-index: 800; cursor: pointer; }
        .fav-btn-row { padding: 0 20px 15px 20px; }
        .fav-btn { width: 100%; padding: 15px; background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 99%); border: none; border-radius: 16px; color: white; font-weight: 600; font-size: 14px; display: flex; align-items: center; justify-content: center; gap: 8px; cursor: pointer; box-shadow: 0 5px 15px rgba(255, 154, 158, 0.4); transition: transform 0.2s; }

        .profile-header { text-align: center; padding: 20px; }
        .profile-pic-container { position: relative; width: 100px; height: 100px; margin: 0 auto 15px auto; }
        .profile-pic { width: 100%; height: 100%; border-radius: 50%; overflow: hidden; background: #eef0ff; display: flex; align-items: center; justify-content: center; box-shadow: var(--shadow); border: 2px solid var(--primary-color); }
        .profile-pic img { width: 100%; height: 100%; object-fit: cover; }
        .profile-pic i { font-size: 50px; color: var(--primary-color); }
        .profile-fullname-large { font-size: 20px; font-weight: 700; color: var(--text-dark); margin-bottom: 2px; }
        .profile-username-large { font-size: 14px; color: var(--text-light); font-weight: 500; margin-bottom: 15px; }
        .profile-edit-btn { padding: 8px 20px; border: 1px solid var(--border-color); background: var(--card-bg); color: var(--text-dark); border-radius: 20px; font-size: 13px; font-weight: 600; cursor: pointer; transition: 0.2s; display: inline-block; margin-bottom: 20px; }
        .follow-action-btn { width: 100%; padding: 10px; background: var(--primary-color); color:white; border:none; border-radius:15px; font-weight:600; margin-bottom:20px; display:none; }
        .follow-action-btn.following { background: #eef0ff; color: var(--text-dark); border: 1px solid var(--border-color); }
        .stats-row { display: flex; justify-content: center; gap: 30px; margin-bottom: 30px; margin-top: 10px; }
        .stat-item { text-align: center; cursor: pointer; }
        .stat-val { font-size: 18px; font-weight: bold; color: var(--text-dark); }
        .stat-label { font-size: 12px; color: var(--text-light); }

        .posts-title { text-align: left; padding: 0 20px; font-size: 14px; font-weight: 600; color: var(--text-dark); margin-bottom: 10px; border-top: 1px solid var(--border-color); padding-top: 20px; }
        .user-posts-grid { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); /* 3 Sütunlu Instagram tarzı */
            gap: 3px; /* Çok ince boşluk */
            padding: 0 2px 80px 2px; /* Kenarlardan taşmasın */
        }
        
        .user-post-item { 
            aspect-ratio: 3/4; /* Dikdörtgen form (Kıyafetler uzun olduğu için) */
            background: #fff; 
            border-radius: 4px; /* Hafif köşe */
            overflow: hidden; 
            position: relative; 
            cursor: pointer;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .user-post-split { 
            width: 100%; height: 100%; 
            display: flex; flex-direction: column; 
            background: radial-gradient(circle, #ffffff 50%, #f1f2f6 100%);
        }
        
        .user-post-split img { 
            width: 100%; height: 50%; 
            object-fit: contain; 
            padding: 8px; 
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.05)); /* Kıyafet gölgesi */
            transition: transform 0.3s;
        }

        .user-post-item:active img { transform: scale(0.95); }

        .post-overlay-badge {
            position: absolute; bottom: 5px; left: 5px;
            background: rgba(0, 0, 0, 0.4); color: white;
            font-size: 10px; font-weight: bold;
            padding: 2px 6px; border-radius: 10px;
            display: flex; align-items: center; gap: 3px;
            backdrop-filter: blur(2px);
        }

        .charts-wrapper { display: flex; gap: 10px; padding: 0 20px 20px 20px; overflow-x: auto; scrollbar-width: none; }
        .chart-box { background: var(--card-bg); border-radius: 16px; border: 1px solid var(--border-color); padding: 10px; min-width: 160px; height: 180px; flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; box-shadow: var(--shadow); }
        .chart-title { font-size: 12px; font-weight: 600; margin-bottom: 10px; color: var(--text-dark); text-align: center; }
        .chart-box canvas { max-width: 100%; max-height: 130px; }
        
        .section-title { padding: 0 20px; font-size: 16px; font-weight: 600; margin-bottom: 15px; color: var(--text-dark); }
        .settings-list { padding: 0 20px; margin-bottom: 20px; }
        .setting-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; background: var(--card-bg); border-radius: 12px; margin-bottom: 10px; border: 1px solid var(--border-color); cursor: pointer; }
        .setting-left { display: flex; align-items: center; gap: 10px; color: var(--text-dark); font-size: 14px; }
        .setting-left i { font-size: 20px; color: var(--primary-color); }
        .switch { position: relative; display: inline-block; width: 40px; height: 20px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 2px; bottom: 2px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--primary-color); }
        input:checked + .slider:before { transform: translateX(20px); }

        .search-bar-container { padding: 0 20px 20px 20px; display: flex; gap: 10px; }
        .search-input { flex: 1; padding: 12px; border: 1px solid var(--border-color); border-radius: 15px; font-size: 14px; outline: none; background: var(--card-bg); color: var(--text-dark); transition: 0.2s; }
        .search-input:focus { border-color: var(--primary-color); box-shadow: 0 0 0 2px rgba(140, 139, 251, 0.2); }
        .search-btn { width: 45px; height: 45px; background: var(--primary-color); color: white; border: none; border-radius: 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .search-results-list { padding: 0 20px; margin-bottom: 20px; display: none; flex-direction: column; gap: 10px; }
        .user-result-item { background: var(--card-bg); padding: 10px; border-radius: 12px; display: flex; align-items: center; gap: 10px; cursor: pointer; border: 1px solid var(--border-color); }
        .user-result-avatar { width: 35px; height: 35px; background: #eef0ff; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--primary-color); overflow: hidden; }
        .user-result-avatar img { width: 100%; height: 100%; object-fit: cover; }
        
        .feed-header-info { display: flex; justify-content: space-between; align-items: center; padding: 0 20px 10px 20px; display: none; }
        .clear-search-btn { font-size: 12px; color: var(--primary-color); cursor: pointer; font-weight: 600; }
        .feed-card { background: var(--card-bg); border-radius: 20px; padding: 15px; margin-bottom: 20px; box-shadow: var(--shadow); border: 1px solid var(--border-color); }
        .feed-header { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; font-size: 14px; font-weight: 600; color: var(--text-dark); }
        .feed-avatar { width: 32px; height: 32px; background: #eef0ff; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--primary-color); overflow: hidden; }
        .feed-avatar img { width: 100%; height: 100%; object-fit: cover; }
        .feed-imgs { display: flex; justify-content: center; gap: 5px; background: var(--bg-color); border-radius: 15px; padding: 10px; margin-bottom: 10px; }
        .feed-img-box { width: 80px; height: 80px; display: flex; align-items: center; justify-content: center; }
        .feed-img-box img { max-width: 100%; max-height: 100%; object-fit: contain; filter: drop-shadow(0 3px 5px rgba(0,0,0,0.1)); }
        .feed-actions { display: flex; align-items: center; justify-content: space-between; }
        .like-btn-wrapper { display: flex; align-items: center; gap: 5px; color: var(--text-light); font-size: 13px; font-weight: 600; cursor: pointer; transition: 0.2s; }
        .like-btn-wrapper.liked { color: #ff4d4d; }
        .like-btn-wrapper i { font-size: 22px; }

        .notif-list { display: flex; flex-direction: column; gap: 10px; padding: 20px; }
        .notif-item { background: var(--card-bg); padding: 15px; border-radius: 15px; display: flex; align-items: center; gap: 15px; box-shadow: var(--shadow); border: 1px solid var(--border-color); transition: 0.2s; }
        .notif-item.unread { border-left: 4px solid var(--primary-color); background: #f8f9ff; }
        .notif-icon { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; flex-shrink: 0; }
        .notif-icon.like { background: #ffebeb; color: #ff4d4d; }
        .notif-icon.follow { background: #eef0ff; color: var(--primary-color); }
        .notif-content { font-size: 13px; color: var(--text-dark); line-height: 1.4; }
        .notif-time { font-size: 10px; color: var(--text-light); margin-top: 2px; }


.bottom-navbar {
    position: fixed; 
    bottom: 15px; /* Çok yukarıda olmasın */
    left: 15px; 
    right: 15px; 
    height: 70px; /* İdeal yükseklik */
    
    background: #ffffff; 
    border-radius: 20px; 
    
    display: flex; 
    justify-content: space-around; 
    align-items: center; 
    z-index: 900; 
    padding: 0 10px;
    
    box-shadow: 0 5px 25px rgba(0,0,0,0.08); 
    border: 1px solid rgba(0,0,0,0.05);
}

.nav-item {
    display: flex; 
    flex-direction: column; 
    align-items: center; 
    justify-content: center;
    text-decoration: none; 
    
    color: #999; /* Pasif renk (Gri) */
    font-size: 10px; 
    font-weight: 500;
    
    width: 60px; /* Genişlik sabit */
    height: 55px; /* Yükseklik sabit */
    border-radius: 14px; /* Köşeleri yuvarla */
    transition: all 0.25s ease; /* Yumuşak geçiş */
}

.nav-item i {
    font-size: 22px; 
    margin-bottom: 3px;
    transition: 0.25s;
}

.nav-item.active-nav {
    background: linear-gradient(135deg, #8c8bfb 0%, #a2a1ff 100%);
    
    color: #ffffff; /* İkon ve yazı beyaz olsun */
    
    box-shadow: 0 8px 15px rgba(140, 139, 251, 0.35); 
    transform: translateY(-2px); 
}

.nav-item.active-nav i {
    transform: scale(1.1);
}


[data-theme="dark"] .bottom-navbar {
    background: #1b1e2b; /* Koyu kart rengi */
    border-color: rgba(255,255,255,0.05);
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
}
[data-theme="dark"] .nav-item { color: #555; } /* Pasif ikonlar daha koyu gri */
[data-theme="dark"] .nav-item.active-nav {
    background: linear-gradient(135deg, #6c5ce7 0%, #a29bfe 100%);
    color: #fff;
    box-shadow: 0 5px 20px rgba(108, 92, 231, 0.4);
}
        
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: none; justify-content: center; align-items: center; z-index: 2000; backdrop-filter: blur(3px); }
        .modal-card { background: var(--card-bg); width: 85%; padding: 25px; border-radius: 20px; text-align: center; position: relative; max-height: 80vh; overflow-y: auto; color: var(--text-dark); }
        .city-select { width: 100%; padding: 12px; border-radius: 12px; border: 1px solid var(--border-color); margin-bottom: 15px; font-size: 14px; background: var(--bg-color); color: var(--text-dark); }
        .option-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .option-btn { padding: 10px; border: 1px solid var(--border-color); border-radius: 10px; font-size: 13px; cursor: pointer; background: var(--card-bg); color: var(--text-light); transition: 0.2s; }
        .option-btn.sel { background: #eef0ff; border-color: var(--primary-color); color: var(--primary-color); font-weight: 600; }
        [data-theme="dark"] .option-btn.sel { background: #2a2a40; color: #a2a1ff; }
        
        .follow-user-item { display: flex; align-items: center; gap: 10px; padding: 10px; border-bottom: 1px solid var(--border-color); cursor: pointer; }
        .follow-user-avatar { width: 40px; height: 40px; border-radius: 50%; overflow: hidden; background: #eef0ff; display: flex; align-items: center; justify-content: center; }
        .follow-user-avatar img { width: 100%; height: 100%; object-fit: cover; }
        .profile-container { padding: 20px; text-align: center; display: flex; flex-direction: column; align-items: center; justify-content: center; }

        .duel-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            z-index: 2000; display: none; flex-direction: column;
            align-items: center; justify-content: center;
        }
        .duel-header { position: absolute; top: 20px; width: 100%; text-align: center; color: white; font-size: 24px; font-weight: bold; z-index: 2; }
        .duel-close { position: absolute; top: 20px; right: 20px; color: rgba(255,255,255,0.8); font-size: 35px; cursor: pointer; z-index: 2005; transition: transform 0.2s; }
        .duel-close:active { transform: scale(0.8); }

        .duel-arena {
            display: flex; align-items: center; justify-content: center;
            width: 100%; height: 60vh; position: relative; gap: 10px; padding: 10px;
            transition: opacity 0.4s ease, transform 0.4s ease;
            opacity: 1; transform: scale(1);
        }
        .duel-arena.fade-out { opacity: 0; transform: scale(0.95); }

        .duel-card {
            flex: 1; height: 100%; background: white; border-radius: 20px; 
            overflow: hidden; position: relative; cursor: pointer; transition: transform 0.2s;
            display: flex; flex-direction: column; border: 4px solid transparent;
        }
        .duel-card:active { transform: scale(0.95); }
        .duel-card.winner-anim { border-color: #00b894; transform: scale(1.05); }

        .duel-img-split { height: 85%; width: 100%; display: flex; flex-direction: column; }
        .duel-img-split img { width: 100%; height: 50%; object-fit: contain; padding: 10px; }
        .duel-user-info { height: 15%; background: #f8f9fc; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 600; color: #333; }
        
        .vs-badge {
            position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%);
            width: 60px; height: 60px; background: #ff4757; color: white; font-weight: 900; 
            font-size: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center;
            border: 4px solid #1a1a2e; z-index: 10; box-shadow: 0 0 20px rgba(255, 71, 87, 0.6);
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse { 0% { transform: translate(-50%, -50%) scale(1); } 50% { transform: translate(-50%, -50%) scale(1.1); } 100% { transform: translate(-50%, -50%) scale(1); } }

        .leaderboard-list { display: flex; flex-direction: column; gap: 15px; margin-top: 15px; }
        .leader-item { display: flex; align-items: center; gap: 15px; background: white; padding: 10px; border-radius: 16px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); border: 1px solid #eee; position: relative; }
        .rank-badge { width: 30px; height: 30px; border-radius: 50%; background: #eee; color: #555; font-weight: bold; display: flex; align-items: center; justify-content: center; font-size: 14px; flex-shrink: 0; }
        .leader-item:nth-child(1) { border: 2px solid #ffd700; background: linear-gradient(to right, #fff, #fffbf0); }
        .leader-item:nth-child(1) .rank-badge { background: #ffd700; color: white; box-shadow: 0 0 10px #ffd700; }
        .leader-item:nth-child(2) { border: 2px solid #c0c0c0; }
        .leader-item:nth-child(2) .rank-badge { background: #c0c0c0; color: white; }
        .leader-item:nth-child(3) { border: 2px solid #cd7f32; }
        .leader-item:nth-child(3) .rank-badge { background: #cd7f32; color: white; }
        .leader-avatar { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; border: 2px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .leader-score { margin-left: auto; font-weight: 800; color: var(--primary-color); display: flex; flex-direction: column; align-items: center; }
        .leader-score span { font-size: 10px; color: #888; font-weight: normal; }

        .comment-modal { position: fixed; bottom: 0; left: 0; width: 100%; height: 0; background: var(--card-bg); z-index: 2005; border-top-left-radius: 25px; border-top-right-radius: 25px; box-shadow: 0 -5px 20px rgba(0,0,0,0.2); transition: height 0.3s ease; display: flex; flex-direction: column; overflow: hidden; }
        .comment-modal.open { height: 70vh; }
        .comment-header { padding: 15px 20px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; font-weight: bold; font-size: 14px; color: var(--text-dark); }
        .comment-list { flex: 1; overflow-y: auto; padding: 15px 20px; display: flex; flex-direction: column; gap: 15px; }
        .comment-item { display: flex; gap: 10px; font-size: 13px; }
        .comment-avatar { width: 30px; height: 30px; border-radius: 50%; background: #eee; flex-shrink: 0; overflow: hidden; }
        .comment-avatar img { width: 100%; height: 100%; object-fit: cover; }
        .comment-bubble { background: var(--bg-color); padding: 8px 12px; border-radius: 0 12px 12px 12px; color: var(--text-dark); line-height: 1.4; }
        .comment-user { font-weight: 700; font-size: 12px; margin-bottom: 2px; color: var(--primary-color); }
        .comment-input-area { padding: 15px; border-top: 1px solid var(--border-color); display: flex; gap: 10px; background: var(--card-bg); padding-bottom: 30px; }
        .comment-input { flex: 1; padding: 10px; border-radius: 20px; border: 1px solid var(--border-color); outline: none; font-size: 14px; background: var(--bg-color); color: var(--text-dark); }
        .comment-send-btn { width: 40px; height: 40px; background: var(--primary-color); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: none; cursor: pointer; font-size: 18px; }
        .modal-backdrop { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2004; display: none; }

        .rank-tag { display: inline-block; padding: 2px 6px; border-radius: 4px; font-size: 9px; font-weight: bold; margin-left: 5px; vertical-align: middle; }
        .rank-caylak { background: #dfe6e9; color: #636e72; }
        .rank-stilist { background: #74b9ff; color: white; }
        .rank-trend { background: #fab1a0; color: white; }
        .rank-ikon { background: linear-gradient(45deg, #ffd700, #f1c40f); color: #2d3436; box-shadow: 0 2px 5px rgba(255, 215, 0, 0.3); }
        .xp-bar-container { width: 200px; height: 6px; background: #eee; border-radius: 10px; margin: 5px auto 15px auto; overflow: hidden; position: relative; }
        .xp-bar-fill { height: 100%; background: var(--primary-color); width: 0%; transition: width 1s; }
        .xp-text { font-size: 10px; color: #aaa; margin-top: -12px; margin-bottom: 15px; }
        #page-intro {
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%); /* Koyu Mor/Mavi Arka Plan */
            overflow: hidden;
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            display: none; flex-direction: column; justify-content: center; align-items: center;
            padding: 30px; text-align: center; color: white;
        }

        .neon-grid-bg {
            position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: transparent;
            background-image: 
                linear-gradient(rgba(140, 139, 251, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(140, 139, 251, 0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            transform: perspective(500px) rotateX(60deg);
            animation: gridMove 10s linear infinite;
            opacity: 0.3; z-index: 1;
        }
        @keyframes gridMove { 0% { transform: perspective(500px) rotateX(60deg) translateY(0); } 100% { transform: perspective(500px) rotateX(60deg) translateY(50px); } }

        .neon-title {
            font-size: 32px; font-weight: 800; color: #fff;
            text-shadow: 
                0 0 5px #fff,
                0 0 10px #fff,
                0 0 20px #8c8bfb,
                0 0 40px #8c8bfb;
            animation: titlePulse 2s infinite alternate;
        }
        @keyframes titlePulse { from { text-shadow: 0 0 10px #fff, 0 0 20px #8c8bfb; } to { text-shadow: 0 0 20px #fff, 0 0 40px #8c8bfb, 0 0 60px #8c8bfb; } }

        .neon-input-group { margin-bottom: 15px; }
        .neon-input-group label { display: block; font-size: 12px; color: #00f2c3; /* Cyan rengi label */ margin-bottom: 5px; margin-left: 10px; text-shadow: 0 0 5px rgba(0, 242, 195, 0.5); }

        .neon-input {
            width: 100%; padding: 15px;
            background: rgba(255, 255, 255, 0.05); /* Yarı saydam arka plan */
            border: 2px solid #00f2c3; /* Cyan neon çerçeve */
            border-radius: 20px;
            font-size: 14px; color: #fff; outline: none;
            box-shadow: 0 0 5px rgba(0, 242, 195, 0.3), inset 0 0 5px rgba(0, 242, 195, 0.1);
            transition: all 0.3s ease;
        }
        .neon-input:focus {
            background: rgba(0, 242, 195, 0.1);
            box-shadow: 0 0 20px rgba(0, 242, 195, 0.6), inset 0 0 10px rgba(0, 242, 195, 0.3);
            border-color: #fff;
        }
        select.neon-input { appearance: none; background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%27http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%27%20width%3D%27292.4%27%20height%3D%27292.4%27%3E%3Cpath%20fill%3D%27%2300f2c3%27%20d%3D%27M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%27%2F%3E%3C%2Fsvg%3E"); background-repeat: no-repeat; background-position: right 15px top 50%; background-size: 12px auto; }
        select.neon-input option { background-color: #24243e; color: white; }

        .neon-btn {
            width: 100%; max-width: 320px; padding: 18px; margin-top: 25px;
            background: transparent;
            border: 3px solid #ff00ff; /* Magenta neon çerçeve */
            border-radius: 50px;
            color: #ff00ff; font-size: 18px; font-weight: 800; letter-spacing: 2px;
            cursor: pointer; position: relative; overflow: hidden;
            text-shadow: 0 0 10px #ff00ff;
            box-shadow: 0 0 20px rgba(255, 0, 255, 0.4), inset 0 0 10px rgba(255, 0, 255, 0.2);
            transition: all 0.3s;
            animation: btnPulse 2s infinite;
        }
        .neon-btn:hover { background: rgba(255, 0, 255, 0.1); box-shadow: 0 0 40px rgba(255, 0, 255, 0.8), inset 0 0 20px rgba(255, 0, 255, 0.4); color: white; text-shadow: 0 0 20px #ff00ff; border-color: white; }
        .neon-btn:active { transform: scale(0.95); }
        @keyframes btnPulse { 0% { box-shadow: 0 0 20px rgba(255, 0, 255, 0.4); } 50% { box-shadow: 0 0 40px rgba(255, 0, 255, 0.7); } 100% { box-shadow: 0 0 20px rgba(255, 0, 255, 0.4); } }
    
        .event-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 10px; }
        .event-card { 
            background: #f8f9fa; border: 1px solid #eee; border-radius: 20px; padding: 20px; 
            text-align: center; cursor: pointer; transition: all 0.2s;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .event-card:active { transform: scale(0.95); background: #eef0ff; border-color: var(--primary-color); }
        .event-icon { font-size: 32px; margin-bottom: 8px; }
        .event-title { font-size: 14px; font-weight: 700; color: var(--text-dark); }

.mode-btn { flex: 1; padding: 10px; background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 12px; font-size: 13px; font-weight: 600; color: var(--text-light); cursor: pointer; transition: 0.2s; text-align: center; }
.mode-btn.active-mode { background: #eef0ff; color: var(--primary-color); border-color: var(--primary-color); box-shadow: 0 2px 5px rgba(140, 139, 251, 0.2); }
.clothing-card.tall-card { height: 335px; background: #fff0f5; border: 1px solid #ffc2d1; }
.clothing-card.tall-card .placeholder-state i { color: #ff8fa3; }
.mode-toggle-row { display: flex; gap: 10px; padding: 0 20px 15px 20px; }
.mode-btn { flex: 1; padding: 10px; background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 12px; font-size: 13px; font-weight: 600; color: var(--text-light); cursor: pointer; transition: 0.2s; text-align: center; }
.mode-btn.active-mode { background: #eef0ff; color: var(--primary-color); border-color: var(--primary-color); box-shadow: 0 2px 5px rgba(140, 139, 251, 0.2); }
.clothing-card.tall-card { height: 335px; background: #fff0f5; border: 1px solid #ffc2d1; }
.clothing-card.tall-card .placeholder-state i { color: #ff8fa3; }    

@keyframes electric-shake {
    0%, 100% { transform: scale(1) rotate(0deg); text-shadow: none; }
    10%, 30%, 50%, 70%, 90% { transform: scale(1.3) rotate(-3deg); text-shadow: 0 0 10px #fff, 0 0 20px #a2a1ff; }
    20%, 40%, 60%, 80% { transform: scale(1.3) rotate(3deg); text-shadow: 0 0 10px #fff, 0 0 20px #a2a1ff; }
}

@keyframes pulse-ring {
    0% {
        width: 0;
        height: 0;
        opacity: 0.8;
    }
    100% {
        width: 250%; /* Butondan çok daha büyük olsun ki dışa taşsın */
        height: 250%;
        opacity: 0;
    }
}

.magic-btn {
    position: relative !important;
    overflow: hidden !important;
}

.magic-btn.is-animating i {
    animation: electric-shake 0.5s ease-in-out;
    color: #ffffff !important; /* İkonu anlık olarak bembeyaz yap */
}

.magic-btn::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, rgba(162,161,255,0.2) 70%); /* Beyazdan mora hafif geçiş */
    border-radius: 50%;
    transform: translate(-50%, -50%);
    opacity: 0;
    pointer-events: none;
    z-index: 0; /* Yazının arkasında kalsın */
}

.magic-btn.is-animating::before {
    animation: pulse-ring 0.6s ease-out;
}

.magic-btn i, .magic-btn span {
    position: relative;
    z-index: 1;
}

.profile-cover {
    height: 140px;
    background: linear-gradient(135deg, #8c8bfb 0%, #a2a1ff 100%);
    position: relative;
    border-radius: 0 0 30px 30px; /* Alt köşeleri yuvarla */
    box-shadow: 0 10px 20px rgba(140, 139, 251, 0.3);
}

.profile-main-card {
    text-align: center;
    margin-top: -60px; /* Kapağın üzerine binsin */
    padding: 0 20px;
    position: relative;
    z-index: 2;
}

.modern-avatar-box {
    width: 110px; height: 110px;
    margin: 0 auto 10px auto;
    border-radius: 40px; /* Tam yuvarlak değil, "squircle" şekli */
    border: 5px solid var(--bg-color); /* Sayfa renginde kalın çerçeve */
    background: #fff;
    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    overflow: hidden;
    position: relative;
}
.modern-avatar-box img { width: 100%; height: 100%; object-fit: cover; }
.modern-avatar-box i { width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; font-size: 50px; color: #ccc; }

.modern-name { font-size: 22px; font-weight: 800; color: var(--text-dark); letter-spacing: -0.5px; }
.modern-handle { font-size: 14px; color: var(--text-light); margin-bottom: 5px; font-weight: 500; }

.rank-badge-pill {
    display: inline-flex; align-items: center; gap: 5px;
    background: #fff; border: 1px solid #eee;
    padding: 5px 12px; border-radius: 20px;
    font-size: 11px; font-weight: 700; color: var(--text-dark);
    box-shadow: 0 3px 10px rgba(0,0,0,0.03);
    margin-bottom: 15px;
}
.rank-badge-pill i { color: #ffd700; font-size: 14px; }

.stats-floating-container {
    display: flex; justify-content: center; gap: 15px; margin-bottom: 25px;
}
.stat-bubble {
    background: var(--card-bg);
    min-width: 80px; padding: 10px;
    border-radius: 18px;
    border: 1px solid var(--border-color);
    box-shadow: 0 5px 15px rgba(0,0,0,0.03);
    text-align: center; cursor: pointer;
    transition: transform 0.2s;
}
.stat-bubble:active { transform: scale(0.95); }
.stat-bubble-num { font-size: 16px; font-weight: 800; color: var(--text-dark); display: block; }
.stat-bubble-label { font-size: 10px; color: var(--text-light); text-transform: uppercase; font-weight: 600; }

.profile-action-row { display: flex; gap: 10px; justify-content: center; margin-bottom: 25px; padding: 0 30px; }
.modern-btn {
    flex: 1; padding: 12px; border-radius: 14px; border: none;
    font-size: 14px; font-weight: 700; cursor: pointer;
    display: flex; align-items: center; justify-content: center; gap: 6px;
    transition: 0.2s; box-shadow: 0 5px 15px rgba(0,0,0,0.05);
}
.modern-btn.primary { background: var(--primary-color); color: white; box-shadow: 0 8px 20px rgba(140, 139, 251, 0.4); }
.modern-btn.secondary { background: var(--card-bg); color: var(--text-dark); border: 1px solid var(--border-color); }

.gallery-header {
    padding: 0 25px; margin-bottom: 15px;
    display: flex; justify-content: space-between; align-items: flex-end;
}
.gallery-title { font-size: 18px; font-weight: 800; color: var(--text-dark); }
.gallery-count { font-size: 12px; color: var(--text-light); }

.modern-grid {
    display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; padding: 0 20px 90px 20px;
}
.modern-grid-item {
    aspect-ratio: 3/4; /* Dikdörtgen, moda için daha uygun */
    background: var(--card-bg); border-radius: 12px;
    overflow: hidden; position: relative;
    border: 1px solid var(--border-color);
    box-shadow: 0 2px 5px rgba(0,0,0,0.03);
}

.discovery-header {
    padding: 15px 20px;
    display: flex; align-items: center; gap: 15px;
    overflow-x: auto; scrollbar-width: none; /* Yan kaydırma */
}
.discovery-header::-webkit-scrollbar { display: none; }

.story-bubble {
    display: flex; flex-direction: column; align-items: center; gap: 5px;
    cursor: pointer; min-width: 65px;
}
.story-ring {
    width: 60px; height: 60px; border-radius: 50%;
    padding: 3px; /* Halka kalınlığı */
    background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%);
    display: flex; align-items: center; justify-content: center;
}
.story-inner {
    width: 100%; height: 100%; background: #fff; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 24px; color: #333;
}
.story-label { font-size: 11px; font-weight: 600; color: var(--text-dark); }

.modern-search-container { padding: 0 20px 15px 20px; }
.modern-search-box {
    background: #fff; border-radius: 20px; padding: 12px 20px;
    display: flex; align-items: center; gap: 10px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.05);
    border: 1px solid var(--border-color);
}
.modern-search-input {
    border: none; outline: none; width: 100%; font-size: 14px; color: var(--text-dark); background: transparent;
}

.feed-container { padding: 0 15px 90px 15px; display: flex; flex-direction: column; gap: 20px; }

.modern-feed-card {
    background: #fff; border-radius: 25px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.04);
    overflow: hidden; border: 1px solid rgba(0,0,0,0.03);
    transition: transform 0.2s;
}
.m-card-header {
    padding: 15px; display: flex; align-items: center; justify-content: space-between;
}
.m-user-info { display: flex; align-items: center; gap: 10px; cursor: pointer; }
.m-avatar { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; border: 1px solid #eee; }
.m-username { font-weight: 700; font-size: 14px; color: var(--text-dark); }
.m-rank-tag { font-size: 10px; background: #f0f2f5; padding: 2px 6px; border-radius: 6px; color: #666; margin-left: 5px; }

.m-win-badge {
    background: linear-gradient(135deg, #ffd700 0%, #f1c40f 100%);
    color: #fff; padding: 4px 10px; border-radius: 12px;
    font-size: 11px; font-weight: 800; display: flex; align-items: center; gap: 4px;
    box-shadow: 0 3px 10px rgba(255, 215, 0, 0.3);
}

.m-card-visual {
    background: radial-gradient(circle, #fafafa 0%, #f1f2f6 100%);
    padding: 20px; position: relative;
    display: flex; flex-direction: column; align-items: center; gap: 5px;
}
.m-visual-top { width: 100%; max-height: 200px; object-fit: contain; z-index: 2; filter: drop-shadow(0 5px 10px rgba(0,0,0,0.05)); }
.m-visual-bottom { width: 100%; max-height: 200px; object-fit: contain; margin-top: -10px; z-index: 1; filter: drop-shadow(0 5px 10px rgba(0,0,0,0.05)); }
.m-visual-shoe { width: 80px; height: 80px; object-fit: contain; position: absolute; bottom: 10px; right: 10px; background: #fff; padding: 5px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); transform: rotate(-10deg); }

.m-card-actions { padding: 15px; display: flex; align-items: center; gap: 20px; }
.m-action-btn { font-size: 26px; color: var(--text-light); cursor: pointer; transition: 0.2s; display: flex; align-items: center; gap: 5px; }
.m-action-btn.liked { color: #ff4757; animation: bounce 0.3s; }
.m-like-count { font-size: 14px; font-weight: 600; color: var(--text-dark); }

@keyframes bounce { 0% { transform: scale(1); } 50% { transform: scale(1.3); } 100% { transform: scale(1); } }

[data-theme="dark"] {
    --bg-color: #0f111a;        /* Çok koyu gece mavisi (Simsiyah değil) */
    --card-bg: #1b1e2b;         /* Kartlar için bir ton açığı */
    --border-color: rgba(255, 255, 255, 0.08); /* Sınırları belli eden ince çizgi */
    --text-dark: #e2e8f0;       /* Yumuşak beyaz yazı */
    --text-light: #94a3b8;      /* Soluk gri yazı */

    .profile-cover {
        background: linear-gradient(135deg, #4c4cb5 0%, #6868ac 100%);
    }
    
    .modern-avatar-box {
        background: var(--card-bg);
        border: 4px solid var(--bg-color); /* Sayfa rengiyle çerçeve */
        box-shadow: 0 5px 15px rgba(0,0,0,0.5); /* Daha güçlü gölge */
    }

    .profile-main-card .modern-name { color: #fff; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }
    
    .stat-bubble {
        background: #23273a; /* Karttan biraz daha açık/farklı */
        border: 1px solid rgba(255,255,255,0.1);
        box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }
    .stat-bubble-num { color: #fff; }

    .modern-grid-item {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
    }
    .modern-grid-item div {
        background: radial-gradient(circle, rgba(255,255,255,0.07) 0%, rgba(255,255,255,0) 70%) !important;
    }

    .modern-search-box {
        background: #1b1e2b;
        border: 1px solid rgba(255,255,255,0.1);
        box-shadow: inset 0 2px 5px rgba(0,0,0,0.2); /* İçe göçük hissi */
    }
    .modern-search-input { color: #fff; }

    .modern-feed-card {
        background: var(--card-bg);
        border: 1px solid rgba(255,255,255,0.05);
        box-shadow: 0 10px 30px rgba(0,0,0,0.4);
    }

    .m-card-visual {
        background: radial-gradient(circle, #2d3246 0%, #151722 100%);
        border-top: 1px solid rgba(255,255,255,0.05);
        border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    
    .m-username { color: #f1f5f9; }
    .m-rank-tag { background: #2d3246; border: 1px solid #444; color: #ccc; }
    
    .m-action-btn { color: #64748b; }
    .m-action-btn.liked { color: #ff4757; text-shadow: 0 0 15px rgba(255, 71, 87, 0.4); }

    .clothing-card.tall-card {
        background: linear-gradient(180deg, #2d1b2e 0%, #1a1015 100%);
        border: 1px solid #702548;
    }
    .clothing-card.tall-card .placeholder-state i { 
        color: #d63384; 
        text-shadow: 0 0 10px rgba(214, 51, 132, 0.4); 
    }

    .mode-btn {
        background: #151722;
        border: 1px solid #333;
        color: #888;
    }
    .mode-btn.active-mode {
        background: rgba(140, 139, 251, 0.1);
        border-color: var(--primary-color);
        color: #a2a1ff;
        box-shadow: 0 0 15px rgba(140, 139, 251, 0.1); /* Hafif neon parlama */
    }
    
    .modal-card { 
        background: #1e2230; 
        border: 1px solid #333;
        color: #eee;
    }
    #plan-detail-content > div {
        background: #151722 !important;
        border-color: #333 !important;
    }
}


.wardrobe-showcase-header { font-size: 18px; font-weight: 800; margin-bottom: 15px; color: var(--text-dark); padding-left: 5px; }

.wardrobe-showcase-scroller {
    display: flex; gap: 12px; overflow-x: auto; padding-bottom: 15px; padding-left: 5px;
    scrollbar-width: none; /* Firefox'ta scrollbarı gizle */
}
.wardrobe-showcase-scroller::-webkit-scrollbar { display: none; /* Chrome/Safari'de gizle */ }

.showcase-card {
    min-width: 160px; padding: 15px; border-radius: 20px;
    display: flex; flex-direction: column; gap: 10px; cursor: pointer;
    transition: transform 0.2s, box-shadow 0.2s;
    border: 1px solid rgba(0,0,0,0.05);
}
.showcase-card:active { transform: scale(0.97); } /* Tıklama efekti */

.showcase-card.newborn { background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); color: #1565c0; }
.showcase-card.newborn .showcase-icon { background: rgba(255,255,255,0.5); color: #1565c0; }

.showcase-card.dusty { background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%); color: #e65100; }
.showcase-card.dusty .showcase-icon { background: rgba(255,255,255,0.5); color: #e65100; }

.showcase-card.favorite { background: linear-gradient(135deg, #fce4ec 0%, #f8bbd0 100%); color: #c2185b; }
.showcase-card.favorite .showcase-icon { background: rgba(255,255,255,0.5); color: #c2185b; }

.showcase-icon { width: 40px; height: 40px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 22px; }
.showcase-title { font-weight: 800; font-size: 15px; }
.showcase-desc { font-size: 11px; opacity: 0.8; }


.modern-category-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }

.modern-cat-card {
    height: 110px; border-radius: 22px; padding: 15px;
    display: flex; align-items: center; justify-content: space-between;
    cursor: pointer; position: relative; overflow: hidden;
    box-shadow: 0 8px 20px rgba(0,0,0,0.04); transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); /* Yaylanma efekti */
    border: 1px solid rgba(255,255,255,0.5);
}
.modern-cat-card:active { transform: scale(0.95); } /* Tıklayınca küçül */

.cat-ust { background: linear-gradient(135deg, #eef2ff 0%, #dae0ff 100%); color: #5c6ac4; }
.cat-alt { background: linear-gradient(135deg, #f0fff4 0%, #c6f6d5 100%); color: #276749; }
.cat-elbise { background: linear-gradient(135deg, #fff5f7 0%, #fed7e2 100%); color: #b83280; }
.cat-ayakkabi { background: linear-gradient(135deg, #fffaf0 0%, #feebc8 100%); color: #9c4221; }

.m-cat-icon-box {
    width: 50px; height: 50px; background: rgba(255,255,255,0.6);
    border-radius: 16px; display: flex; align-items: center; justify-content: center;
    font-size: 28px; z-index: 2;
}
.m-cat-info { z-index: 2; text-align: right; }
.m-cat-name { font-weight: 800; font-size: 16px; margin-bottom: 5px; }
.m-cat-count { font-weight: 600; font-size: 13px; opacity: 0.7; }

@keyframes popIn {
    0% { opacity: 0; transform: scale(0.8) translateY(20px); }
    100% { opacity: 1; transform: scale(1) translateY(0); }
}
.animate-pop-in { opacity: 0; animation: popIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; }

.modern-header-bar {
    display: flex; align-items: center; gap: 12px;
    padding: 12px 15px;
    border-radius: 16px;
    margin-bottom: 20px;
    margin-top: 10px;
    background: var(--card-bg);
    box-shadow: 0 5px 15px rgba(0,0,0,0.03);
    border: 1px solid var(--border-color);
    position: relative;
    overflow: hidden;
}

.modern-header-bar::before {
    content: ''; position: absolute; left: 0; top: 0; bottom: 0;
    width: 6px;
}

.header-icon-box {
    width: 38px; height: 38px; border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    font-size: 20px;
    flex-shrink: 0;
}

.header-text-col { display: flex; flex-direction: column; }
.header-main-title { font-size: 16px; font-weight: 800; color: var(--text-dark); line-height: 1.2; }
.header-sub-title { font-size: 11px; color: var(--text-light); font-weight: 500; }

.style-warm::before { background: linear-gradient(180deg, #ff9f43, #ffc048); }
.style-warm .header-icon-box { background: #fff5e6; color: #ff9f43; }
[data-theme="dark"] .style-warm .header-icon-box { background: rgba(255, 159, 67, 0.15); }

.style-cool::before { background: linear-gradient(180deg, #8c8bfb, #a2a1ff); }
.style-cool .header-icon-box { background: #eef0ff; color: #8c8bfb; }
[data-theme="dark"] .style-cool .header-icon-box { background: rgba(140, 139, 251, 0.15); }
#btn-wear-container {
    overflow: hidden;
    max-height: 0; /* Başlangıçta gizli (yüksekliği 0) */
    opacity: 0;
    transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Yaylanarak açılma */
    transform: translateY(20px);
}

#btn-wear-container.show {
    max-height: 80px; /* Açılınca yer kaplasın */
    opacity: 1;
    transform: translateY(0);
    margin-top: 15px;
}

.vibrant-header {
    padding: 20px 25px 10px 25px;
    display: flex; justify-content: space-between; align-items: flex-end;
}
.vh-date { font-size: 17px; font-weight: 800; color: var(--text-dark); letter-spacing: -0.5px; }
.vh-weather { 
    background: #e3f2fd; color: #1565c0; 
    padding: 6px 12px; border-radius: 12px; font-size: 12px; font-weight: 700;
    display: flex; align-items: center; gap: 5px;
}

.colorful-filter-scroll {
    display: flex; gap: 10px; padding: 10px 25px;
    overflow-x: auto; scrollbar-width: none;
}
.colorful-filter-scroll::-webkit-scrollbar { display: none; }

.c-pill {
    padding: 10px 18px; border-radius: 16px;
    font-size: 13px; font-weight: 700;
    display: flex; align-items: center; gap: 6px;
    white-space: nowrap; cursor: pointer; transition: transform 0.2s;
    border: none;
}
.c-pill:active { transform: scale(0.95); }

.pill-season { background: #fff3e0; color: #ef6c00; }  /* Turuncu */
.pill-style { background: #f3e5f5; color: #8e24aa; }   /* Mor */
.pill-plans { background: #e0f2f1; color: #00695c; }   /* Yeşil */

.mode-switcher-container {
    display: flex; background: var(--card-bg);
    margin: 10px 25px; padding: 5px; border-radius: 18px;
    border: 1px solid var(--border-color);
    box-shadow: 0 5px 15px rgba(0,0,0,0.03);
}
.mode-switch-btn {
    flex: 1; padding: 12px; text-align: center;
    border-radius: 14px; font-size: 13px; font-weight: 600;
    color: var(--text-light); cursor: pointer; transition: all 0.3s ease;
    display: flex; align-items: center; justify-content: center; gap: 5px;
}
.mode-switch-btn.active {
    background: linear-gradient(135deg, #8c8bfb 0%, #a2a1ff 100%);
    color: white; box-shadow: 0 4px 10px rgba(140, 139, 251, 0.3);
}

.glass-deck {
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.5);
    border-radius: 24px; padding: 10px 15px; margin: 0 25px 20px 25px;
    display: flex; align-items: center; justify-content: space-between;
    box-shadow: 0 10px 30px rgba(0,0,0,0.08);
}
[data-theme="dark"] .glass-deck { background: rgba(30, 33, 48, 0.9); border-color: rgba(255,255,255,0.1); }

.deck-icon-btn {
    width: 42px; height: 42px; border-radius: 12px;
    display: flex; align-items: center; justify-content: center;
    font-size: 20px; color: var(--text-light); background: transparent;
    border: none; transition: 0.2s;
}
.deck-icon-btn:active { background: rgba(0,0,0,0.05); }

.magic-action-btn {
    background: var(--text-dark); color: var(--bg-color);
    padding: 0 20px; height: 42px; border-radius: 14px;
    font-size: 14px; font-weight: 700; border: none;
    display: flex; align-items: center; gap: 8px; 
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}
[data-theme="dark"] .magic-action-btn { background: #fff; color: #000; }

.control-deck-wrapper {
    padding: 0 25px; margin-top: 10px; margin-bottom: 20px;
}
.control-deck {
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
    border: 1px solid rgba(255,255,255,0.5);
    border-radius: 24px; padding: 10px 15px;
    display: flex; align-items: center; justify-content: space-between;
    box-shadow: 0 10px 30px rgba(0,0,0,0.05);
}

.deck-btn {
    width: 45px; height: 45px; border-radius: 14px; border: none;
    background: transparent; color: var(--text-light);
    font-size: 22px; cursor: pointer; transition: 0.2s;
    display: flex; align-items: center; justify-content: center;
}
.deck-btn:active { transform: scale(0.9); background: rgba(0,0,0,0.05); }

.magic-action-btn, .deck-main-btn {
    background: linear-gradient(135deg, #8c8bfb 0%, #ff7675 100%); 
    color: white !important; /* Yazı kesinlikle beyaz olsun */
    
    padding: 0 25px; 
    height: 45px; 
    border-radius: 50px; /* Daha yuvarlak, daha modern */
    font-size: 15px; 
    font-weight: 700; 
    border: none;
    
    display: flex; 
    align-items: center; 
    gap: 8px; 
    cursor: pointer;
    
    box-shadow: 0 8px 20px rgba(140, 139, 251, 0.4); 
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Yaylanma efekti */
    position: relative;
    overflow: hidden;
    z-index: 1;
}

.magic-action-btn:active, .deck-main-btn:active { 
    transform: scale(0.95); /* Hafif küçülme */
    box-shadow: 0 4px 10px rgba(140, 139, 251, 0.6); 
}

[data-theme="dark"] .magic-action-btn, 
[data-theme="dark"] .deck-main-btn {
    background: linear-gradient(135deg, #6c5ce7 0%, #e84393 100%); /* Karanlık modda biraz daha neon */
    color: white !important;
    box-shadow: 0 8px 25px rgba(108, 92, 231, 0.4);
}

.magic-action-btn::after, .deck-main-btn::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 50%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
    transform: skewX(-20deg);
    animation: buttonShine 4s infinite; /* 4 saniyede bir parlasın */
    pointer-events: none;
}

@keyframes buttonShine {
    0% { left: -100%; }
    10% { left: 200%; }
    100% { left: 200%; }
}

#ai-chat-btn {
    position: fixed; 
    bottom: 175px; /* Eskiden 100px idi, yukarı aldık */
    right: 20px;
    width: 60px; height: 60px;
    background: linear-gradient(135deg, #6c5ce7, #a29bfe);
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    color: white; font-size: 30px;
    box-shadow: 0 10px 25px rgba(108, 92, 231, 0.5);
    cursor: pointer; z-index: 1000;
    transition: transform 0.3s;
    animation: floatChat 4s ease-in-out infinite;
}
#ai-chat-btn:active { transform: scale(0.9); }
.chat-badge {
    position: absolute; top: 0; right: 0;
    background: #ff7675; font-size: 10px; padding: 2px 6px;
    border-radius: 10px; font-weight: bold; border: 2px solid white;
}

@keyframes floatChat { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

#ai-chat-window {
    position: fixed; bottom: 170px; right: 20px;
    width: 320px; height: 450px;
    background: var(--card-bg);
    border-radius: 20px;
    box-shadow: 0 20px 50px rgba(0,0,0,0.2);
    display: none; flex-direction: column;
    overflow: hidden; z-index: 1000;
    border: 1px solid var(--border-color);
    animation: slideUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}
@keyframes slideUp { from { opacity: 0; transform: translateY(20px) scale(0.9); } to { opacity: 1; transform: translateY(0) scale(1); } }

.chat-header {
    background: linear-gradient(90deg, #6c5ce7, #a29bfe);
    padding: 15px; color: white;
    display: flex; justify-content: space-between; align-items: center;
}
.chat-content {
    flex: 1; padding: 15px; overflow-y: auto;
    background: var(--bg-color);
    display: flex; flex-direction: column; gap: 10px;
}
.chat-input-area {
    padding: 10px; background: var(--card-bg);
    border-top: 1px solid var(--border-color);
    display: flex; gap: 10px;
}
#aiUserIn {
    flex: 1; padding: 10px; border-radius: 20px; border: 1px solid var(--border-color);
    background: var(--bg-color); color: var(--text-dark); outline: none;
}
.chat-input-area button {
    width: 40px; height: 40px; border-radius: 50%; border: none;
    background: #6c5ce7; color: white; font-size: 18px; cursor: pointer;
}

.msg { max-width: 80%; padding: 10px 14px; border-radius: 15px; font-size: 13px; line-height: 1.4; }
.msg.ai { background: var(--card-bg); border: 1px solid var(--border-color); color: var(--text-dark); align-self: flex-start; border-bottom-left-radius: 2px; }
.msg.user { background: #6c5ce7; color: white; align-self: flex-end; border-bottom-right-radius: 2px; }
.typing-indicator { font-size: 10px; color: #888; margin-left: 10px; display: none; }

.chat-suggestions-area {
    padding: 10px;
    background: var(--card-bg);
    border-top: 1px solid var(--border-color);
    display: flex;
    gap: 8px;
    overflow-x: auto; /* Yan yana kaydırma */
    white-space: nowrap;
    scrollbar-width: none;
}
.chat-suggestions-area::-webkit-scrollbar { display: none; }

.suggestion-chip {
    background: #eef0ff;
    color: var(--primary-color);
    border: 1px solid rgba(140, 139, 251, 0.3);
    padding: 8px 12px;
    border-radius: 20px;
    font-size: 11px;
    font-weight: 600;
    cursor: pointer;
    flex-shrink: 0;
    transition: 0.2s;
}
.suggestion-chip:active {
    background: var(--primary-color);
    color: white;
    transform: scale(0.95);
}
[data-theme="dark"] .suggestion-chip {
    background: #23273a;
    color: #a2a1ff;
    border-color: rgba(140, 139, 251, 0.2);
}

.cat-acc { 
    background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%); 
    color: #8e24aa; 
    border: 1px solid #d1c4e9;
}

.accessory-premium-card {
    margin: 10px 20px 0 20px; /* Kenarlardan boşluk */
    background: linear-gradient(135deg, #ffffff 0%, #f8f9fc 100%); /* Hafif lüks geçiş */
    border-radius: 24px; /* Modern yuvarlak köşeler */
    padding: 12px;
    
    display: flex;
    align-items: center;
    gap: 15px;
    
    border: 1px solid rgba(140, 139, 251, 0.2); 
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.03);
    position: relative;
    overflow: hidden;
    height: 90px; /* Sabit, kompakt yükseklik */
    transition: transform 0.2s;
}

.accessory-premium-card:active {
    transform: scale(0.98);
}

.acc-action-btn {
    width: 45px;
    height: 45px;
    border-radius: 14px;
    background: #eef0ff; /* Çok açık mor */
    color: var(--primary-color);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 22px;
    cursor: pointer;
    transition: all 0.3s;
    flex-shrink: 0;
}

.acc-action-btn:active {
    background: var(--primary-color);
    color: white;
    transform: rotate(-15deg);
}

.acc-visual-box {
    width: 60px;
    height: 60px;
    background: #fff;
    border-radius: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    
    box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
    border: 1px solid rgba(0,0,0,0.05);
    position: relative;
    flex-shrink: 0;
}

.acc-img {
    width: 90%;
    height: 90%;
    object-fit: contain;
    filter: drop-shadow(0 4px 4px rgba(0,0,0,0.1)); /* Resme gölge ver */
    display: none; /* Başlangıçta gizli */
    z-index: 2;
}

.acc-placeholder {
    color: #cbd5e0;
    font-size: 28px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}

.acc-info-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
    overflow: hidden;
}

.acc-label {
    font-size: 10px;
    font-weight: 800;
    letter-spacing: 1px;
    color: var(--primary-color);
    opacity: 0.7;
    margin-bottom: 2px;
}

.acc-status-text {
    font-size: 12px;
    color: var(--text-dark);
    font-weight: 600;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    
    animation: pulseText 2s infinite; 
}

[data-theme="dark"] .accessory-premium-card {
    background: linear-gradient(135deg, #1b1e2b 0%, #23273a 100%);
    border-color: rgba(255,255,255,0.05);
}
[data-theme="dark"] .acc-action-btn {
    background: rgba(255,255,255,0.05);
    color: #a2a1ff;
}
[data-theme="dark"] .acc-visual-box {
    background: rgba(0,0,0,0.2);
    border-color: rgba(255,255,255,0.05);
}
[data-theme="dark"] .acc-status-text {
    color: #e2e8f0;
}

@keyframes pulseText {
    0% { opacity: 0.6; }
    50% { opacity: 1; }
    100% { opacity: 0.6; }
}


.winner-overlay {
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.3);
    backdrop-filter: blur(4px); /* Buzlu cam efekti */
    display: none; /* JS ile 'flex' yapılacak */
    align-items: center;
    justify-content: center;
    z-index: 10;
    border-radius: 16px; /* Kartın köşelerine uyum */
}

.winner-badge {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    /* Açılış animasyonu: Yaylanarak büyüme */
    animation: popInBadge 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
}

/* 3. Altın Kupa İkonu */
/* 3. Altın Kupa İkonu (Düzeltilmiş) */
.winner-icon {
    font-size: 60px;
    
    /* Altın Gradyan Rengi */
    background: linear-gradient(135deg, #ffd700 0%, #ffb347 100%);
    
    /* Metin içine gradyan gömme */
    -webkit-background-clip: text; 
    background-clip: text; /* VS Code'un istediği standart satır bu */
    
    -webkit-text-fill-color: transparent;
    
    /* Etrafına altın bir parıltı (Glow) */
    filter: drop-shadow(0 0 15px rgba(255, 215, 0, 0.6));
    margin-bottom: 5px;
    
    /* Hafif bir dalgalanma animasyonu */
    animation: trophyFloat 2s ease-in-out infinite;
}

/* 4. "KAZANDI" Yazısı */
.winner-text {
    font-size: 24px;
    font-weight: 900;
    color: #ffffff;
    text-transform: uppercase;
    letter-spacing: 2px;
    /* Güçlü bir dış ışık ve gölge */
    text-shadow: 0 2px 4px rgba(0,0,0,0.3), 0 0 20px rgba(255, 255, 255, 0.4);
}

/* --- ANİMASYONLAR --- */

/* Rozetin ekrana giriş efekti (Pop-in) */
@keyframes popInBadge {
    0% { opacity: 0; transform: scale(0.5) translateY(20px); }
    100% { opacity: 1; transform: scale(1) translateY(0); }
}

/* Kupanın olduğu yerde hafifçe süzülmesi */
@keyframes trophyFloat {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-8px); }
}

/* --- SEYAHAT MODALI STİLLERİ --- */

.travel-weather-card {
    display: flex; 
    flex-direction: column; 
    align-items: center; 
    justify-content: center; 
    gap: 8px;
    padding: 15px 5px; 
    border-radius: 18px; 
    border: 2px solid transparent;
    background: var(--bg-color); /* Temaya duyarlı arka plan */
    color: var(--text-light); 
    cursor: pointer; 
    transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1);
}

.travel-weather-card i { 
    font-size: 28px; 
    transition: transform 0.3s; 
}

.travel-weather-card span { 
    font-size: 13px; 
    font-weight: 700; 
}

/* Seçili Durum */
.travel-weather-card.sel {
    background: var(--card-bg); 
    border-color: var(--primary-color); 
    color: var(--primary-color);
    box-shadow: 0 8px 20px rgba(140, 139, 251, 0.2);
    transform: translateY(-2px);
}

.travel-weather-card.sel i { 
    transform: scale(1.2) rotate(10deg); 
}

/* Aktif (Basılınca) */
.travel-weather-card:active {
    transform: scale(0.95);
}

/* --- FAVORİLERİM (SAVED OUTFITS) STİLLERİ --- */

.saved-outfits-list {
    display: grid;
    grid-template-columns: 1fr 1fr; /* Yan yana 2 kutu */
    gap: 15px;
    padding: 10px 5px;
}

.saved-card {
    background: #fff;
    border-radius: 20px;
    padding: 10px;
    position: relative;
    box-shadow: 0 5px 15px rgba(0,0,0,0.05);
    border: 1px solid rgba(0,0,0,0.05);
    cursor: pointer;
    transition: transform 0.2s;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.saved-card:active {
    transform: scale(0.96);
    border-color: var(--primary-color);
}

.saved-outfit-row {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 5px;
    height: 80px; /* Sabit yükseklik */
    width: 100%;
}

/* Silme Butonu (Çöp Kutusu) */
.saved-delete {
    position: absolute;
    top: 5px;
    right: 5px;
    width: 25px;
    height: 25px;
    background: #ffebeb;
    color: #ff4d4d;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    cursor: pointer;
    z-index: 5;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.saved-delete:active {
    transform: scale(0.9);
}

/* Karanlık Mod */
[data-theme="dark"] .saved-card {
    background: var(--bg-color);
    border-color: rgba(255,255,255,0.05);
}
[data-theme="dark"] .saved-delete {
    background: #2d1b2e;
}

/* --- MODERN ADMIN PANELİ STİLLERİ --- */
/* --- MAKYAJ 2: BUTTON PRESS EFEKTİ --- */
/* --- MAKYAJ 3: SKELETON LOADING (HAVALI YÜKLENİYOR) --- */

.skeleton {
    background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
    background-size: 200% 100%;
    animation: skeleton-loading 1.5s infinite;
    border-radius: 12px;
    opacity: 0.7;
}

@keyframes skeleton-loading {
    0% { background-position: 200% 0; }
    100% { background-position: -200% 0; }
}

/* Skeleton Kart Örneği */
.skeleton-card {
    height: 160px;
    width: 100%;
    border-radius: 20px;
    margin-bottom: 10px;
}
/* Tıklanabilir her şeye basılma hissi ver */
/* --- MAKYAJ 4: BOŞ DURUM GÖRSELLEŞTİRME --- */

.empty-state-box {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 40px 20px;
    text-align: center;
    color: var(--text-light);
    animation: fadeIn 0.5s ease;
}

.empty-state-icon {
    font-size: 60px;
    margin-bottom: 15px;
    opacity: 0.5;
    color: var(--primary-color);
}

.empty-state-text {
    font-size: 14px;
    font-weight: 600;
}

.magic-btn:active, 
.deck-icon-btn:active, 
.nav-item:active, 
.clothing-card:active,
.setting-item:active,
.admin-dashboard-entry:active {
    transform: scale(0.95) !important; /* Hafifçe küçült */
    transition: transform 0.1s ease;
}
/* Ayarlar Menüsündeki Özel Kart */
.admin-entry-card {
    background: linear-gradient(135deg, #2d3436 0%, #000000 100%);
    border-radius: 20px;
    padding: 20px;
    margin-top: 20px;
    color: white;
    position: relative;
    overflow: hidden;
    cursor: pointer;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    border: 1px solid rgba(255,255,255,0.1);
    transition: transform 0.2s;
}
.admin-entry-card:active { transform: scale(0.98); }

.admin-entry-icon {
    position: absolute;
    right: -10px;
    bottom: -10px;
    font-size: 80px;
    color: rgba(255,255,255,0.05);
    transform: rotate(-15deg);
}

/* Modal İçindeki Liste */
.recent-link-item {
    background: #f8f9fa;
    padding: 12px;
    border-radius: 12px;
    margin-bottom: 8px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border: 1px solid #eee;
    font-size: 13px;
}
.link-badge {
    background: #e3f2fd; color: #0984e3;
    padding: 4px 8px; border-radius: 6px;
    font-weight: bold; font-size: 11px;
}

/* --- PROFİLDEKİ ADMİN BUTONU --- */
.admin-dashboard-entry {
    margin: 0 25px 25px 25px;
    background: linear-gradient(135deg, #1e272e 0%, #111 100%);
    padding: 15px;
    border-radius: 18px;
    
    display: none; /* <--- KRİTİK DEĞİŞİKLİK: ARTIK KİMSE GÖREMEZ */
    
    align-items: center;
    justify-content: space-between;
    cursor: pointer;
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    border: 1px solid rgba(255,255,255,0.1);
    position: relative;
    overflow: hidden;
    transition: transform 0.2s;
}
/* Flex özelliğini JS ile ekleyeceğimiz için burayı sildik/gizledik */

.admin-dashboard-entry:active {
    transform: scale(0.97);
}

.admin-dashboard-entry::before {
    content: '';
    position: absolute;
    top: 0; left: 0; width: 4px; height: 100%;
    background: #00b894; /* Sol tarafta yeşil bir çizgi (Aktiflik hissi) */
}

.admin-icon-box {
    width: 40px; height: 40px;
    background: rgba(255,255,255,0.1);
    border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    font-size: 20px;
    color: #00b894; /* İkon Rengi */
}

/* --- SİLME BUTONU STİLİ --- */
.admin-delete-btn {
    width: 30px; 
    height: 30px; 
    display: flex; 
    align-items: center; 
    justify-content: center;
    border-radius: 8px;
    background: #ffebeb; 
    color: #ff4757; 
    cursor: pointer;
    font-size: 16px;
    margin-left: 10px;
    transition: all 0.2s;
}
.admin-delete-btn:hover {
    background: #ff4757;
    color: white;
    transform: scale(1.1);
}

/* --- LİG SİSTEMİ STİLLERİ --- */

.league-card {
    background: #fff;
    border-radius: 20px;
    padding: 15px;
    margin: 10px 25px 20px 25px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.05);
    border: 1px solid rgba(0,0,0,0.05);
    position: relative;
    overflow: hidden;
}

/* Lig Renkleri ve Efektleri */
.league-card.bronze { border-left: 5px solid #cd7f32; background: linear-gradient(to right, #fff, #fff8f0); }
.league-card.silver { border-left: 5px solid #c0c0c0; background: linear-gradient(to right, #fff, #f8f9fa); }
.league-card.gold   { border-left: 5px solid #ffd700; background: linear-gradient(to right, #fff, #fffbf0); }
.league-card.diamond{ border-left: 5px solid #00cec9; background: linear-gradient(to right, #fff, #e0fbfb); }

.league-header {
    display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;
}
.league-title { font-size: 16px; font-weight: 800; display: flex; align-items: center; gap: 8px; }
.league-xp { font-size: 12px; font-weight: 600; color: #888; }

/* İlerleme Çubuğu */
.league-progress-bg {
    width: 100%; height: 8px; background: rgba(0,0,0,0.05); border-radius: 10px; overflow: hidden; margin-bottom: 5px;
}
.league-progress-fill {
    height: 100%; width: 0%; border-radius: 10px; transition: width 1s ease;
}

.bronze .league-progress-fill { background: #cd7f32; }
.silver .league-progress-fill { background: #c0c0c0; }
.gold   .league-progress-fill { background: #ffd700; box-shadow: 0 0 10px #ffd700; }
.diamond .league-progress-fill{ background: #00cec9; box-shadow: 0 0 10px #00cec9; }

.next-league-text { font-size: 10px; color: #aaa; text-align: right; font-style: italic; }

/* --- MAKYAJ 1: SCROLLBAR GİZLEME VE AKICILIK --- */

/* Tüm site için kaydırma çubuğunu gizle ama kaydırmaya izin ver */
::-webkit-scrollbar {
    width: 0px;
    height: 0px;
    background: transparent;
}

body {
    scrollbar-width: none; /* Firefox için */
    -ms-overflow-style: none;  /* IE/Edge için */
}

/* Dokunma hissiyatını iyileştir */
* {
    -webkit-tap-highlight-color: transparent; /* Tıklayınca çıkan mavi kutuyu kaldır */
    user-select: none; /* Yazıların seçilmesini engelle (Uygulama gibi hissettirir) */
}

input, textarea {
    user-select: text; /* Sadece yazı yazılan yerlerde seçime izin ver */
}

/* --- YENİ PROFİL TASARIMI (MODERN CLEAN) --- */

/* 1. Kapak ve Avatar Düzeni */
.profile-cover {
    height: 160px;
    border-radius: 0 0 35px 35px; /* Daha yumuşak kavis */
    box-shadow: 0 10px 30px rgba(140, 139, 251, 0.4);
}

.profile-main-card {
    margin-top: -75px; /* Avatarı kapağın içine daha çok soktuk */
}

.modern-avatar-box {
    width: 120px; 
    height: 120px;
    border: 5px solid var(--bg-color); /* Kalın çerçeve ile ayrım */
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    border-radius: 40px;
}

/* 2. İstatistik Şeridi (Tek Parça) */
.stats-bar {
    display: flex;
    justify-content: space-around;
    align-items: center;
    background: var(--card-bg);
    margin: 20px 25px;
    padding: 15px;
    border-radius: 20px;
    border: 1px solid var(--border-color);
    box-shadow: 0 5px 20px rgba(0,0,0,0.03);
}

.stat-group {
    display: flex;
    flex-direction: column;
    align-items: center;
    cursor: pointer;
    flex: 1;
}

.stat-group:active { transform: scale(0.95); opacity: 0.7; }

.stat-num { font-size: 18px; font-weight: 800; color: var(--text-dark); }
.stat-lbl { font-size: 11px; color: var(--text-light); text-transform: uppercase; font-weight: 600; letter-spacing: 0.5px; }

.stat-divider {
    width: 1px;
    height: 30px;
    background: rgba(0,0,0,0.1);
}

/* 3. Premium Kartı (Banner) */
.premium-banner {
    margin: 0 25px 20px 25px;
    background: linear-gradient(135deg, #111 0%, #333 100%);
    border-radius: 18px;
    padding: 15px 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border: 1px solid #ffd700;
    box-shadow: 0 10px 20px rgba(0,0,0,0.2);
    position: relative;
    overflow: hidden;
    cursor: pointer;
}

.premium-banner::before {
    content: '';
    position: absolute;
    top: -50%; left: -50%; width: 200%; height: 200%;
    background: linear-gradient(45deg, transparent, rgba(255,215,0,0.1), transparent);
    animation: shine 3s infinite;
}

/* 4. Butonlar (Minimal) */
.action-grid {
    display: flex;
    gap: 10px;
    padding: 0 25px 20px 25px;
}

.btn-minimal {
    flex: 1;
    padding: 12px;
    border-radius: 14px;
    background: var(--card-bg);
    border: 1px solid var(--border-color);
    color: var(--text-dark);
    font-size: 13px;
    font-weight: 600;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.03);
    cursor: pointer;
}
.btn-minimal i { font-size: 18px; }

/* --- MAKYAJ: ÇİZGİLERİ SİL VE PÜRÜZSÜZLEŞTİR --- */

/* 1. Üstteki Kapağın Sert Gölgesini (Çizgisini) Kaldır */
.profile-cover {
    box-shadow: none !important; /* O çizgi gibi duran gölgeyi sil */
    /* Kapağın altını hafifçe flulaştırarak gövdeyle birleştir */
    -webkit-mask-image: linear-gradient(to bottom, black 85%, transparent 100%);
    mask-image: linear-gradient(to bottom, black 85%, transparent 100%);
}

/* 2. Ortadaki Kartların Kenar Çizgilerini (Border) Yok Et */
.stats-bar, 
.premium-banner, 
.league-card, 
.btn-minimal,
.modern-avatar-box {
    border: none !important; /* O ince gri çizgileri sil */
    /* Çizgi yerine çok hafif, yumuşak bir derinlik (gölge) ver */
    box-shadow: 0 15px 35px rgba(0,0,0,0.05) !important; 
}

/* 3. Lig Kartı (Sarı Olan) İçin Özel Temizlik */
.league-card {
    background: rgba(255, 255, 255, 0.9) !important; /* Daha opak yap ki arkadaki renk karışmasın */
    backdrop-filter: blur(20px);
}

/* 4. İstatistik Çubuğundaki Dik Çizgileri Sil */
.stat-divider {
    display: none !important; /* Aradaki dik çizgileri de kaldıralım, daha ferah olsun */
}

/* --- VİTRİN SİLME BUTONU --- */
.post-delete-btn {
    position: absolute;
    top: 8px;
    right: 8px;
    width: 28px;
    height: 28px;
    background: rgba(255, 255, 255, 0.9);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #ff4757; /* Kırmızı */
    font-size: 16px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    cursor: pointer;
    z-index: 10; /* Resmin en üstünde olsun */
    transition: transform 0.2s;
}

.post-delete-btn:active {
    transform: scale(0.9);
    background: #ff4757;
    color: white;
}

/* --- Z-INDEX DÜZELTMESİ (PENCEREYİ ÖNE GETİR) --- */
#notificationsModal {
    z-index: 2147483647 !important; /* Milyar düzeyinde, her şeyin önünde */
    background: rgba(0, 0, 0, 0.8) !important; /* Arka planı koyulaştır ki belli olsun */
}

/* Navbar'ın pencerenin önüne geçmesini engelle */
.bottom-navbar {
    z-index: 900 !important; /* Pencereden daha düşük */
}

        /* --- TİTREME VE DONMAYI ENGELLEYEN KOD --- */

/* Arka planı sabitle (Klavye açılınca sıkışmasın) */
.neon-grid-bg {
    position: fixed !important; /* Fixed ile ekrana çiviliyoruz */
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: 0;
    background-attachment: fixed; /* Mobil için kritik ayar */
    pointer-events: none; /* Tıklamaları engellemesin */
}

/* Sayfa içeriği kaydırılabilir olsun ama arka plan dursun */
#page-intro {
    min-height: 100vh; /* height yerine min-height */
    position: relative;
    z-index: 1;
    overflow-y: auto; /* İçerik taşarsa kaydır */
}

</style>

<style>
    /* 1. Profil Kapağının Altındaki Çizgiyi Yok Et */
    .profile-cover {
        box-shadow: none !important;
        border-bottom: none !important;
        /* Alt kısmı yumuşakça şeffaflaştır */
        -webkit-mask-image: linear-gradient(to bottom, black 85%, transparent 100%) !important;
        mask-image: linear-gradient(to bottom, black 85%, transparent 100%) !important;
    }

    /* 2. Tüm Kartların Etrafındaki Gri Çizgileri Sil */
    .profile-main-card, 
    .modern-avatar-box,
    .stats-bar,
    .premium-banner,
    .league-card,
    .btn-minimal {
        border: 0px solid transparent !important; /* Kenarlığı sıfırla */
        outline: none !important;
        
        /* Çizgi yerine çok hafif, yumuşak, modern gölge koy */
        box-shadow: 0 15px 40px rgba(0,0,0,0.06) !important;
    }

    /* 3. İstatistiklerin Arasındaki Dik Çizgileri Kaldır */
    .stat-divider {
        display: none !important;
    }

    /* 4. Lig Kartının (Altın Ligi) Solundaki Renkli Çizgiyi Koru ama Çerçeveyi Sil */
    .league-card {
        /* Sadece sol taraftaki renkli bar kalsın, diğerleri gitsin */
        border: none !important; 
        border-left: 5px solid #ffd700 !important; 
        background: rgba(255,255,255,0.9) !important;
    }

    /* 5. Avatarın Etrafındaki Çerçeveyi Sayfa Rengine Uydur (Kesik görünmesin) */
    .modern-avatar-box {
        border: 5px solid rgba(255,255,255,0.2) !important; /* Hafif şeffaf çerçeve */
        background: transparent !important;
    }
/* --- TAKİPÇİ LİSTESİ DÜZENLEMESİ (NET VE OKUNAKLI) --- */

/* 1. Modalın Kendisini Temizle */
#followListModal .modal-card {
    background: #ffffff !important; /* Arka planı bembeyaz yap */
    padding: 20px;
    border-radius: 24px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.3); /* Derin gölge */
    max-height: 70vh; /* Çok uzamasın */
    display: flex;
    flex-direction: column;
}

/* 2. Liste Kutusunu Düzenle */
#follow-list-content {
    margin-top: 15px;
    padding: 5px;
    overflow-y: auto; /* İçerik kayabilsin */
    display: flex;
    flex-direction: column;
    gap: 10px; /* Kartlar arası boşluk */
}

/* 3. Kişi Kartı Tasarımı */
.follow-user-item {
    background: #f9f9f9; /* Hafif gri kutu */
    border: 1px solid #eee; /* İnce çerçeve */
    border-radius: 16px; /* Yuvarlak köşeler */
    padding: 12px 15px;
    display: flex;
    align-items: center;
    gap: 15px;
    cursor: pointer;
    transition: transform 0.2s, background 0.2s;
    border-bottom: none !important; /* Eski çizgiyi kaldır */
}

/* Tıklayınca Efekt */
.follow-user-item:active {
    transform: scale(0.97);
    background: #eef0ff;
    border-color: var(--primary-color);
}

/* İsim ve Kullanıcı Adı Stilleri */
.f-user-name {
    font-size: 15px; 
    font-weight: 700; 
    color: #2d3436; /* Koyu net siyah */
    margin-bottom: 2px;
}

.f-user-handle {
    font-size: 12px; 
    font-weight: 500; 
    color: #636e72; /* Okunabilir gri */
}

/* KARANLIK MOD AYARLARI */
[data-theme="dark"] #followListModal .modal-card {
    background: #1b1e2b !important;
    border: 1px solid #333;
}
[data-theme="dark"] .follow-user-item {
    background: #23273a;
    border-color: #333;
}
[data-theme="dark"] .f-user-name { color: #fff; }
[data-theme="dark"] .f-user-handle { color: #aaa; }

</style>
</head>
<body>

    <div id="custom-toast">Bildirim</div>

   <div id="page-intro" style="display:none;">
        <div class="neon-grid-bg"></div>
        <img src="/static/logo.png" class="intro-logo" onerror="this.style.display='none'" style="z-index:2; position:relative; border-radius:50%; box-shadow: 0 0 30px rgba(140, 139, 251, 0.8);">
        
        <h2 class="neon-title" id="introTitle" style="z-index:2; position:relative; margin-bottom:10px;">HOŞ GELDİN!</h2>
        <p id="introDesc" style="z-index:2; position:relative; color:#bbb; margin-bottom:30px; font-size:14px; text-shadow: 0 0 5px rgba(255,255,255,0.3);">Stil yolculuğuna başlamak için profilini oluştur.</p>
        
        <div class="neon-form-container" style="z-index:2; position:relative; width:100%; max-width:320px; text-align:left;">
            
            <div id="registerFields">
                <div class="neon-input-group"><label>Adın Soyadın</label><input type="text" id="regName" class="neon-input"></div>
            </div>

            <div class="neon-input-group">
                <label>Kullanıcı Adı</label>
               <input type="text" id="regUser" class="neon-input" oninput="this.value = this.value.replace(/\s/g, '')">
            </div>

        <div class="neon-input-group">
    <label>Şifre</label>
    <input type="password" id="regPassword" class="neon-input" placeholder="******">
</div>    

            <div id="registerFields2">
                <div class="neon-input-group"><label>E-Posta (İsteğe Bağlı)</label><input type="email" id="regEmail" class="neon-input"></div>
                <div style="display:flex; gap:15px;">
                    <div class="neon-input-group" style="flex:1;"><label>Şehir</label><select id="regCity" class="neon-input"></select></div>
                    <div class="neon-input-group" style="flex:1;"><label>Cinsiyet</label><select id="regGender" class="neon-input"><option value="Erkek">Erkek</option><option value="Kadın">Kadın</option><option value="Belirtmek İstemiyorum">Boşver</option></select></div>
                </div>
            </div>

        </div>

        <button id="authBtn" class="neon-btn" onclick="handleAuth()" style="z-index:2; position:relative;">KAYIT OL VE BAŞLA</button>
        
        <p onclick="toggleAuthMode()" id="toggleAuthText" style="z-index:2; position:relative; margin-top:20px; color:#00f2c3; cursor:pointer; font-size:13px; text-decoration:underline;">Zaten hesabın var mı? Giriş Yap</p>
    </div>

    <div id="page-kombin" class="page active">
    
    <div class="vibrant-header">
        <div class="vh-date" id="date-display">...</div>
        <div class="vh-weather" onclick="openCityModal()">
            <i class='bx bx-cloud'></i> <span id="weather-display">--°</span>
        </div>
    </div>

    <div class="colorful-filter-scroll">
        <div class="c-pill pill-season" onclick="openFilterModal('season')">
            <i class='bx bx-sun'></i> <span id="pill-season-text">Yazlık</span>
        </div>
        <div class="c-pill pill-style" onclick="openFilterModal('style')">
            <i class='bx bx-palette'></i> <span id="pill-style-text">Günlük</span>
        </div>
        <div class="c-pill pill-plans" onclick="openPlansModal()">
            <i class='bx bx-calendar-check'></i> Planlarım
        </div>
    </div>

    <div class="mode-switcher-container">
        <div class="mode-switch-btn active" id="btn-switch-normal" onclick="toggleMode('normal')">
            <i class='bx bx-layer'></i> Alt - Üst
        </div>
        <div class="mode-switch-btn" id="btn-switch-elbise" onclick="toggleMode('elbise')">
            <i class='bx bx-body'></i> Elbise
        </div>
    </div>

    <div class="glass-deck" style="margin-top: 5px; margin-bottom: 15px;">
        <button class="deck-icon-btn" onclick="openTravelModal()"><i class='bx bxs-plane-alt'></i></button>
        <button class="deck-icon-btn" onclick="openEventModal()"><i class='bx bx-calendar-star'></i></button>
        
        <button class="magic-action-btn magic-btn" onclick="getSmartRecommendation()">
            <i class='bx bxs-magic-wand'></i> Kombinle
        </button>
        
        <button class="deck-icon-btn" onclick="saveCurrentOutfit()"><i class='bx bx-heart'></i></button>
        <button class="deck-icon-btn" onclick="shareOutfit()"><i class='bx bx-share-alt'></i></button>
    <button class="deck-icon-btn story-btn" onclick="generateStoryImage()" style="color: #E1306C;">
    <i class='bx bxl-instagram'></i>
</button>
    </div>

    <div class="ai-msg" id="ai-feedback"></div>
    <div class="outfit-wrapper" id="capture-area" style="padding-top:0;">
        <div class="outfit-container">
            <div class="clothing-card tall-card" id="card-elbise" style="display:none;">
                <img id="img-elbise" class="clothing-img" data-id="">
                <div id="ph-elbise" class="placeholder-state"><i class='bx bx-body' style="font-size:40px;"></i><br>Elbise</div>
            </div>
            <div class="clothing-card"><img id="img-ust" class="clothing-img" data-id=""><div id="ph-ust" class="placeholder-state"><i class='bx bx-t-shirt'></i><br>Üst</div></div>
            <div class="clothing-card"><img id="img-alt" class="clothing-img" data-id=""><div id="ph-alt" class="placeholder-state"><i class='bx bx-closet'></i><br>Alt</div></div>
            <div class="clothing-card" style="height: 140px;"><img id="img-ayakkabi" class="clothing-img" data-id=""><div id="ph-ayakkabi" class="placeholder-state"><i class='bx bx-walk'></i><br>Ayakkabı</div></div>
        </div>
    </div>

    <div class="accessory-premium-card">
    <div class="acc-action-btn" onclick="markAsDirty('aksesuar')">
        <i class='bx bx-water'></i>
    </div>
    
    <div class="acc-visual-box">
        <img id="img-aksesuar" class="acc-img" data-id="">
        <div id="ph-aksesuar" class="acc-placeholder">
            <i class='bx bx-watch'></i>
        </div>
    </div>
    
    <div class="acc-info-content">
        <div class="acc-label">AKSESUAR</div>
        <div id="acc-msg" class="acc-status-text">
            Aksesuar bekleniyor...
        </div>
    </div>
</div>

    <div id="btn-wear-container">
        <button class="magic-btn wear" onclick="confirmWearToday()">
            <i class='bx bx-check-circle'></i> Bunu Giyeceğim
        </button>
    </div>

    <div id="affiliate-box" style="display:none; margin: 20px 20px 80px 20px; background: linear-gradient(135deg, #fff 0%, #f8f9fc 100%); border: 1px solid #ffd700; border-radius: 16px; padding: 15px; box-shadow: 0 5px 15px rgba(255, 215, 0, 0.15); animation: fadeIn 0.5s;">
   </div>

</div>
        
        <div id="affiliate-box" style="display:none; margin: 0 20px 20px 20px; background: linear-gradient(135deg, #fff 0%, #f8f9fc 100%); border: 1px solid #ffd700; border-radius: 16px; padding: 15px; box-shadow: 0 5px 15px rgba(255, 215, 0, 0.15); animation: fadeIn 0.5s;">
            <div style="display:flex; align-items:center; gap:15px;">
                <div style="width:50px; height:50px; background:#fffbf0; border-radius:12px; display:flex; align-items:center; justify-content:center; font-size:24px;">🎁</div>
                <div style="flex:1;">
                    <div style="font-size:12px; color:#f39c12; font-weight:bold; margin-bottom:2px;">✨ Stil Önerisi</div>
                    <div id="affiliate-text" style="font-size:13px; font-weight:600; color:#333;">...</div>
                </div>
                <a id="affiliate-link" href="#" target="_blank" style="background:#f39c12; color:white; padding:8px 12px; border-radius:10px; text-decoration:none; font-size:12px; font-weight:bold;">İncele <i class='bx bx-right-arrow-alt'></i></a>
            </div>
        </div>
    </div>

    <div id="page-dolabim" class="page">
        

<div class="category-container" id="wardrobe-main-view" style="padding-top: 5px;">

    <div class="modern-header-bar style-warm">
        <div class="header-icon-box"><i class='bx bxs-star'></i></div>
        <div class="header-text-col">
            <div class="header-main-title">Öne Çıkanlar</div>
            <div class="header-sub-title">Sizin için seçtiklerimiz ✨</div>
        </div>
    </div>

    <div class="wardrobe-showcase-scroller">
        
        <div class="showcase-card newborn" onclick="openShowcase('new', 'Son Eklenen 20 Parça ✨')">
            <div class="showcase-icon"><i class='bx bx-plus-medical'></i></div>
            <div class="showcase-info">
                <div class="showcase-title">En Yeniler</div>
                <div class="showcase-desc">Gardırobuna son eklediklerin.</div>
            </div>
        </div>

        <div class="showcase-card dusty" onclick="openShowcase('dusty', 'Unutulanlar (Eskiden Yeniye) 🕸️')">
            <div class="showcase-icon"><i class='bx bx-time-five'></i></div>
            <div class="showcase-info">
                <div class="showcase-title">Tozlu Raflar</div>
                <div class="showcase-desc">Uzun süredir giymediklerin.</div>
            </div>
        </div>
    
    <div class="showcase-card favorite" onclick="openSavedOutfitsModal()">
        <div class="showcase-icon"><i class='bx bxs-heart'></i></div>
        <div class="showcase-info">
            <div class="showcase-title">Favorilerim</div>
            <div class="showcase-desc">Kayıtlı kombinlerin.</div>
        </div>
    </div>

    <div class="showcase-card" style="background: linear-gradient(135deg, #e0f7fa 0%, #b2ebf2 100%); color: #0097a7;" onclick="openLaundryModal()">
        <div class="showcase-icon" style="background: rgba(255,255,255,0.6); color: #00bcd4;">
            <i class='bx bx-water'></i>
        </div>
        <div class="showcase-info">
            <div class="showcase-title">Kirli Sepeti</div>
            <div class="showcase-desc">Yıkanmayı bekleyenler.</div>
        </div>
    </div>
</div>

    <div class="modern-header-bar style-cool" style="margin-top: 25px;">
        <div class="header-icon-box"><i class='bx bxs-grid-alt'></i></div>
        <div class="header-text-col">
            <div class="header-main-title">Gardırop</div>
            <div class="header-sub-title">Kategorilere göz at 📂</div>
        </div>
    </div>

    <div class="modern-category-grid">
        
        <div class="modern-cat-card cat-ust animate-pop-in" onclick="openCategory('ust_giyim', 'Üst Giyim')" style="animation-delay: 0.1s;">
            <div class="m-cat-icon-box"><i class='bx bx-t-shirt'></i></div>
            <div class="m-cat-info">
                <div class="m-cat-name">Üst Giyim</div>
                <div class="m-cat-count" id="count-ust-modern">...</div>
            </div>
        </div>

        <div class="modern-cat-card cat-alt animate-pop-in" onclick="openCategory('alt_giyim', 'Alt Giyim')" style="animation-delay: 0.2s;">
            <div class="m-cat-icon-box"><i class='bx bx-closet'></i></div>
            <div class="m-cat-info">
                <div class="m-cat-name">Alt Giyim</div>
                <div class="m-cat-count" id="count-alt-modern">...</div>
            </div>
        </div>

        <div class="modern-cat-card cat-elbise animate-pop-in" onclick="openCategory('elbise', 'Elbise & Tulum')" style="animation-delay: 0.3s;">
            <div class="m-cat-icon-box"><i class='bx bx-body'></i></div>
            <div class="m-cat-info">
                <div class="m-cat-name">Elbise</div>
                <div class="m-cat-count" id="count-elbise-modern">...</div>
            </div>
        </div>

        <div class="modern-cat-card cat-ayakkabi animate-pop-in" onclick="openCategory('ayakkabi', 'Ayakkabı')" style="animation-delay: 0.4s;">
            <div class="m-cat-icon-box"><i class='bx bx-walk'></i></div>
            <div class="m-cat-info">
                <div class="m-cat-name">Ayakkabı</div>
                <div class="m-cat-count" id="count-ayakkabi-modern">...</div>
            </div>
        </div>

        <div class="modern-cat-card cat-acc animate-pop-in" onclick="openCategory('aksesuar', 'Aksesuarlar')" style="animation-delay: 0.5s;">
            <div class="m-cat-icon-box"><i class='bx bx-watch'></i></div>
            <div class="m-cat-info">
                <div class="m-cat-name">Aksesuar</div>
                <div class="m-cat-count" id="count-aksesuar-modern">...</div>
            </div>
        </div>

    </div> 
</div>

    
        <div id="wardrobe-detail-view">
            <div class="detail-header"><i class='bx bx-arrow-back back-btn' onclick="closeCategory()"></i><div class="detail-title" id="detail-title">Kategori</div></div>
            <div class="wardrobe-grid" id="wardrobe-list"></div>
            <div class="fab-add" onclick="openUploadModal()"><i class='bx bx-plus'></i></div>
        </div>
    </div>

    <div id="page-kesfet" class="page">
    
    <div class="discovery-header">
        <div class="story-bubble" onclick="openLeaderboard()">
            <div class="story-ring" style="background: linear-gradient(45deg, #ffd700, #f1c40f);">
                <div class="story-inner"><i class='bx bxs-trophy' style="color:#f1c40f;"></i></div>
            </div>
            <span class="story-label">Liderler</span>
        </div>
        
        <div class="story-bubble" onclick="openDuel()">
            <div class="story-ring" style="background: linear-gradient(45deg, #ff4757, #ff6b81);">
                <div class="story-inner"><i class='bx bx-joystick' style="color:#ff4757;"></i></div>
            </div>
            <span class="story-label">Düello Yap</span>
        </div>

        <div class="story-bubble" onclick="loadSocialFeed()">
            <div class="story-ring" style="background: #eee;">
                <div class="story-inner"><i class='bx bx-refresh'></i></div>
            </div>
            <span class="story-label">Yenile</span>
        </div>
    </div>

    <div class="modern-search-container">
        <div class="modern-search-box">
            <i class='bx bx-search' style="color:#aaa; font-size:20px;"></i>
            <input type="text" id="userSearchInput" class="modern-search-input" placeholder="Stil ara (Kullanıcı adı)...">
            <button onclick="searchUsers()" style="border:none; background:var(--primary-color); color:white; width:35px; height:35px; border-radius:10px; cursor:pointer;"><i class='bx bx-right-arrow-alt'></i></button>
        </div>
        <div class="search-results-list" id="searchResults" style="margin-top:10px;"></div>
        
        <div class="feed-header-info" id="feedHeaderInfo" style="margin-top:10px;">
            <div style="font-weight:bold; color:var(--primary-color);" id="feed-username-display"></div>
            <div class="clear-search-btn" onclick="clearSearch()"><i class='bx bx-x'></i> Aramayı Temizle</div>
        </div>
    </div>

    <div id="social-feed-container" class="feed-container">
        <div style="text-align:center; margin-top:50px; color:#aaa;">Yükleniyor...</div>
    </div>

</div>

 <div id="page-profil" class="page">
    
    <div class="profile-cover">
        <i class='bx bx-cog' style="position:absolute; top:20px; right:20px; font-size:26px; color:white; cursor:pointer; background:rgba(255,255,255,0.2); padding:8px; border-radius:12px; backdrop-filter:blur(5px);" onclick="toggleSettingsMenu()"></i>
    </div>

    <div class="profile-main-card">
        <div class="modern-avatar-box">
            <img id="profile-img-real" src="" style="display:none;">
            <i class='bx bx-user' id="profile-icon-default"></i>
        </div>
        
        <div class="modern-name" id="profile-name-text">Yükleniyor...</div>
        <div class="modern-handle" id="profile-handle-text">@...</div>
        
        <div id="user-league-display" style="margin-top: 10px;"></div>
    </div>

    <div class="stats-bar">
        <div class="stat-group">
            <span class="stat-num" id="stat-posts">0</span>
            <span class="stat-lbl">Kombin</span>
        </div>
        <div class="stat-divider"></div>
        <div class="stat-group" onclick="openFollowersModal()">
            <span class="stat-num" id="stat-followers">0</span>
            <span class="stat-lbl">Takipçi</span>
        </div>
        <div class="stat-divider"></div>
        <div class="stat-group" onclick="openFollowingModal()">
            <span class="stat-num" id="stat-following">0</span>
            <span class="stat-lbl">Takip</span>
        </div>
    </div>

    <div class="premium-banner" onclick="openPremium()">
        <div style="display:flex; align-items:center; gap:12px;">
            <div style="width:40px; height:40px; background:#ffd700; color:#000; border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:20px;">
                <i class='bx bxs-crown'></i>
            </div>
            <div style="text-align:left;">
                <div style="color:#ffd700; font-weight:800; font-size:14px;">Premium Üyelik</div>
                <div style="color:#aaa; font-size:10px;">Sınırları kaldır, stilini özgür bırak.</div>
            </div>
        </div>
        <i class='bx bx-chevron-right' style="color:#ffd700; font-size:24px;"></i>
    </div>

    <div class="action-grid">
        <button id="followBtn" class="btn-minimal" style="display:none; background:var(--primary-color); color:white;" onclick="toggleFollow()">Takip Et</button>
        
        <button id="editProfileBtn" class="btn-minimal" onclick="openEditProfileModal()">
            <i class='bx bx-edit-alt'></i> Düzenle
        </button>
        
        <button class="btn-minimal" onclick="shareProfile()">
            <i class='bx bx-share-alt'></i> Paylaş
        </button>
    </div>

    <div class="gallery-header" style="margin-top: 10px;">
        <div class="gallery-title">Vitrinim</div>
        <div class="gallery-count" id="gallery-total-count">0 Paylaşım</div>
    </div>

    <div id="user-posts-grid" class="modern-grid"></div>
</div>   

<div class="modal-overlay" id="settingsMenu">
    <div class="modal-card" style="text-align:left;">
        
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <h3 style="margin:0;">Ayarlar</h3>
            <i class='bx bx-x' style="font-size:24px; cursor:pointer;" onclick="toggleSettingsMenu()"></i>
        </div>

        <div class="settings-list" style="padding:0;">
            
            <div class="setting-item" onclick="toggleTheme()">
                <div class="setting-left"><i class='bx bx-moon'></i> Karanlık Mod</div>
                <label class="switch">
                    <input type="checkbox" id="theme-switch" onclick="event.stopPropagation(); toggleTheme();">
                    <span class="slider"></span>
                </label>
            </div>

            <div class="setting-item" onclick="openCityModal()">
                <div class="setting-left"><i class='bx bx-map'></i> Şehir Değiştir</div>
                <i class='bx bx-chevron-right'></i>
            </div>

            <div class="setting-item" onclick="toggleLanguage()">
                <div class="setting-left">
                    <i class='bx bx-world'></i> <span id="lbl_language">Dil / Language</span>
                </div>
                <div style="font-weight:bold; color:var(--primary-color);" id="current-lang-display">TR</div>
            </div>

            <div id="admin-settings-btn" class="setting-item" onclick="openAffiliateAdmin()" style="display:none; background: linear-gradient(135deg, #2d3436 0%, #000 100%); border: 1px solid #444;">
    <div class="setting-left" style="color: #00b894; font-weight: 800;">
        <i class='bx bxs-dashboard'></i> Yönetici Paneli
    </div>
    <i class='bx bx-chevron-right' style="color: #00b894;"></i>
</div>

            <div class="setting-item" onclick="resetApp()">
                <div class="setting-left" style="color:#ff4d4d;">
                    <i class='bx bx-reset' style="color:#ff4d4d;"></i> Çıkış Yap
                </div>
            </div>

        </div>
    </div>
</div>

    <div class="modal-overlay" id="editProfileModal">
        <div class="modal-card">
            <h3>Profili Düzenle</h3>
            <div class="profile-pic-container" style="margin-top:20px;" onclick="document.getElementById('editAvatarInput').click()">
                <div class="profile-pic" style="border-color:#ccc;"><img id="edit-profile-preview" src=""><i class='bx bx-camera' style="font-size:30px; color:#aaa; position:absolute;"></i></div>
            </div>
            <input type="file" id="editAvatarInput" hidden accept="image/*" onchange="previewEditAvatar()">
            <p style="text-align:left; font-size:12px; color:#888; margin-bottom:5px;">Ad Soyad</p>
            <input type="text" id="editFullname" class="name-input" style="border:1px solid #ddd; background:#f9f9f9;">
            <p style="text-align:left; font-size:12px; color:#888; margin-bottom:5px;">Kullanıcı Adı</p>
            <input type="text" id="editUsername" class="name-input" style="border:1px solid #ddd; background:#f9f9f9;" oninput="this.value = this.value.replace(/\s/g, '')">
            <div style="display:flex; gap:10px; margin-top:20px;">
                <button class="magic-btn" onclick="saveProfileChanges()">Kaydet</button>
                <button class="magic-btn" style="background:#ddd; color:#333;" onclick="document.getElementById('editProfileModal').style.display='none'">İptal</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="followListModal">
        <div class="modal-card">
            <i class='bx bx-x' style="position:absolute; top:15px; right:15px; font-size:24px;" onclick="document.getElementById('followListModal').style.display='none'"></i>
            <h3 id="follow-list-title">Liste</h3>
            <div id="follow-list-content" style="max-height:60vh; overflow-y:auto; margin-top:15px; text-align:left;"></div>
        </div>
    </div>
    
    <div class="modal-overlay" id="itemActionModal">
    <div class="modal-card">
        <i class='bx bx-x' style="position:absolute; top:15px; right:15px; font-size:24px;" onclick="document.getElementById('itemActionModal').style.display='none'"></i>
        <h3>İşlem Seç</h3>
        
        <button class="magic-btn" onclick="openEditModalFromAction()" style="background:var(--primary-color); margin-top:20px; margin-bottom:10px;">
            <i class='bx bx-edit-alt'></i> Düzenle
        </button>
        
        <button class="magic-btn" onclick="deleteCurrentItem()" style="background:#ff4d4d;">
            Bu Parçayı Sil
        </button>
    </div>
</div>
    <div class="modal-overlay" id="filterModal"><div class="modal-card"><i class='bx bx-x' style="position:absolute; top:15px; right:15px; font-size:24px;" onclick="document.getElementById('filterModal').style.display='none'"></i><h3 id="filter-modal-title">Seçim Yap</h3><div id="filter-options-container" style="display:flex; flex-direction:column; gap:10px; margin-top:15px;"></div></div></div>
    
    <div class="modal-overlay" id="uploadModal">
    <div class="modal-card">
        <i class='bx bx-x' style="position:absolute; top:15px; right:15px; font-size:24px;" onclick="closeUploadModal()"></i>
        <h3 id="modal-title">Parça Ekle</h3>

        <div style="display:flex; background:#f0f2f5; padding:5px; border-radius:12px; margin-bottom:20px;">
            <div id="tab-photo" onclick="switchUploadTab('photo')" style="flex:1; text-align:center; padding:10px; border-radius:10px; background:white; font-weight:600; font-size:13px; box-shadow:0 2px 5px rgba(0,0,0,0.05); cursor:pointer;">
                <i class='bx bx-camera'></i> Fotoğraf
            </div>
            <div id="tab-link" onclick="switchUploadTab('link')" style="flex:1; text-align:center; padding:10px; border-radius:10px; color:#888; font-weight:600; font-size:13px; cursor:pointer;">
                <i class='bx bx-link'></i> Link
            </div>
        </div>

        <div id="upload-content-photo">
            <div class="section-label" style="text-align:left; margin-bottom:5px;">Kategori</div>
            <select id="uploadCategorySelect" class="city-select" onchange="toggleSubCategory(this.value)">
                <option value="ust_giyim">Üst Giyim</option>
                <option value="alt_giyim">Alt Giyim</option>
                <option value="elbise">Elbise</option>
                <option value="ayakkabi">Ayakkabı</option>
                <option value="aksesuar">Aksesuar</option> 
            </select>

            <div id="subCategoryWrapper" style="display:none; margin-top:10px;">
               <div class="section-label" style="text-align:left; margin-bottom:5px; color:var(--primary-color); font-size:12px;">Aksesuar Türü</div>
               <select id="uploadSubCategory" class="city-select">
                   <option value="canta">Çanta</option>
                   <option value="saat">Saat</option>
                   <option value="gozluk">Gözlük</option>
                   <option value="sapka">Şapka</option>
                   <option value="taki">Takı</option>
                   <option value="diger">Diğer</option>
               </select>
            </div>

            <div id="seasonWrapper">
                <div class="section-label" style="text-align:left; margin-bottom:5px; margin-top:10px;">Mevsim</div>
                <div class="option-grid">
                    <div class="option-btn sel" onclick="selSeason('yaz', this)">Yazlık</div>
                    <div class="option-btn" onclick="selSeason('kis', this)">Kışlık</div>
                    <div class="option-btn" onclick="selSeason('mevsimlik', this)">4 Mevsim</div>
                </div>
            </div>
            
            <div id="styleWrapper">
                <div class="section-label" style="text-align:left; margin-bottom:5px; margin-top:10px;">Tarz</div>
                <div class="option-grid">
                    <div class="option-btn sel" onclick="selStyle('gunluk', this)">Günlük</div>
                    <div class="option-btn" onclick="selStyle('ofis', this)">Ofis</div>
                    <div class="option-btn" onclick="selStyle('spor', this)">Spor</div>
                    <div class="option-btn" onclick="selStyle('ozel', this)">Özel</div>
                </div>
            </div>

            <input type="file" id="fileIn" hidden accept="image/*" multiple>
            <button class="magic-btn" onclick="document.getElementById('fileIn').click()" style="margin:20px auto 10px auto; width:100%;"><i class='bx bx-images'></i> Fotoğrafları Seç</button>
            <button class="magic-btn" id="saveBtn" onclick="uploadRun()" style="margin:0 auto; width:100%; background:var(--text-dark);">Kaydet</button>
        </div>

        <div id="upload-content-link" style="display:none;">
            <p style="font-size:12px; color:#666; margin-bottom:15px; line-height:1.4;">
                Zara, Trendyol, H&M gibi sitelerden ürün linkini kopyala ve yapıştır.
            </p>
            <div class="neon-input-group">
                <input type="text" id="linkInput" class="city-select" placeholder="https://..." style="background:#fff;">
            </div>
            <button class="magic-btn" id="linkSaveBtn" onclick="uploadFromLink()" style="width:100%; background: linear-gradient(135deg, #0984e3 0%, #74b9ff 100%); margin-top:15px;">
                <i class='bx bx-cloud-download'></i> İçe Aktar
            </button>
        </div>

        <div id="status" style="margin-top:10px; font-size:12px; color: var(--primary-color);"></div>
    </div>
</div>

<div class="modal-overlay" id="editModal">
    <div class="modal-card">
        <i class='bx bx-x' style="position:absolute; top:15px; right:15px; font-size:24px; cursor:pointer;" onclick="closeEditModal()"></i>
        <h3>Parçayı Düzenle</h3>

        <div class="section-label" style="text-align:left; margin-bottom:5px;">Kategori</div>
        <select id="editCategory" class="city-select">
            <option value="ust_giyim">Üst Giyim</option>
            <option value="alt_giyim">Alt Giyim</option>
            <option value="elbise">Elbise</option>
            <option value="ayakkabi">Ayakkabı</option>
            <option value="aksesuar">Aksesuar</option>
        </select>

        <div class="section-label" style="text-align:left; margin-bottom:5px; margin-top:10px;">Mevsim</div>
        <div class="option-grid" id="edit-season-opts">
            <div class="option-btn" onclick="selEditSeason('yaz', this)">Yazlık</div>
            <div class="option-btn" onclick="selEditSeason('kis', this)">Kışlık</div>
            <div class="option-btn" onclick="selEditSeason('mevsimlik', this)">4 Mevsim</div>
        </div>

        <div class="section-label" style="text-align:left; margin-bottom:5px; margin-top:10px;">Tarz</div>
        <div class="option-grid" id="edit-style-opts">
            <div class="option-btn" onclick="selEditStyle('gunluk', this)">Günlük</div>
            <div class="option-btn" onclick="selEditStyle('ofis', this)">Ofis</div>
            <div class="option-btn" onclick="selEditStyle('spor', this)">Spor</div>
            <div class="option-btn" onclick="selEditStyle('ozel', this)">Özel</div>
        </div>

        <button class="magic-btn" onclick="saveEditChanges()" style="margin-top:20px; width:100%;">Güncelle</button>
    </div>
</div>

    <div class="modal-overlay" id="travelModal">
    <div class="modal-card" style="padding: 30px 25px;">
        <i class='bx bx-x' style="position:absolute; top:20px; right:20px; font-size:28px; color:#aaa; cursor:pointer;" onclick="document.getElementById('travelModal').style.display='none'"></i>
        
        <div style="width:70px; height:70px; background:#e0f7fa; border-radius:50%; display:flex; align-items:center; justify-content:center; margin:0 auto 15px auto; color:#00bcd4; font-size:32px; box-shadow: 0 10px 20px rgba(0, 188, 212, 0.2);">
            <i class='bx bxs-plane-alt'></i>
        </div>
        <h3 style="text-align:center; font-size:22px; margin-bottom:5px; color:var(--text-dark);">Rotamız Neresi?</h3>
        <p style="text-align:center; color:#888; font-size:13px; margin-bottom:30px;">Senin için eksiksiz bir bavul hazırlayalım.</p>

        <div style="margin-bottom:20px; text-align:left;">
            <label style="color:var(--text-dark); font-weight:600; margin-left:5px; font-size:13px;">Destinasyon</label>
            <div style="position:relative; margin-top:5px;">
                <i class='bx bx-map' style="position:absolute; left:15px; top:50%; transform:translateY(-50%); color:#aaa; font-size:20px;"></i>
                <input type="text" id="travelDest" placeholder="Örn: Bodrum, Paris..." style="width:100%; padding:16px 16px 16px 45px; border-radius:16px; border:1px solid var(--border-color); background:var(--bg-color); font-size:15px; color:var(--text-dark); outline:none; font-weight:600; transition:0.3s;">
            </div>
        </div>

        <div style="margin-bottom:20px; background:var(--bg-color); padding:10px 15px; border-radius:16px; border:1px solid var(--border-color); display:flex; justify-content:space-between; align-items:center;">
    
    <div style="display:flex; align-items:center; gap:8px;">
        <div style="width:32px; height:32px; background:#fff3e0; border-radius:10px; display:flex; align-items:center; justify-content:center; color:#ff9f43;">
            <i class='bx bx-time-five'></i>
        </div>
        <span style="color:var(--text-dark); font-weight:600; font-size:14px;">Süre (Gün)</span>
    </div>

    <div style="display:flex; align-items:center; gap:5px; background:var(--card-bg); padding:4px; border-radius:12px; box-shadow:0 2px 5px rgba(0,0,0,0.05);">
        
        <button onclick="changeTravelDays(-1)" style="width:35px; height:35px; border-radius:10px; border:1px solid var(--border-color); background:transparent; color:var(--text-dark); font-size:18px; cursor:pointer; display:flex; align-items:center; justify-content:center; transition:0.2s;">
            <i class='bx bx-minus'></i>
        </button>
        
        <input type="number" id="travelDays" value="3" readonly style="width:40px; text-align:center; background:transparent; border:none; font-size:16px; font-weight:800; color:var(--text-dark); outline:none;">
        
        <button onclick="changeTravelDays(1)" style="width:35px; height:35px; border-radius:10px; border:1px solid var(--border-color); background:var(--primary-color); color:white; font-size:18px; cursor:pointer; display:flex; align-items:center; justify-content:center; box-shadow:0 2px 5px rgba(140, 139, 251, 0.4);">
            <i class='bx bx-plus'></i>
        </button>
    </div>
</div>

        <div style="text-align:left; font-weight:600; margin-bottom:10px; margin-left:5px; color:var(--text-dark); font-size:13px;">Hava Nasıl Olacak?</div>
        <div class="option-grid" style="grid-template-columns: 1fr 1fr 1fr; gap:10px; margin-bottom:25px;">
            <div class="travel-weather-card sel" onclick="selTravelSeason('yaz', this)">
                <i class='bx bxs-sun' style="color:#ff9f43;"></i>
                <span>Sıcak</span>
            </div>
            <div class="travel-weather-card" onclick="selTravelSeason('mevsimlik', this)">
                <i class='bx bxs-cloud' style="color:#54a0ff;"></i>
                <span>Ilık</span>
            </div>
            <div class="travel-weather-card" onclick="selTravelSeason('kis', this)">
                <i class='bx bxs-snowflake' style="color:#00d2d3;"></i>
                <span>Soğuk</span>
            </div>
        </div>

        <button class="magic-btn" id="btn-pack" onclick="packSuitcase()" style="width:100%; height:60px; font-size:16px; border-radius:18px; box-shadow: 0 10px 25px rgba(140, 139, 251, 0.4);">
            <i class='bx bxs-briefcase-alt-2'></i> Bavulu Hazırla
        </button>
    </div>
</div>
    <div class="modal-overlay" id="plansModal">
        <div class="modal-card" style="max-height:85vh;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <h3 style="margin:0;">Planlarım 🗓️</h3>
                <i class='bx bx-x' style="font-size:28px; cursor:pointer;" onclick="document.getElementById('plansModal').style.display='none'"></i>
            </div>
            
            <div id="plans-list-container" style="display:flex; flex-direction:column; gap:10px;"></div>
        </div>
    </div>

    <div class="modal-overlay" id="planDetailModal">
        <div class="modal-card">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <h3 id="plan-detail-title" style="margin:0; font-size:16px;">Detay</h3>
                <i class='bx bx-x' style="font-size:28px; cursor:pointer;" onclick="document.getElementById('planDetailModal').style.display='none'"></i>
            </div>
            <div id="plan-detail-content" style="display:flex; flex-direction:column; gap:15px;"></div>
        </div>
    </div>

<div class="modal-overlay" id="savedOutfitsModal">
    <div class="modal-card">
        <i class='bx bx-x' style="position:absolute; top:15px; right:15px; font-size:24px; cursor:pointer;" onclick="closeSavedOutfitsModal()"></i>
        <h3 style="text-align:center;">Favori Kombinler ❤️</h3>
        <div id="saved-list-modal" class="saved-outfits-list" style="margin-top:10px;"></div>
    </div>
</div>

<div class="modal-overlay" id="cityModal">
    <div class="modal-card">
        <h3 style="margin-top:0;">Şehir Seç 🌍</h3>
        <select id="citySelect" class="city-select">
            <option value="" disabled selected>Yükleniyor...</option>
        </select>
        <div style="display:flex; gap:10px; margin-top:15px;">
            <button class="magic-btn" onclick="saveCity()" style="flex:1;">Kaydet</button>
            <button class="magic-btn" onclick="document.getElementById('cityModal').style.display='none'" style="flex:1; background:#eee; color:#333; box-shadow:none;">İptal</button>
        </div>
    </div>
</div>

    <nav class="bottom-navbar">
    <a href="#" class="nav-item" onclick="switchPage('dolabim', this)">
        <i class='bx bx-closet'></i>
        <span>Dolabım</span>
    </a>

    <a href="#" class="nav-item active-nav" onclick="switchPage('kombin', this)">
        <i class='bx bx-home-alt-2'></i>
        <span>Kombin</span>
    </a>

    <a href="#" class="nav-item" onclick="switchPage('kesfet', this)">
        <i class='bx bx-compass'></i>
        <span>Keşfet</span>
    </a>

    <a href="javascript:void(0)" class="nav-item" onclick="bildirimSisteminiBaslat()">
        <i class='bx bx-bell'></i>
        <span>Bildirim</span>
    </a>

    <a href="#" class="nav-item" onclick="switchPage('profil', this)">
        <i class='bx bx-user'></i>
        <span>Profil</span>
    </a>
</nav>

    <script>

    // --- YÖNETİCİ AYARLARI (EN TEPEYE EKLE) ---
    const ADMIN_USERS = ["drms02022"]; 
    // ------------------------------------------

    // Hangi sayfada olduğumuzu takip edecek değişken
    let currentViewContext = { type: 'category', param: 'ust_giyim', title: 'Üst Giyim' }; 
    let currentLang = localStorage.getItem('appLang') || (navigator.language.startsWith('tr') ? 'tr' : 'en');

    const translations = {
    tr: {
        // Alt Menü
        nav_closet: "Dolabım",
        nav_combine: "Kombin",
        nav_explore: "Keşfet",
        nav_notif: "Bildirim",
        nav_profile: "Profil",
        
        // Kombin Ekranı
        lbl_season: "Mevsim",
        lbl_style: "Tarz",
        lbl_plans: "Planlarım",
        btn_normal: "Alt - Üst",
        btn_dress: "Elbise",
        btn_combine: "Kombinle",
        btn_wear: "Bunu Giyeceğim",
        
        // Dolabım (Vitrin)
        title_showcase: "Öne Çıkanlar",
        sub_showcase: "Sizin için seçtiklerimiz ✨",
        card_new_title: "En Yeniler",
        card_new_desc: "Son eklenen parçalar.",
        card_fav_title: "Favorilerim",
        card_fav_desc: "Kayıtlı kombinlerin.",
        title_wardrobe: "Gardırop",
        sub_wardrobe: "Kategorilere göz at 📂",
        
        // Kategoriler
        cat_top: "Üst Giyim",
        cat_bottom: "Alt Giyim",
        cat_dress: "Elbise & Tulum",
        cat_shoe: "Ayakkabı",
        
        // Profil
        btn_edit_profile: "Profili Düzenle",
        stat_posts: "Kombin",
        stat_followers: "Takipçi",
        stat_following: "Takip",
        title_gallery: "Vitrinim",
        
        // Ayarlar
        lbl_language: "Dil / Language",
        lbl_dark_mode: "Karanlık Mod",
        lbl_city: "Şehir Değiştir",
        lbl_logout: "Çıkış Yap",
        
        // Uyarılar & Mesajlar
        msg_loading: "Yükleniyor...",
        msg_preparing: "Hazırlanıyor...",
        msg_saved: "Kaydedildi!",
        msg_shared: "Paylaşıldı!",
        msg_confirm_season: "Bu mevsime uygun parça yok. Karışık yapayım mı?"
    },
    en: {
        // Navbar
        nav_closet: "Closet",
        nav_combine: "Style Me",
        nav_explore: "Explore",
        nav_notif: "Alerts",
        nav_profile: "Profile",
        
        // Combine Screen
        lbl_season: "Season",
        lbl_style: "Style",
        lbl_plans: "My Plans",
        btn_normal: "Top - Bottom",
        btn_dress: "Dress",
        btn_combine: "Create Outfit",
        btn_wear: "I'll Wear This",
        
        // Closet Showcase
        title_showcase: "Highlights",
        sub_showcase: "Picked for you ✨",
        card_new_title: "New Arrivals",
        card_new_desc: "Latest additions.",
        card_fav_title: "Favorites",
        card_fav_desc: "Saved outfits.",
        title_wardrobe: "Wardrobe",
        sub_wardrobe: "Browse categories 📂",
        
        // Categories
        cat_top: "Tops",
        cat_bottom: "Bottoms",
        cat_dress: "Dresses",
        cat_shoe: "Shoes",
        
        // Profile
        btn_edit_profile: "Edit Profile",
        stat_posts: "Outfits",
        stat_followers: "Followers",
        stat_following: "Following",
        title_gallery: "My Showcase",
        
        // Settings
        lbl_language: "Language",
        lbl_dark_mode: "Dark Mode",
        lbl_city: "Change City",
        lbl_logout: "Log Out",
        
        // Alerts & Messages
        msg_loading: "Loading...",
        msg_preparing: "Preparing...",
        msg_saved: "Saved!",
        msg_shared: "Shared!",
        msg_confirm_season: "No items for this season. Should I mix match?"
    }
};
// --- YÖNETİCİ AYARLARI ---
// Buraya kendi kullanıcı adını (veya yetki vereceğin kişileri) yaz.
// ÖRNEK: const ADMIN_USERS = ["ensar", "admin", "patron"];

function applyLanguage() {
    const t = translations[currentLang];
    
    // Yardımcı Fonksiyon: ID varsa güncelle
    const setText = (id, key) => {
        const el = document.getElementById(id);
        if(el) el.innerText = t[key];
    };

    // --- Arayüzü Güncelle ---
    
    // Navbar
    // (Navbar ikonlu olduğu için innerHTML kullanmadan span güncellemek daha güvenli, 
    // ama senin yapında direkt metin var, o yüzden childNodes ile erişeceğiz veya ID vereceğiz)
    // En kolayı butonlara ID verip güncellemek. Şimdilik manuel yapıyoruz:
    document.querySelectorAll('.nav-item span')[0].innerText = t.nav_closet;
    document.querySelectorAll('.nav-item span')[1].innerText = t.nav_combine;
    document.querySelectorAll('.nav-item span')[2].innerText = t.nav_explore;
    document.querySelectorAll('.nav-item span')[3].innerText = t.nav_notif;
    document.querySelectorAll('.nav-item span')[4].innerText = t.nav_profile;

    // Kombin Ekranı
    // Hap butonların (Pill) içindeki metinler dinamik değiştiği için
    // onları anlık güncellemek yerine varsayılanları değiştiriyoruz.
    // Ancak sihirli buton önemli:
    const magicBtn = document.querySelector('.magic-btn');
    if(magicBtn && !magicBtn.disabled) magicBtn.innerHTML = `<i class='bx bxs-magic-wand'></i> ${t.btn_combine}`;
    
    const wearBtn = document.querySelector('.magic-btn.wear');
    if(wearBtn) wearBtn.innerHTML = `<i class='bx bx-check-circle'></i> ${t.btn_wear}`;

    document.getElementById('btn-switch-normal').innerHTML = `<i class='bx bx-layer'></i> ${t.btn_normal}`;
    document.getElementById('btn-switch-elbise').innerHTML = `<i class='bx bx-body'></i> ${t.btn_dress}`;

    // Dolabım Başlıklar
    const headers = document.querySelectorAll('.header-main-title');
    if(headers[0]) headers[0].innerText = t.title_showcase;
    if(headers[1]) headers[1].innerText = t.title_wardrobe;

    const subs = document.querySelectorAll('.header-sub-title');
    if(subs[0]) subs[0].innerText = t.sub_showcase;
    if(subs[1]) subs[1].innerText = t.sub_wardrobe;

    // Vitrin Kartları
    const titles = document.querySelectorAll('.showcase-title');
    if(titles[0]) titles[0].innerText = t.card_new_title;
    if(titles[2]) titles[2].innerText = t.card_fav_title;

    const descs = document.querySelectorAll('.showcase-desc');
    if(descs[0]) descs[0].innerText = t.card_new_desc;
    if(descs[2]) descs[2].innerText = t.card_fav_desc;

    // Kategoriler
    const cats = document.querySelectorAll('.m-cat-name');
    if(cats[0]) cats[0].innerText = t.cat_top;
    if(cats[1]) cats[1].innerText = t.cat_bottom;
    if(cats[2]) cats[2].innerText = t.cat_dress;
    if(cats[3]) cats[3].innerText = t.cat_shoe;

    // Profil
    setText('gallery-total-count', t.title_gallery); // Count dinamik ama başlık bu
    
    // Ayarlar Menüsü
    setText('lbl_language', 'lbl_language');
    // Diğer ayar butonlarını manuel seçelim
    const settingItems = document.querySelectorAll('.setting-item');
    // Bu kısım HTML yapısına göre hassastır, ID eklemek daha iyi olurdu ama şimdilik:
    if(settingItems[0]) settingItems[0].querySelector('.setting-left').innerHTML = `<i class='bx bx-moon'></i> ${t.lbl_dark_mode}`;
    if(settingItems[1]) settingItems[1].querySelector('.setting-left').innerHTML = `<i class='bx bx-map'></i> ${t.lbl_city}`;
    if(settingItems[3]) settingItems[3].querySelector('.setting-left').innerHTML = `<i class='bx bx-reset'></i> ${t.lbl_logout}`;

    // Dil Göstergesi
    document.getElementById('current-lang-display').innerText = currentLang.toUpperCase();
}

function toggleLanguage() {
    currentLang = currentLang === 'tr' ? 'en' : 'tr';
    localStorage.setItem('appLang', currentLang);
    applyLanguage();
    showToast(currentLang === 'tr' ? "Dil: Türkçe" : "Language: English");
}
        
        let activeOutfitType = 'normal'; // Varsayılan mod
        let activeSeasonFilter='yaz'; let activeStyleFilter='gunluk'; let activeWardrobeTab='ust_giyim'; 
        let uploadSeason='yaz'; let uploadStyle='gunluk'; let travelSeason='yaz'; 
        let savedOutfitsData=[]; let currentItemIdToDelete=null; let styleChart=null; let seasonChart=null; let viewingProfileUsername=null; 
        const cityCoords = {
        "Adana": {lat: 37.00, lon: 35.32}, "Adıyaman": {lat: 37.76, lon: 38.28}, "Afyonkarahisar": {lat: 38.75, lon: 30.54},
        "Ağrı": {lat: 39.72, lon: 43.05}, "Aksaray": {lat: 38.37, lon: 34.03}, "Amasya": {lat: 40.65, lon: 35.83},
        "Ankara": {lat: 39.93, lon: 32.85}, "Antalya": {lat: 36.89, lon: 30.71}, "Ardahan": {lat: 41.11, lon: 42.70},
        "Artvin": {lat: 41.18, lon: 41.82}, "Aydın": {lat: 37.84, lon: 27.84}, "Balıkesir": {lat: 39.65, lon: 27.88},
        "Bartın": {lat: 41.63, lon: 32.34}, "Batman": {lat: 37.88, lon: 41.13}, "Bayburt": {lat: 40.26, lon: 40.22},
        "Bilecik": {lat: 40.14, lon: 29.98}, "Bingöl": {lat: 38.88, lon: 40.49}, "Bitlis": {lat: 38.40, lon: 42.10},
        "Bolu": {lat: 40.73, lon: 31.61}, "Burdur": {lat: 37.72, lon: 30.29}, "Bursa": {lat: 40.18, lon: 29.06},
        "Çanakkale": {lat: 40.15, lon: 26.41}, "Çankırı": {lat: 40.60, lon: 33.61}, "Çorum": {lat: 40.55, lon: 34.95},
        "Denizli": {lat: 37.77, lon: 29.09}, "Diyarbakır": {lat: 37.91, lon: 40.24}, "Düzce": {lat: 40.84, lon: 31.15},
        "Edirne": {lat: 41.68, lon: 26.56}, "Elazığ": {lat: 38.68, lon: 39.22}, "Erzincan": {lat: 39.75, lon: 39.50},
        "Erzurum": {lat: 39.90, lon: 41.27}, "Eskişehir": {lat: 39.78, lon: 30.52}, "Gaziantep": {lat: 37.06, lon: 37.38},
        "Giresun": {lat: 40.91, lon: 38.39}, "Gümüşhane": {lat: 40.46, lon: 39.48}, "Hakkari": {lat: 37.58, lon: 43.74},
        "Hatay": {lat: 36.40, lon: 36.34}, "Iğdır": {lat: 39.92, lon: 44.03}, "Isparta": {lat: 37.76, lon: 30.55},
        "İstanbul": {lat: 41.01, lon: 28.98}, "İzmir": {lat: 38.42, lon: 27.14}, "Kahramanmaraş": {lat: 37.58, lon: 36.93},
        "Karabük": {lat: 41.20, lon: 32.62}, "Karaman": {lat: 37.18, lon: 33.22}, "Kars": {lat: 40.60, lon: 43.10},
        "Kastamonu": {lat: 41.38, lon: 33.78}, "Kayseri": {lat: 38.73, lon: 35.48}, "Kilis": {lat: 36.72, lon: 37.11},
        "Kırıkkale": {lat: 39.85, lon: 33.51}, "Kırklareli": {lat: 41.73, lon: 27.22}, "Kırşehir": {lat: 39.15, lon: 34.17},
        "Kocaeli": {lat: 40.85, lon: 29.88}, "Konya": {lat: 37.87, lon: 32.48}, "Kütahya": {lat: 39.42, lon: 29.98},
        "Malatya": {lat: 38.35, lon: 38.31}, "Manisa": {lat: 38.61, lon: 27.43}, "Mardin": {lat: 37.32, lon: 40.74},
        "Mersin": {lat: 36.80, lon: 34.64}, "Muğla": {lat: 37.21, lon: 28.36}, "Muş": {lat: 38.74, lon: 41.50},
        "Nevşehir": {lat: 38.62, lon: 34.71}, "Niğde": {lat: 37.97, lon: 34.68}, "Ordu": {lat: 40.98, lon: 37.88},
        "Osmaniye": {lat: 37.07, lon: 36.25}, "Rize": {lat: 41.02, lon: 40.52}, "Sakarya": {lat: 40.76, lon: 30.39},
        "Samsun": {lat: 41.29, lon: 36.33}, "Şanlıurfa": {lat: 37.16, lon: 38.79}, "Siirt": {lat: 37.93, lon: 41.94},
        "Sinop": {lat: 42.03, lon: 35.15}, "Şırnak": {lat: 37.52, lon: 42.46}, "Sivas": {lat: 39.75, lon: 37.01},
        "Tekirdağ": {lat: 40.98, lon: 27.51}, "Tokat": {lat: 40.32, lon: 36.55}, "Trabzon": {lat: 41.00, lon: 39.72},
        "Tunceli": {lat: 39.11, lon: 39.55}, "Uşak": {lat: 38.68, lon: 29.41}, "Van": {lat: 38.50, lon: 43.38},
        "Yalova": {lat: 40.65, lon: 29.27}, "Yozgat": {lat: 39.82, lon: 34.81}, "Zonguldak": {lat: 41.46, lon: 31.79}
    };
        
        function showToast(message) { var x = document.getElementById("custom-toast"); x.innerText = message; x.className = "show"; setTimeout(function(){ x.className = x.className.replace("show", ""); }, 3000); }

        document.addEventListener("DOMContentLoaded", function(){
        // Tarihi Göster
        const options = { weekday: 'long', month: 'long', day: 'numeric' };
        document.getElementById('date-display').innerText = new Date().toLocaleDateString('tr-TR', options);

        // Şehir Listesini Doldur
        const citySelectMain = document.getElementById('citySelect');
        const citySelectIntro = document.getElementById('regCity');
        
        // Listeyi Temizle (Tekrarı önlemek için)
        if(citySelectMain) citySelectMain.innerHTML = '<option value="" disabled selected>Şehir Seçiniz...</option>';
        if(citySelectIntro) citySelectIntro.innerHTML = '';

        Object.keys(cityCoords).sort((a,b)=>a.localeCompare(b,'tr')).forEach(c=>{ 
            // Ana ayarlar için
            if(citySelectMain) {
                const o1 = document.createElement('option'); o1.value=c; o1.textContent=c; 
                citySelectMain.appendChild(o1);
            }
            // Kayıt ekranı için
            if(citySelectIntro) {
                const o2 = document.createElement('option'); o2.value=c; o2.textContent=c;
                citySelectIntro.appendChild(o2);
            }
        });
        
        // Kullanıcı Kontrolü
        if(!localStorage.getItem("userName")) {
            document.getElementById("page-intro").style.display="flex";
        } else {
            checkIntro();
        }

        // HATA DÜZELTME: Eski "Istanbul" (I ile) verisini "İstanbul" (İ ile) yap
        let currentCity = localStorage.getItem("userCity");
        if(currentCity === "Istanbul" || !cityCoords[currentCity]) {
            localStorage.setItem("userCity", "İstanbul");
        }
        
        // Başlangıç Fonksiyonlarını Çalıştır
        checkCity(); 
        loadStats(); 
        loadTheme(); 
        checkTodaysPlan();
        
        // Dil Ayarı
        applyLanguage();
    });

        // --- AUTH & PROFILE ---
        function checkIntro(){if(!localStorage.getItem("userName"))document.getElementById("page-intro").style.display="flex";else{document.getElementById("profile-name-text").innerText=localStorage.getItem("full_name")||localStorage.getItem("userName");document.getElementById("profile-handle-text").innerText='@'+localStorage.getItem("userName");}}
        // --- AUTH LOGIC (GİRİŞ & KAYIT) ---
        let isLoginMode = false; // Başlangıçta Kayıt Modu

        function toggleAuthMode() {
            isLoginMode = !isLoginMode;
            const regFields = document.getElementById('registerFields');
            const regFields2 = document.getElementById('registerFields2');
            const btn = document.getElementById('authBtn');
            const title = document.getElementById('introTitle');
            const desc = document.getElementById('introDesc');
            const toggleText = document.getElementById('toggleAuthText');

            if (isLoginMode) {
                // Giriş Moduna Geç
                regFields.style.display = 'none';
                regFields2.style.display = 'none';
                btn.innerText = "GİRİŞ YAP";
                title.innerText = "TEKRAR HOŞ GELDİN";
                desc.innerText = "Hesabına girmek için kullanıcı adını yaz.";
                toggleText.innerText = "Hesabın yok mu? Kayıt Ol";
            } else {
                // Kayıt Moduna Dön
                regFields.style.display = 'block';
                regFields2.style.display = 'block';
                btn.innerText = "KAYIT OL VE BAŞLA";
                title.innerText = "HOŞ GELDİN!";
                desc.innerText = "Stil yolculuğuna başlamak için profilini oluştur.";
                toggleText.innerText = "Zaten hesabın var mı? Giriş Yap";
            }
        }

        async function handleAuth() {
    // 1. Kullanıcı Adı ve Şifreyi Al
    const u = document.getElementById("regUser").value.trim();
    const p = document.getElementById("regPassword") ? document.getElementById("regPassword").value.trim() : ""; 

    // 2. Temel Kontroller
    if(!u || u.length < 3) return showToast("Geçerli bir kullanıcı adı giriniz.");
    if(!p || p.length < 4) return showToast("Şifre en az 4 karakter olmalı.");

    const btn = document.getElementById('authBtn');
    btn.disabled = true;

    if (isLoginMode) {
        // --- GİRİŞ YAP ---
        btn.innerText = "GİRİŞ YAPILIYOR...";
        try {
            // Şifreyi de gönderiyoruz
            const res = await fetch('/user/login', {
                method: 'POST', 
                headers: {'Content-Type':'application/json'},
                body: JSON.stringify({ username: u, password: p }) 
            });
            const result = await res.json();

            if (res.ok) {
                // Bilgileri LocalStorage'a Kaydet
                localStorage.setItem("userName", result.data.username);
                localStorage.setItem("full_name", result.data.full_name);
                if(result.data.city) localStorage.setItem("userCity", result.data.city);
                if(result.data.gender) {
                    localStorage.setItem("userGender", result.data.gender);
                    applyGenderTheme(result.data.gender);
                }
                showToast("Giriş Başarılı! 🎉");
                setTimeout(() => location.reload(), 1000);
            } else {
                // Hata durumunda (Şifre yanlış vb.)
                showToast(result.detail || "Giriş başarısız.");
                btn.innerText = "GİRİŞ YAP";
                btn.disabled = false;
            }
        } catch(e) { 
            console.error(e);
            showToast("Bağlantı hatası."); 
            btn.innerText = "GİRİŞ YAP";
            btn.disabled = false; 
        }

    } else {
        // --- KAYIT OL ---
        btn.innerText = "KAYDEDİLİYOR...";
        
        // Kayıt formundaki diğer alanları al
        const f = document.getElementById("regName").value.trim();
        const e = document.getElementById("regEmail").value.trim();
        const c = document.getElementById("regCity").value;
        const g = document.getElementById("regGender").value;

        if(!f) { 
            showToast("İsim zorunludur."); 
            btn.disabled = false; 
            btn.innerText = "KAYIT OL VE BAŞLA";
            return; 
        }

        try {
            // Kayıt olurken de şifreyi (password: p) gönderiyoruz
            const res = await fetch('/user/register',{
                method:'POST', 
                headers:{'Content-Type':'application/json'},
                body:JSON.stringify({
                    username: u, 
                    password: p, 
                    full_name: f, 
                    email: e, 
                    city: c, 
                    gender: g
                })
            });
            
            if(res.ok) {
                // Otomatik giriş yapmış gibi kaydet
                localStorage.setItem("userName", u); 
                localStorage.setItem("full_name", f);
                localStorage.setItem("userCity", c); 
                localStorage.setItem("userGender", g);
                
                showToast("Kayıt Başarılı! 🚀");
                setTimeout(() => location.reload(), 1000);
            } else {
                // Backend'den dönen hatayı göster (Örn: Kullanıcı adı alınmış)
                const errData = await res.json();
                showToast(errData.detail || "Kayıt başarısız.");
                btn.innerText = "KAYIT OL VE BAŞLA";
                btn.disabled = false;
            }
        } catch(e){ 
            console.error(e);
            showToast("Hata oluştu."); 
            btn.innerText = "KAYIT OL VE BAŞLA";
            btn.disabled = false; 
        }
    }
}
// --- GÜNCELLENMİŞ AYARLAR MENÜSÜ FONKSİYONU ---
// Script bölümündeki toggleSettingsMenu fonksiyonunu KONTROL ET:
function toggleSettingsMenu() { 
    const m = document.getElementById('settingsMenu'); 
    
    if (m.style.display !== 'flex') {
        const myUser = localStorage.getItem("userName");
        const adminBtn = document.getElementById('admin-settings-btn');
        
        // Kullanıcı adın "drms02022" ise butonu gösterir
        if (adminBtn && typeof ADMIN_USERS !== 'undefined' && ADMIN_USERS.includes(myUser)) {
            adminBtn.style.display = 'flex';
        } else if (adminBtn) {
            adminBtn.style.display = 'none';
        }
    }
    m.style.display = m.style.display === 'flex' ? 'none' : 'flex'; 
}
        function openEditProfileModal() { document.getElementById('editProfileModal').style.display='flex'; document.getElementById('settingsMenu').style.display='none'; document.getElementById('editFullname').value = localStorage.getItem('full_name'); document.getElementById('editUsername').value = localStorage.getItem('userName'); document.getElementById('edit-profile-preview').src = document.getElementById('profile-img-real').src; }
        function previewEditAvatar() { const file = document.getElementById('editAvatarInput').files[0]; if(file) document.getElementById('edit-profile-preview').src = URL.createObjectURL(file); }
        async function saveProfileChanges() { const oldUser = localStorage.getItem('userName'); const newFullname = document.getElementById('editFullname').value.trim(); const newUser = document.getElementById('editUsername').value.trim(); if(!newUser || !newFullname) return showToast("Bilgiler boş olamaz"); const file = document.getElementById('editAvatarInput').files[0]; if(file) { const fd = new FormData(); fd.append('file', file); fd.append('username', oldUser); await fetch('/user/upload-avatar', {method:'POST', body:fd}); } const res = await fetch('/user/update', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({current_username: oldUser, new_username: newUser, new_full_name: newFullname}) }); const data = await res.json(); if(data.status === 'success') { localStorage.setItem('userName', newUser); localStorage.setItem('full_name', newFullname); showToast("Profil Güncellendi ✅"); location.reload(); } else { showToast(data.detail || "Hata oluştu."); } }

        // --- RANK SYSTEM ---
        function getRankInfo(xp) { xp = xp || 0; if (xp >= 1000) return { title: "Moda İkonu 👑", class: "rank-ikon" }; if (xp >= 500) return { title: "Trendsetter 🔥", class: "rank-trend" }; if (xp >= 100) return { title: "Stilist ✂️", class: "rank-stilist" }; return { title: "Çaylak 👶", class: "rank-caylak" }; }
        function getRankHTML(xp) { const r = getRankInfo(xp); return `<span class="rank-tag ${r.class}">${r.title}</span>`; }

        // --- PROFİL VERİLERİNİ YÜKLEME (INSTAGRAM STİLİ) ---
// --- MODERN PROFİL VERİ YÜKLEME ---
async function loadProfileData(targetUsername) {
    const myUser = localStorage.getItem("userName"); 
    viewingProfileUsername = targetUsername || myUser; 
    const isMe = (viewingProfileUsername === myUser);
    
    // Butonları Ayarla
    const editBtn = document.getElementById('editProfileBtn');
    const followBtn = document.getElementById('followBtn');
    
    if (isMe) {
        editBtn.style.display = 'flex'; // Modern btn flex kullanıyor
        followBtn.style.display = 'none';
    // --- YÖNETİCİ KONTROLÜ ---
        // Butonu bul
        const adminBtn = document.querySelector('.admin-dashboard-entry');
        
        // Eğer kullanıcı listede varsa butonu göster ('flex' yap)
        if (adminBtn) {
            if (ADMIN_USERS.includes(myUser)) {
                adminBtn.style.display = 'flex';
            } else {
                adminBtn.style.display = 'none';
            }
        }
    
    } else {
        editBtn.style.display = 'none';
        followBtn.style.display = 'flex';
    }
    
    try {
        const r = await fetch(`/user/profile/${viewingProfileUsername}?viewer=${myUser}`); 
        const d = await r.json();
        if(d.error) return showToast("Kullanıcı bulunamadı");
        
        // Metinleri Doldur
        document.getElementById("profile-name-text").innerText = d.full_name;
        document.getElementById("profile-handle-text").innerText = '@' + d.username;
        
        // --- YENİ LİG SİSTEMİ ENTEGRASYONU ---
        const league = d.league; // Backend'den gelen yeni veri
        const leagueDiv = document.getElementById('user-league-display');
        
        if (league) {
            let nextText = league.next_xp 
                ? `Sonraki lige ${league.next_xp} XP kaldı` 
                : "Zirvedesin! 👑";

            leagueDiv.innerHTML = `
                <div class="league-card ${league.class}">
                    <div class="league-header">
                        <div class="league-title" style="color:var(--text-dark)">
                            <span style="font-size:24px;">${league.icon}</span> 
                            ${league.name}
                        </div>
                        <div class="league-xp">${d.xp} XP</div>
                    </div>
                    <div class="league-progress-bg">
                        <div class="league-progress-fill" style="width: ${league.progress}%"></div>
                    </div>
                    <div class="next-league-text">${nextText}</div>
                </div>
            `;
        }

        // İstatistikler
        document.getElementById("stat-followers").innerText = d.followers; 
        document.getElementById("stat-following").innerText = d.following; 
        document.getElementById("stat-posts").innerText = d.posts;
        document.getElementById("gallery-total-count").innerText = d.posts + " Paylaşım";
        
        // Avatar
        const img = document.getElementById('profile-img-real'); 
        const icon = document.getElementById('profile-icon-default');
        if(d.avatar_url) { 
            img.src = d.avatar_url; img.style.display = 'block'; icon.style.display = 'none'; 
        } else { 
            img.style.display = 'none'; icon.style.display = 'flex'; 
        }
        
        // Takip Durumu
        if(d.is_following){ 
            followBtn.innerText = "Takibi Bırak"; 
            followBtn.classList.remove('primary'); followBtn.classList.add('secondary');
            followBtn.style.background = ""; followBtn.style.color = "";
        } else { 
            followBtn.innerHTML = "<i class='bx bx-user-plus'></i> Takip Et"; 
            followBtn.classList.add('primary'); followBtn.classList.remove('secondary');
        }
        
        // IZGARA DOLDURMA
        const grid = document.getElementById('user-posts-grid'); 
        grid.innerHTML = "";
        
        if(d.feed_posts && d.feed_posts.length > 0) {
    d.feed_posts.forEach(p => { 
        const div = document.createElement('div'); 
        div.className = 'modern-grid-item'; 
        
        // EĞER PROFİL BENİMSE SİLME BUTONU EKLE
        let deleteBtnHtml = "";
        if (isMe) {
            // event.stopPropagation() çok önemli! 
            // Yoksa silmeye basınca aynı zamanda kombini de yüklemeye çalışır.
            deleteBtnHtml = `
                <div class="post-delete-btn" onclick="event.stopPropagation(); deleteSocialPost(${p.id})">
                    <i class='bx bx-trash'></i>
                </div>
            `;
        }

        div.innerHTML = `
            ${deleteBtnHtml}
            <div style="height:100%; display:flex; flex-direction:column; background:#fff;">
                <img src="${p.top_url}" style="height:50%; object-fit:contain; padding:5px;">
                <img src="${p.bottom_url}" style="height:50%; object-fit:contain; padding:5px; background:#f9f9f9;">
            </div>
        `; 
        
        // Karta tıklayınca kombini yükle (Mevcut özellik)
        div.onclick = () => loadSharedOutfitToMain(p); 
        
        grid.appendChild(div); 
    }); 
} else {
    // Boş durumu
    grid.innerHTML = `
        <div style="grid-column: span 3; text-align:center; padding:40px; color:#aaa; border: 2px dashed #eee; border-radius:15px;">
            <i class='bx bx-hanger' style="font-size:40px; margin-bottom:5px;"></i><br>
            Vitrin Boş
        </div>
    `;
}

    } catch(e) { console.error(e); }
}

        function loadSharedOutfitToMain(postData) { switchPage('kombin'); if(postData.top_id) { updateCard('ust', {id: postData.top_id, url: postData.top_url}); updateCard('alt', {id: postData.bottom_id, url: postData.bottom_url}); if(postData.shoe_id) updateCard('ayakkabi', {id: postData.shoe_id, url: postData.shoe_url}); else hideCard('ayakkabi'); } else { showToast("Bu kombin eski versiyonda oluşturulmuş."); } document.getElementById('btn-wear-container').classList.add('show');}
        
        // --- TAKİP ET / BIRAK FONKSİYONU (GÜNCELLENMİŞ) ---
async function toggleFollow() {
    const btn = document.getElementById('followBtn');
    const myUser = localStorage.getItem("userName");
    const targetUser = viewingProfileUsername; // Şu an baktığımız profil
    
    // İşlem yapılıyor hissiyatı (Geçici olarak opaklığı düşür)
    btn.style.opacity = "0.7";

    // Şu anki duruma göre işlem belirle
    // Eğer butonun sınıfında 'primary' yoksa, zaten takip ediyoruzdur -> Bırakacağız
    const isFollowing = !btn.classList.contains('primary'); 
    
    const url = isFollowing ? '/user/unfollow' : '/user/follow';

    try {
        const res = await fetch(url, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({follower: myUser, followed: targetUser})
        });
        
        const data = await res.json();
        
        if (data.status === 'success' || data.status === 'already_following') {
            // BAŞARILI OLDUYSA GÖRÜNÜMÜ GÜNCELLE
            if (isFollowing) {
                // Takibi Bıraktık -> Butonu Mavi Yap (Takip Et)
                btn.innerText = "Takip Et";
                btn.classList.add('primary');
                btn.style.background = "#0095f6"; 
                btn.style.color = "#fff";
                
                // Takipçi sayısını manuel düşür (Anlık tepki için)
                let count = document.getElementById('stat-followers');
                count.innerText = Math.max(0, parseInt(count.innerText) - 1);
                
            } else {
                // Takip Ettik -> Butonu Gri Yap (Takip Ediliyor)
                btn.innerText = "Takip Ediliyor";
                btn.classList.remove('primary');
                btn.style.background = "#efefef"; 
                btn.style.color = "#000";
                
                // Takipçi sayısını manuel artır
                let count = document.getElementById('stat-followers');
                count.innerText = parseInt(count.innerText) + 1;
                
                // İsteğe bağlı: Konfeti patlat (sadece takip edince)
                try { confetti({ particleCount: 30, spread: 50, origin: { y: 0.4 } }); } catch(e){}
            }
        }
    } catch (e) {
        showToast("Bağlantı hatası!");
    } finally {
        btn.style.opacity = "1"; // Opaklığı düzelt
    }
}
        async function openFollowersModal() { const user = viewingProfileUsername || localStorage.getItem("userName"); const res = await fetch(`/user/followers/${user}`); const list = await res.json(); renderUserList("Takipçiler", list); }
        async function openFollowingModal() { const user = viewingProfileUsername || localStorage.getItem("userName"); const res = await fetch(`/user/following/${user}`); const list = await res.json(); renderUserList("Takip Edilenler", list); }
// --- GÜNCELLENMİŞ KİŞİ LİSTESİ OLUŞTURUCU ---
function renderUserList(title, listData) { 
    // Modalı aç ve başlığı ayarla
    document.getElementById('followListModal').style.display = 'flex'; 
    document.getElementById('follow-list-title').innerText = title; 
    
    const container = document.getElementById('follow-list-content'); 
    container.innerHTML = ""; // İçini temizle

    // Liste boşsa mesaj göster
    if(listData.length === 0) { 
        container.innerHTML = `
            <div style='color:#999; text-align:center; padding:30px; display:flex; flex-direction:column; align-items:center;'>
                <i class='bx bx-ghost' style="font-size:40px; margin-bottom:10px;"></i>
                <div>Kimse yok.</div>
            </div>`; 
        return; 
    } 

    // Listeyi Döngüyle Oluştur
    listData.forEach(u => { 
        const div = document.createElement('div'); 
        div.className = 'follow-user-item'; // Yeni CSS sınıfımız
        
        // Avatar var mı yok mu kontrolü
        const av = u.avatar_url 
            ? `<img src="${u.avatar_url}" style="width:100%; height:100%; object-fit:cover;">` 
            : `<div style="width:100%; height:100%; background:#eef0ff; display:flex; align-items:center; justify-content:center; color:#8c8bfb;"><i class='bx bx-user' style="font-size:20px;"></i></div>`; 
        
        // Yeni HTML Yapısı
        div.innerHTML = `
            <div class="follow-user-avatar" style="width:45px; height:45px; border-radius:50%; overflow:hidden; flex-shrink:0; border:1px solid rgba(0,0,0,0.1);">
                ${av}
            </div>
            <div style="flex:1;">
                <div class="f-user-name">${u.full_name}</div>
                <div class="f-user-handle">@${u.username}</div>
            </div>
            <i class='bx bx-chevron-right' style="color:#ccc; font-size:24px;"></i>
        `; 
        
        // Tıklayınca Profile Git
        div.onclick = () => { 
            loadProfileData(u.username); 
            document.getElementById('followListModal').style.display = 'none'; 
        }; 
        
        container.appendChild(div); 
    }); 
}
        // --- DISCOVERY & FEED ---
        async function searchUsers(){const q=document.getElementById('userSearchInput').value.trim();if(!q)return;const r=await fetch(`/user/search?q=${q}`);const u=await r.json();const l=document.getElementById('searchResults');l.innerHTML="";l.style.display='flex';if(u.length===0){l.innerHTML="<div style='text-align:center;'>Yok</div>";return;}u.forEach(i=>{const d=document.createElement('div');d.className='user-result-item'; const avatarHTML = i.avatar_url ? `<img src="${i.avatar_url}">` : `<i class='bx bx-user'></i>`; d.innerHTML=`<div class="user-result-avatar">${avatarHTML}</div><div><div style="font-weight:600;">${i.full_name}</div><div style="font-size:11px;">@${i.username}</div></div>`; d.onclick=()=>{loadProfileData(i.username);switchPage('profil',null);document.getElementById('searchResults').style.display='none';};l.appendChild(d);});}
        function clearSearch(){document.getElementById('userSearchInput').value="";document.getElementById('searchResults').style.display='none';loadSocialFeed();}
        
        // --- MODERN SOSYAL AKIŞ YÜKLEME ---
async function loadSocialFeed(username=null) {
    const container = document.getElementById('social-feed-container');
    if (!container) return;
    
    // Yükleniyor animasyonu
    container.innerHTML = "<div style='text-align:center; margin-top:50px; color:#888;'><i class='bx bx-loader-alt bx-spin' style='font-size:30px;'></i><br>Stiller Yükleniyor...</div>";
    
    // Başlık güncelleme (Arama yapıldıysa)
    if(username) {
        document.getElementById('feedHeaderInfo').style.display = 'flex';
        document.getElementById('feed-username-display').innerText = username + " Paylaşımları";
    } else {
        document.getElementById('feedHeaderInfo').style.display = 'none';
    }

    try {
        let baseUrl = username ? `/social/feed?username=${username}` : '/social/feed';
        const separator = baseUrl.includes('?') ? '&' : '?';
        const finalUrl = `${baseUrl}${separator}t=${new Date().getTime()}`;
        
        const res = await fetch(finalUrl);
        if (!res.ok) throw new Error(`Sunucu Hatası`);
        const posts = await res.json();
        
        container.innerHTML = ""; 
        
        if (!Array.isArray(posts) || posts.length === 0) { 
            container.innerHTML = `
                <div style='text-align:center; margin-top:50px; color:#999;'>
                    <div style='font-size:50px; margin-bottom:10px;'>🍃</div>
                    Henüz paylaşım yok.<br>İlk stili sen paylaş!
                </div>`; 
            return; 
        }

        posts.forEach(p => {
            const isLiked = localStorage.getItem(`liked_${p.id}`);
            
            // Avatar
            const avatarSrc = p.avatar_url || "";
            const avatarHTML = avatarSrc ? `<img src="${avatarSrc}" class="m-avatar">` : `<div class="m-avatar" style="display:flex; align-items:center; justify-content:center; background:#eee;"><i class='bx bx-user'></i></div>`;
            
            // Ayakkabı Görseli
            const shoeHTML = p.shoe_url ? `<img src="${p.shoe_url}" class="m-visual-shoe">` : '';
            
            // Galibiyet Rozeti
            const winsHTML = (p.duel_wins && p.duel_wins > 0) 
                ? `<div class="m-win-badge"><i class='bx bxs-trophy'></i> ${p.duel_wins}</div>` 
                : '';

            // Rütbe
            const rank = getRankInfo(p.xp || 0);

            // HTML Kart Oluşturma
            const card = document.createElement('div'); 
            card.className = 'modern-feed-card';
            
            // Alt giyim kontrolü (Elbise mi?)
            // Backend'den elbise verisi nasıl geliyor kontrol etmek lazım.
            // Genelde bottom_url boşsa elbisedir. 
            // Görsel yapısını ona göre ayarlayalım:
            let visualContent = '';
            
            // Eğer alt giyim yoksa (Elbise) veya alt giyim URL'i "null" ise
            if(!p.bottom_url || p.bottom_url === 'null' || p.bottom_id === 0) {
                 visualContent = `
                    <img src="${p.top_url}" class="m-visual-top" style="max-height:350px; border-radius:15px;">
                    ${shoeHTML}
                 `;
            } else {
                // Normal Kombin
                 visualContent = `
                    <img src="${p.top_url}" class="m-visual-top">
                    <img src="${p.bottom_url}" class="m-visual-bottom">
                    ${shoeHTML}
                 `;
            }

            card.innerHTML = `
                <div class="m-card-header">
                    <div class="m-user-info" onclick="loadProfileData('${p.username_handle}'); switchPage('profil', null);">
                        ${avatarHTML}
                        <div>
                            <div class="m-username">${p.user_name || 'Kullanıcı'} <span class="m-rank-tag">${rank.title}</span></div>
                            <div style="font-size:11px; color:#999;">@${p.username_handle}</div>
                        </div>
                    </div>
                    ${winsHTML}
                </div>
                
                <div class="m-card-visual" ondblclick="likePost(this.parentElement.querySelector('.m-action-btn'), ${p.id})">
                    ${visualContent}
                </div>
                
                <div class="m-card-actions">
                    <div class="${isLiked ? 'm-action-btn liked' : 'm-action-btn'}" onclick="likePost(this, ${p.id})">
                        <i class='${isLiked ? 'bx bxs-heart' : 'bx bx-heart'}'></i> 
                        <span class="m-like-count">${p.likes || 0}</span>
                    </div>
                    <div class="m-action-btn" onclick="openComments(${p.id})">
                        <i class='bx bx-message-rounded-dots'></i>
                    </div>
                    <div class="m-action-btn" style="margin-left:auto;" onclick="showToast('Paylaşıldı!')">
                        <i class='bx bx-paper-plane'></i>
                    </div>
                </div>
            `;
            
            container.appendChild(card);
        });

    } catch (e) { 
        console.error("Feed Hatası:", e); 
        container.innerHTML = `<div style='text-align:center; color:red; margin-top:20px;'>Bağlantı Hatası!</div>`; 
    }
}

        async function likePost(e,id){if(localStorage.getItem(`liked_${id}`))return;e.classList.add('liked');e.querySelector('i').className='bx bxs-heart';e.querySelector('span').innerText=parseInt(e.querySelector('span').innerText)+1;await fetch('/social/like',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({post_id:id,liker_user:localStorage.getItem("userName")})});localStorage.setItem(`liked_${id}`,"true");}
        // --- BİLDİRİM FONKSİYONLARI (GÜNCEL) ---

// --- BİLDİRİM AÇMA FONKSİYONU (GÜNCEL) ---
// --- KESİN ÇALIŞAN BİLDİRİM FONKSİYONU ---
async function openNotificationsModal() {
    console.log("Bildirim butonu tıklandı! Fonksiyon çalışıyor...");

    // 1. Yeni Modalı Bul
    const modal = document.getElementById('bildirimModalFinal');
    if (!modal) {
        alert("Hata: Bildirim kutusu HTML'de bulunamadı! Lütfen kodu kontrol et.");
        return;
    }
    
    // 2. Modalı Zorla Aç (Flex ve Z-Index Garantisi)
    modal.style.setProperty('display', 'flex', 'important');
    
    // 3. Yükleniyor Göstergesi
    const container = document.getElementById('bildirim-listesi-container');
    if(container) {
        container.innerHTML = "<div style='text-align:center; padding:20px; color:#888;'><i class='bx bx-loader-alt bx-spin' style='font-size:30px;'></i><br>Yükleniyor...</div>";
    }

    // 4. Verileri Çek
    try {
        const username = localStorage.getItem("userName");
        // URL sonuna zaman damgası ekliyoruz ki tarayıcı önbellekten okumasın
        const res = await fetch(`/notifications/${username}?t=${new Date().getTime()}`);
        const data = await res.json();
        
        if(container) container.innerHTML = ""; // Temizle

        if (!data || data.length === 0) {
            if(container) container.innerHTML = "<div style='text-align:center; padding:20px; color:#aaa;'>Henüz bildirim yok.</div>";
            return;
        }
        
        // Listeyi Doldur
        data.forEach(item => {
            const div = document.createElement('div');
            div.className = 'notif-item';
            
            let iconHtml = `<div class="notif-icon" style="background:#eee; color:#555;"><i class='bx bx-bell'></i></div>`;
            if (item.type === 'like') iconHtml = `<div class="notif-icon" style="background:#ffebeb; color:#ff4757;"><i class='bx bxs-heart'></i></div>`;
            if (item.type === 'follow') iconHtml = `<div class="notif-icon" style="background:#eef0ff; color:#54a0ff;"><i class='bx bxs-user-plus'></i></div>`;

            div.innerHTML = `
                ${iconHtml}
                <div class="notif-content" style="flex:1;">
                    ${item.message}
                    <div style="font-size:10px; color:#aaa; margin-top:3px;">Az önce</div>
                </div>
            `;
            if(container) container.appendChild(div);
        });

    } catch (e) {
        console.error("Bildirim hatası:", e);
        if(container) container.innerHTML = "<div style='color:red; text-align:center;'>Bağlantı hatası!</div>";
    }
}
        
        // --- SMART RECOMMENDATION (CONTEXT AWARE & SILENT) ---
// --- AKILLI AFFILIATE SİSTEMİ (AI BACKEND ENTEGRASYONU) ---
async function showAffiliateSuggestion() {
    const box = document.getElementById('affiliate-box');
    const username = localStorage.getItem("userName");
    
    // Güvenlik kontrolü
    if (!box || !username) return;

    // 1. AŞAMA: KULLANICIYA "ANALİZ YAPILIYOR" HİSSİYATI VERMEK
    // Yapay zeka düşünürken kullanıcı boş ekran görmesin, heyecanlansın.
    box.style.display = "block";
    box.innerHTML = `
        <div style="display:flex; align-items:center; gap:15px; padding:10px;">
            <div style="width:50px; height:50px; background:#f0f2f5; border-radius:12px; display:flex; align-items:center; justify-content:center;">
                <i class='bx bx-loader-alt bx-spin' style="color:#888; font-size:24px;"></i>
            </div>
            <div>
                <div style="font-size:11px; font-weight:bold; color:#888; text-transform:uppercase;">Stilist Dolabını İnceliyor...</div>
                <div style="font-size:13px; color:#333;">Sana en uygun eksik parça aranıyor.</div>
            </div>
        </div>
    `;

    try {
        // 2. AŞAMA: BACKEND API'YE İSTEK ATMA (Groq / Llama 3)
        // Bu istek sunucuya gider, tüm dolabı tarar ve tek bir mantıklı ürün döner.
        const res = await fetch(`/affiliate/suggest-missing-piece?username=${username}`);
        const data = await res.json();

        // Eğer backend'den bir hata dönerse veya öneri yoksa kutuyu gizle
        if (data.error) { 
            console.warn("Affiliate Uyarısı:", data.error);
            box.style.display = 'none'; 
            return; 
        }

        // 3. AŞAMA: SATIN ALMA LİNKİNİ OLUŞTURMA
        // Gelen anahtar kelimeyi (search_query) Google Alışveriş linkine çeviriyoruz.
        // İleride burayı 'trendyol.com/sr?q=...' şeklinde de yapabilirsin.
        const queryTerm = data.search_query || data.item_name || "moda";
        const searchLink = data.affiliate_link || `https://www.google.com/search?q=${encodeURIComponent(queryTerm)}`;

        // 4. AŞAMA: SONUCU ŞIK BİR KART OLARAK GÖSTERME
        box.innerHTML = `
            <div style="display:flex; align-items:center; gap:15px;">
                <div style="width:50px; height:50px; background:linear-gradient(135deg, #fffbf0 0%, #fff 100%); border:1px solid #ffd700; border-radius:12px; display:flex; align-items:center; justify-content:center; font-size:26px; box-shadow:0 4px 10px rgba(255, 215, 0, 0.2); flex-shrink:0;">
                    🛍️
                </div>

                <div style="flex:1;">
                    <div style="font-size:10px; color:#e67e22; font-weight:800; text-transform:uppercase; letter-spacing:0.5px; margin-bottom:2px;">
                        🔥 Dolabındaki Eksik Parça
                    </div>
                    <div style="font-size:15px; font-weight:700; color:#2d3436; margin-bottom:2px;">
                        ${data.item_name}
                    </div>
                    <div style="font-size:12px; color:#636e72; line-height:1.3;">
                        ${data.reason}
                    </div>
                </div>

                <a href="${searchLink}" target="_blank" style="background:linear-gradient(135deg, #2d3436 0%, #000 100%); color:white; padding:10px 12px; border-radius:14px; text-decoration:none; font-size:12px; font-weight:bold; box-shadow: 0 5px 15px rgba(0,0,0,0.2); display:flex; flex-direction:column; align-items:center; justify-content:center; min-width:70px; text-align:center; transition: transform 0.2s;">
                    <span>İncele</span>
                    <i class='bx bx-right-arrow-alt' style="margin-top:2px; font-size:16px;"></i>
                </a>
            </div>
        `;
        
        // Dikkat çekmesi için aşağıdan yukarı kayma animasyonu ekle
        box.style.animation = "slideInUp 0.6s cubic-bezier(0.22, 1, 0.36, 1)";

    } catch (e) {
        console.error("Affiliate Sistem Hatası:", e);
        box.style.display = "none"; // Hata durumunda kutuyu sessizce gizle
    }
}

// Animasyon CSS'ini dinamik olarak ekle (Eğer CSS dosyasında yoksa diye garanti olsun)
const styleSheet = document.createElement("style");
styleSheet.innerText = `
@keyframes slideInUp {
    from { transform: translateY(30px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}
`;
document.head.appendChild(styleSheet);

        // --- updateCard Fonksiyonu (GÜNCELLENMİŞ) ---
function updateCard(type, item) {
    const img = document.getElementById(`img-${type}`);
    const ph = document.getElementById(`ph-${type}`);
    
    if (img && item) {
        img.src = item.url;
        img.setAttribute('data-id', item.id);
        
        // YENİ EKLENEN SATIR: Rengi de kaydediyoruz!
        img.setAttribute('data-color', item.color_name || 'Bilinmiyor');
        
        img.style.display = 'block';
        if (ph) ph.style.display = 'none';
    }
}

// --- DÜELLO SİSTEMİ (EKSİK PARÇALAR) ---

function openDuel() { 
    document.getElementById('duelModal').style.display = 'flex'; 
    loadDuelPair(); 
}

function closeDuel() { 
    document.getElementById('duelModal').style.display = 'none'; 
}

async function loadDuelPair(isTransition = false) {
    const arena = document.getElementById('duel-arena-content');
    if (!isTransition) {
        arena.innerHTML = "<div style='color:white; text-align:center;'>Rakipler aranıyor... <br><i class='bx bx-loader-alt bx-spin' style='font-size:30px; margin-top:10px;'></i></div>";
    }

    try {
        const user = localStorage.getItem("userName");
        const res = await fetch(`/duel/pair?username=${user}&t=${new Date().getTime()}`);
        const data = await res.json();

        if (data.error) { 
            arena.innerHTML = `<div style='color:white; text-align:center; padding:20px;'>${data.error}</div>`; 
            arena.classList.remove('fade-out'); 
            return; 
        }

        const leftCard = createDuelCardHTML(data.left, 'left');
        const rightCard = createDuelCardHTML(data.right, 'right');
        arena.innerHTML = `${leftCard}<div class="vs-badge">VS</div>${rightCard}`;
        
        setTimeout(() => { arena.classList.remove('fade-out'); }, 50);

    } catch (e) { 
        console.error(e); 
        arena.innerHTML = "<div style='color:white; text-align:center;'>Bağlantı hatası.</div>"; 
        arena.classList.remove('fade-out'); 
    }
}

        // --- DÜELLO KARTI OLUŞTURUCU (GELİŞMİŞ) ---
function createDuelCardHTML(item, side) {
    // Ayakkabı Görseli (Varsa)
    const shoeHtml = item.shoe_url 
        ? `<div style="background:#fff; border-radius:10px; padding:5px; box-shadow:0 3px 6px rgba(0,0,0,0.1); width:60px; height:60px; display:flex; align-items:center; justify-content:center; margin-top:-15px; z-index:2; position:relative;">
             <img src="${item.shoe_url}" style="width:100%; height:100%; object-fit:contain;">
           </div>` 
        : '';

    // Kıyafet Görseli (Elbise mi, Alt-Üst mü?)
    let outfitHtml = '';
    
    // Eğer alt giyim yoksa veya URL'i bozuksa ELBİSE varsayıyoruz
    if (!item.bottom_url || item.bottom_url === 'null' || item.bottom_id == 0) {
        // ELBİSE GÖRÜNÜMÜ
        outfitHtml = `
            <img src="${item.top_url}" style="width:100%; height:75%; object-fit:contain; filter:drop-shadow(0 5px 10px rgba(0,0,0,0.1));">
        `;
    } else {
        // ALT-ÜST KOMBİN GÖRÜNÜMÜ
        outfitHtml = `
            <img src="${item.top_url}" style="width:100%; height:45%; object-fit:contain; filter:drop-shadow(0 5px 5px rgba(0,0,0,0.1)); z-index:1;">
            <img src="${item.bottom_url}" style="width:100%; height:45%; object-fit:contain; margin-top:-10px; filter:drop-shadow(0 5px 5px rgba(0,0,0,0.1));">
        `;
    }

    // HTML Çıktısı
    return `
        <div class="duel-card" id="card-${side}" onclick="voteDuel(${item.id}, '${side}')" style="background: radial-gradient(circle, #fff 0%, #f1f2f6 100%); border: 4px solid transparent; transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);">
            
            <div class="duel-img-split" style="align-items:center; justify-content:center; padding:10px;">
                ${outfitHtml}
                ${shoeHtml}
            </div>
            
            <div class="duel-user-info" style="border-top:1px solid #eee; padding:8px;">
                <div style="font-size:14px; font-weight:bold; color:#333;">${item.user_name || 'Kullanıcı'}</div>
                <div style="font-size:10px; color:#888;">@${item.username_handle}</div>
            </div>
            
            <div class="winner-overlay">
    <div class="winner-badge">
        <i class='bx bxs-trophy winner-icon'></i>
        <div class="winner-text">KAZANDI</div>
    </div>
</div>
        </div>
    `;
}
        // --- LİDERLİK TABLOSU (MADALYALI) ---
async function openLeaderboard() {
    document.getElementById('leaderboardModal').style.display = 'flex';
    const list = document.getElementById('leaderboard-content');
    list.innerHTML = "<div style='text-align:center; padding:30px; color:#888;'><i class='bx bx-loader-alt bx-spin' style='font-size:30px;'></i><br>Sıralama Hesaplanıyor...</div>";

    try {
        const res = await fetch('/social/leaderboard');
        const data = await res.json();

        if (data.length === 0) {
            list.innerHTML = "<div style='text-align:center; padding:20px; color:#aaa;'>Henüz kazanan yok. <br>İlk düelloyu sen yap!</div>";
            return;
        }

        let html = "";
        data.forEach((item, index) => {
            let rankClass = "rank-badge"; // Varsayılan gri
            let rankContent = index + 1;
            let borderStyle = "border: 1px solid #eee;";
            let bgStyle = "background: #fff;";

            // İLK 3 İÇİN ÖZEL STİL
            if (index === 0) { // 🥇 BİRİNCİ
                rankContent = "🥇";
                bgStyle = "background: linear-gradient(to right, #fff, #fff9c4);"; // Hafif sarı
                borderStyle = "border: 2px solid #ffd700;";
            } else if (index === 1) { // 🥈 İKİNCİ
                rankContent = "🥈";
                borderStyle = "border: 2px solid #c0c0c0;";
            } else if (index === 2) { // 🥉 ÜÇÜNCÜ
                rankContent = "🥉";
                borderStyle = "border: 2px solid #cd7f32;";
            }

            // Avatar Kontrolü
            const avatarHtml = item.top_url 
                ? `<img src="${item.top_url}" class="leader-avatar">` 
                : `<div class="leader-avatar" style="background:#eee; display:flex; align-items:center; justify-content:center;"><i class='bx bx-user'></i></div>`;

            html += `
                <div class="leader-item" style="${bgStyle} ${borderStyle} padding:12px; margin-bottom:10px; border-radius:16px; display:flex; align-items:center; gap:15px; box-shadow:0 3px 10px rgba(0,0,0,0.05);">
                    <div style="font-size:20px; font-weight:bold; width:30px; text-align:center;">${rankContent}</div>
                    ${avatarHtml}
                    <div style="flex:1;">
                        <div style="font-weight:700; font-size:15px; color:#333;">${item.user_name || 'Kullanıcı'}</div>
                        <div style="font-size:11px; color:#888;">@${item.username_handle}</div>
                    </div>
                    <div class="leader-score" style="text-align:center;">
                        <div style="font-size:18px; font-weight:900; color:var(--primary-color);">${item.duel_wins}</div>
                        <div style="font-size:9px; color:#aaa; font-weight:600;">GALİBİYET</div>
                    </div>
                </div>
            `;
        });

        list.innerHTML = html;

    } catch (e) {
        console.error(e);
        list.innerHTML = "<div style='text-align:center; color:red;'>Sıralama yüklenemedi.</div>";
    }
}

        // --- COMMENTS SYSTEM ---
        let currentPostIdForComments = null;
        function openComments(postId) { currentPostIdForComments = postId; document.getElementById('commentBackdrop').style.display = 'block'; document.getElementById('commentModal').classList.add('open'); loadComments(postId); }
        function closeComments() { document.getElementById('commentBackdrop').style.display = 'none'; document.getElementById('commentModal').classList.remove('open'); currentPostIdForComments = null; }
        async function loadComments(postId) {
            const list = document.getElementById('commentList'); list.innerHTML = "<div style='text-align:center; color:#aaa; margin-top:20px;'>Yükleniyor...</div>";
            try {
                const res = await fetch(`/social/comments/${postId}`); const data = await res.json(); list.innerHTML = "";
                if (data.length === 0) { list.innerHTML = "<div style='text-align:center; color:#ccc; margin-top:20px;'>Henüz yorum yok. İlk sen yaz! 👇</div>"; return; }
                data.forEach(c => { const avatar = c.avatar_url ? `<img src="${c.avatar_url}">` : `<i class='bx bx-user' style='padding:5px;'></i>`; const html = `<div class="comment-item"><div class="comment-avatar">${avatar}</div><div class="comment-bubble"><div class="comment-user">@${c.username}</div>${c.text}</div></div>`; list.insertAdjacentHTML('beforeend', html); });
                list.scrollTop = list.scrollHeight;
            } catch (e) { console.error(e); list.innerHTML = "Yorumlar yüklenemedi."; }
        }
        async function sendComment() {
            const input = document.getElementById('commentInput'); const text = input.value.trim(); if (!text || !currentPostIdForComments) return;
            const myUser = localStorage.getItem("userName");
            const tempHtml = `<div class="comment-item" style="opacity:0.7;"><div class="comment-avatar"><i class='bx bx-user' style='padding:5px;'></i></div><div class="comment-bubble"><div class="comment-user">@${myUser}</div>${text}</div></div>`;
            document.getElementById('commentList').insertAdjacentHTML('beforeend', tempHtml); document.getElementById('commentList').scrollTop = document.getElementById('commentList').scrollHeight; input.value = "";
            await fetch('/social/comment', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ post_id: currentPostIdForComments, username: myUser, text: text }) });
            loadComments(currentPostIdForComments);
        }

        // --- GENERAL UTILS ---
        function openFilterModal(t) {
    const m = document.getElementById('filterModal');
    const c = document.getElementById('filter-options-container');
    const title = document.getElementById('filter-modal-title');
    
    c.innerHTML = "";
    m.style.display = 'flex';
    
    // Başlığı ayarla
    title.innerText = t === 'season' ? 'Mevsim Seç' : 'Tarz Seç';

    // Seçenekleri belirle
    const o = t === 'season' 
        ? [{v:'yaz',t:'Yazlık'}, {v:'kis',t:'Kışlık'}, {v:'mevsimlik',t:'Mevsimlik'}] 
        : [{v:'gunluk',t:'Günlük'}, {v:'ofis',t:'Ofis'}, {v:'spor',t:'Spor'}, {v:'ozel',t:'Özel'}];

    o.forEach(x => {
        // Hangi butonun seçili olduğunu kontrol et
        const isActive = (t === 'season' ? activeSeasonFilter : activeStyleFilter) === x.v;
        
        const b = document.createElement('div');
        b.className = `option-btn ${isActive ? 'sel' : ''}`;
        b.innerText = x.t;
        
        b.onclick = () => {
            if (t === 'season') {
                activeSeasonFilter = x.v;
                // DÜZELTME BURADA: Yeni ID 'pill-season-text' kullanıldı
                document.getElementById('pill-season-text').innerText = x.t;
            } else {
                activeStyleFilter = x.v;
                // DÜZELTME BURADA: Yeni ID 'pill-style-text' kullanıldı
                document.getElementById('pill-style-text').innerText = x.t;
            }
            m.style.display = 'none';
        };
        c.appendChild(b);
    });
}
        
}
        function closeCategory(){document.getElementById('wardrobe-detail-view').style.display='none';document.getElementById('wardrobe-main-view').style.display='flex';loadStats();}

function openCategory(c,t){activeWardrobeTab=c;document.getElementById('wardrobe-main-view').style.display='none';document.getElementById('wardrobe-detail-view').style.display='block';document.getElementById('detail-title').innerText=t;loadWardrobe();}
function closeCategory(){document.getElementById('wardrobe-detail-view').style.display='none';document.getElementById('wardrobe-main-view').style.display='flex';loadStats();}
async function loadWardrobe() {
    const l = document.getElementById('wardrobe-list');
    l.innerHTML = "<div style='text-align:center; color:#888;'>Yükleniyor...</div>";

    try {
        const r = await fetch(`/clothes/?username=${localStorage.getItem("userName")}`);
        const i = await r.json();
        const f = i.filter(x => x.category === activeWardrobeTab);

        l.innerHTML = "";
        if (f.length === 0) {
            l.innerHTML = "<div style='text-align:center;'>Bu kategoride kıyafet yok.</div>";
            return;
        }

        f.forEach(x => {
            const d = document.createElement('div');
            d.className = 'wardrobe-item';
            
            const colorSafe = x.color_name || 'Bilinmiyor';
            
            d.onclick = () => openItemActionModal(x.id, x.url, colorSafe);
            d.innerHTML = `<div class="wear-count-badge">${x.wear_count}</div><img src="${x.url}">`;
            l.appendChild(d);
        });
    } catch (e) {
        console.error(e);
        l.innerHTML = "Hata oluştu.";
    }
}
    
async function openShowcase(type, title) {

    const username = localStorage.getItem("userName");
    console.log("İstek Atılan Kullanıcı:", username);
    currentViewContext = { type: 'showcase', param: type, title: title };

    document.getElementById('wardrobe-main-view').style.display = 'none';
    document.getElementById('wardrobe-detail-view').style.display = 'block';
    document.getElementById('detail-title').innerText = title;
    
    const listContainer = document.getElementById('wardrobe-list');
    listContainer.innerHTML = "<div style='text-align:center; padding:20px; color:#888;'><i class='bx bx-loader-alt bx-spin' style='font-size:30px;'></i><br>Yükleniyor...</div>";

    try {
        const username = localStorage.getItem("userName");
  
        const res = await fetch(`/clothes/showcase/${type}?username=${username}&t=${new Date().getTime()}`);
        const items = await res.json();

        listContainer.innerHTML = "";

        if (!items || items.length === 0) {
            listContainer.innerHTML = "<div style='text-align:center; padding:20px; color:#aaa;'>Liste boş.</div>";
            return;
        }

        items.forEach(x => {
            const div = document.createElement('div');
            div.className = 'wardrobe-item';
            
            // Tıklama olayını doğru nesneye bağla
            div.onclick = function() {
                openItemActionModal(x);
            };
            
            // Rozet Stilleri
            let badgeStyle = '';
            let badgeIcon = '';
            if(type === 'dusty') {
                badgeStyle = 'background: #ff7675;'; 
                badgeIcon = "<i class='bx bx-time-five' style='margin-left:2px; font-size:9px;'></i>";
            } else if (type === 'new') {
                badgeStyle = 'background: #74b9ff;';
                badgeIcon = "<i class='bx bxs-star' style='margin-left:2px; font-size:9px;'></i>";
            }

            div.innerHTML = `
                <div class="wear-count-badge" style="${badgeStyle}">
                    ${x.wear_count} ${badgeIcon}
                </div>
                <img src="${x.url}" loading="lazy">
            `;
            listContainer.appendChild(div);
        });

    } catch (e) {
        console.error(e);
        listContainer.innerHTML = "<div style='text-align:center; color:red;'>Hata oluştu.</div>";
    }
}
    
function refreshCurrentView() {
    // Kaydettiğimiz duruma göre doğru sayfayı yenile
    if (currentViewContext.type === 'showcase') {
        openShowcase(currentViewContext.param, currentViewContext.title);
    } else {
        // Varsayılan olarak kategori yükle
        loadWardrobe(); 
    }
}

function openItemActionModal(data, directUrl = null, colorName = "", currentSeason = "") {
    let finalId = data;
    let finalUrl = directUrl;
    let finalColor = colorName;
    let finalSeason = currentSeason;

    // --- AKILLI KONTROL ---
    // Eğer gelen 'data' bir obje ise (Vitrin'den geliyorsa) parçala
    if (typeof data === "object" && data !== null) {
        finalId = data.id;
        finalUrl = data.url;
        finalColor = data.color_name || "";
        finalSeason = data.season || "";
    }

    // ID Kontrolü
    if (!finalId || typeof finalId === "object") {
        console.error("HATA: ID alınamadı.", data);
        return; 
    }
    
    // URL Kontrolü (Resim yoksa DOM'dan bul)
    if(!finalUrl) {
        const imgEl = document.querySelector(`img[data-id="${finalId}"]`);
        if(imgEl) {
            finalUrl = imgEl.src;
            if(!finalColor) finalColor = imgEl.getAttribute('data-color') || "";
        }
    }
    if(!finalUrl) finalUrl = "";
    
    // Global değişkene atayalım (Yedek olarak)
    currentItemIdToDelete = finalId; 
    
    const modal = document.getElementById('itemActionModal');
    const safeSeason = finalSeason || "mevsimlik";

    // Modal İçeriği
    // DİKKAT: deleteCurrentItem fonksiyonuna finalId'yi doğrudan gönderiyoruz!
    modal.querySelector('.modal-card').innerHTML = `
        <i class='bx bx-x' style="position:absolute; top:15px; right:15px; font-size:24px;"
        onclick="document.getElementById('itemActionModal').style.display='none'"></i>
        <h3>İşlem Seç (ID: ${finalId})</h3>
        
        <button class="magic-btn" onclick="openEditItemModal('${finalId}')" style="background:var(--card-bg); color:var(--text-dark); border:1px solid var(--border-color); margin-top:10px; width:100%;">
            <i class='bx bx-edit'></i> Düzenle
        </button>

        <button class="magic-btn" onclick="deleteCurrentItem('${finalId}')" style="background:#ff4d4d; margin-top:10px; width:100%;">
            <i class='bx bx-trash'></i> Bu Parçayı Sil
        </button>
    `;
    modal.style.display = 'flex';
}

function openEditItemModal(id) {
    
    document.getElementById('itemActionModal').style.display = 'none';
    document.getElementById('editItemId').value = id;
    document.getElementById('editItemModal').style.display = 'flex';
    
}

async function saveItemUpdate() {
    const id = document.getElementById('editItemId').value;
    const cat = document.getElementById('editCategory').value;
    const seas = document.getElementById('editSeason').value;
    const sty = document.getElementById('editStyle').value;
    
    const btn = document.querySelector('#editItemModal .magic-btn');
    const oldText = btn.innerText;
    btn.innerText = "Kaydediliyor...";
    btn.disabled = true;

    try {
        const res = await fetch('/clothes/update', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                id: parseInt(id),
                category: cat,
                season: seas,
                style: sty
            })
        });
        
        const data = await res.json();
        
        if(data.status === 'success') {
            showToast("Parça Güncellendi! ✅");
            
            // Modalı Kapat
            if(typeof closeEditModal === 'function') {
                closeEditModal();
            } else {
                document.getElementById('editItemModal').style.display = 'none';
            }
            
            // --- KRİTİK GÜNCELLEME BURASI ---
            // Hangi ekrandaysak (Vitrin, Kategori vb.) orayı yenile
            if (typeof refreshCurrentView === 'function') {
                refreshCurrentView();
            } else {
                // Yedek (Eski yöntem)
                loadWardrobe(); 
            }
            // ---------------------------------

            // İstatistikleri de güncelle
            if(typeof loadStats === 'function') loadStats();

        } else {
            showToast("Hata: " + (data.error || data.detail || "Bilinmeyen hata"));
        }
    } catch(e) {
        console.error(e);
        showToast("Bağlantı hatası.");
    } finally {
        btn.innerText = oldText;
        btn.disabled = false;
    }
}

       async function deleteCurrentItem(forceId = null) {
    // ID'yi önce parametreden (forceId), yoksa global değişkenden al
    const idToDelete = forceId || currentItemIdToDelete;

    // Konsola yazdıralım ki hata varsa görelim
    console.log("Silme işlemi başlatıldı. Silinecek ID:", idToDelete);

    if (!idToDelete || typeof idToDelete === 'object') {
        alert("Hata: Silinecek öğe ID'si algılanamadı!");
        console.error("Silme Hatası: Geçersiz ID ->", idToDelete);
        return;
    }

    if (!confirm("Bu kıyafeti dolabından silmek istediğine emin misin?")) return;

    // Yükleme ekranını varsa göster
    try { if(typeof showLoading === 'function') showLoading(true); } catch(e){}

    try {
        const response = await fetch(`/clothes/${idToDelete}`, {
            method: "DELETE"
        });

        if (response.ok) {
            showToast("Parça başarıyla silindi. 🗑️");
            
            // Modalı kapat
            const modal = document.getElementById('itemActionModal');
            if(modal) modal.style.display='none';

            // --- KRİTİK GÜNCELLEME BURASI ---
            // Eski 'loadWardrobe' yerine, hangi sayfada olduğumuzu bilen 
            // 'refreshCurrentView' fonksiyonunu çağırıyoruz.
            if (typeof refreshCurrentView === 'function') {
                refreshCurrentView();
            } else {
                // Eğer fonksiyon bulunamazsa yedek olarak eskisi çalışsın
                loadWardrobe(); 
            }
            // ---------------------------------
            
            // İstatistikleri de yenile
            if(typeof loadStats === 'function') loadStats();

        } else {
            const err = await response.text();
            alert("Silinemedi: " + err);
        }
    } catch (error) {
        console.error("Silme hatası:", error);
        alert("Sunucuyla iletişim hatası oluştu.");
    } finally {
        try { if(typeof showLoading === 'function') showLoading(false); } catch(e){}
    }
}
        
        async function shareOutfit(){const t=document.getElementById('img-ust').dataset.id;const b=document.getElementById('img-alt').dataset.id;if(!t||!b)return showToast("Önce kombin yap!");if(confirm("Keşfet'te Paylaş?")){await fetch('/social/share',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({user_name:localStorage.getItem("full_name"),username_handle:localStorage.getItem("userName"),top_id:t,bottom_id:b,shoe_id:document.getElementById('img-ayakkabi').dataset.id})});showToast("Kombin Paylaşıldı! 🚀");}}
        function openSavedOutfitsModal(){document.getElementById('savedOutfitsModal').style.display='flex';loadSavedOutfits();}
        function closeSavedOutfitsModal(){document.getElementById('savedOutfitsModal').style.display='none';}
        
        // --- İSTATİSTİKLERİ VE SAYAÇLARI YÜKLEME ---
async function loadStats() {
    const u = localStorage.getItem("userName");
    if (!u) return;

    try {
        const r = await fetch(`/stats/?username=${u}`);
        const d = await r.json();

        // 1. Profil Sayfasındaki Genel Sayılar (Eski tasarım uyumluluğu için)
        if (document.getElementById('stat-clothes')) document.getElementById('stat-clothes').innerText = d.clothes || 0;
        if (document.getElementById('stat-outfits')) document.getElementById('stat-outfits').innerText = d.outfits || 0;

        // 2. KATEGORİ SAYAÇLARI
        const cats = d.categories || {};

        // Ana kategorileri güncelle
        if (document.getElementById('count-ust-modern')) {
            document.getElementById('count-ust-modern').innerText = (cats['ust_giyim'] || 0) + " Parça";
            document.getElementById('count-alt-modern').innerText = (cats['alt_giyim'] || 0) + " Parça";
            document.getElementById('count-elbise-modern').innerText = (cats['elbise'] || 0) + " Parça";
            document.getElementById('count-ayakkabi-modern').innerText = (cats['ayakkabi'] || 0) + " Parça";
        }

        // Aksesuar sayacını güncelle (Eksik olan kısım burasıydı, şimdi yerinde)
        if (document.getElementById('count-aksesuar-modern')) {
            document.getElementById('count-aksesuar-modern').innerText = (cats['aksesuar'] || 0) + " Parça";
        }

        // 3. TOPLAM SAYI HESAPLAMA (Profil Vitrini İçin)
        // Burayı tek bir blokta topladık ki hesap hatası olmasın.
        if (document.getElementById('stat-total-clothes')) {
             const total = (cats['ust_giyim'] || 0) + 
                           (cats['alt_giyim'] || 0) + 
                           (cats['elbise'] || 0) + 
                           (cats['ayakkabi'] || 0) + 
                           (cats['aksesuar'] || 0); // Aksesuarları toplama dahil ettik
             
             document.getElementById('stat-total-clothes').innerText = total;
        }

        // 4. Grafikler (Elementler sayfada varsa çiz)
        const styles = (d.styles && Object.keys(d.styles).length > 0) ? d.styles : { 'Veri Yok': 1 };
        const seasons = (d.seasons && Object.keys(d.seasons).length > 0) ? d.seasons : { 'Veri Yok': 1 };
        
        if (document.getElementById('styleChart')) {
            renderCharts(styles, seasons);
        }

    } catch (err) {
        console.error("İstatistik yükleme hatası:", err);
    }
}
        function renderCharts(s,sea){ const c1=document.getElementById('styleChart'); const c2=document.getElementById('seasonChart'); if(!c1 || !c2) return; if(styleChart) styleChart.destroy(); styleChart=new Chart(c1.getContext('2d'),{ type:'doughnut', data:{ labels:Object.keys(s), datasets:[{ data:Object.values(s), backgroundColor:['#a2a1ff','#8c8bfb','#ff9f43','#54a0ff','#ccc'], borderWidth:0 }] }, options:{cutout:'70%',plugins:{legend:{display:false}}} }); if(seasonChart) seasonChart.destroy(); seasonChart=new Chart(c2.getContext('2d'),{ type:'bar', data:{ labels:Object.keys(sea), datasets:[{ label:'', data:Object.values(sea), backgroundColor:'#8c8bfb', borderRadius:5 }] }, options:{plugins:{legend:{display:false}},scales:{x:{grid:{display:false}},y:{display:false}}} }); }
        function loadOutfitFromProfile(i) {
    // Hafızadan ilgili kombini seç
    const x = savedOutfitsData[i];
    if (!x) return; 

    // Kombin sayfasına geç
    switchPage('kombin');

    // --- MOD KONTROLÜ VE YÜKLEME ---
    // Eğer alt giyim ID'si yoksa veya 0 ise bu bir elbisedir
    if (!x.bottom_id || x.bottom_id == 0) {
        setOutfitMode('elbise'); // Elbise moduna geç
        updateCard('elbise', { id: x.top_id, url: x.top_url });
    } else {
        setOutfitMode('normal'); // Normal moda geç
        updateCard('ust', { id: x.top_id, url: x.top_url });
        updateCard('alt', { id: x.bottom_id, url: x.bottom_url });
    }

    // Ayakkabı varsa yükle, yoksa gizle
    if (x.shoe_id && x.shoe_url) {
        updateCard('ayakkabi', { id: x.shoe_id, url: x.shoe_url });
    } else {
        hideCard('ayakkabi');
    }

    // "Bunu Giyeceğim" butonunu ortaya çıkar
    document.getElementById('btn-wear-container').classList.add('show');
}
        function checkCity(){ 
        const c = localStorage.getItem("userCity") || "İstanbul"; 
        fetchWeather(c); 
    }
    
    function openCityModal(){ 
        console.log("Şehir paneli açılıyor..."); // Hata takibi için

        // 1. Ayarlar menüsünü bul ve kapat (Varsa)
        const settings = document.getElementById('settingsMenu');
        if (settings) {
            settings.style.display = 'none';
        }

        // 2. Şehir modalını bul
        const modal = document.getElementById('cityModal');
        
        // 3. Modal varsa aç, yoksa hata verme
        if (modal) {
            modal.style.display = 'flex'; 
            
            // Mevcut şehri seçili getir
            const current = localStorage.getItem("userCity") || "İstanbul";
            const selectBox = document.getElementById('citySelect');
            if (selectBox) selectBox.value = current;
        } else {
            console.error("HATA: 'cityModal' isimli kutu HTML'de yok!");
            alert("Hata: Şehir seçim penceresi kodlarda bulunamadı.");
        }
    }
    
    function saveCity(){ 
        const citySelect = document.getElementById('citySelect');
        if(!citySelect) return;

        const city = citySelect.value; 
        if(!city) {
            showToast("Lütfen listeden bir şehir seçin.");
            return;
        }

        // Kaydet ve Yenile
        localStorage.setItem("userCity", city); 
        
        // Modalı Kapat
        const modal = document.getElementById('cityModal');
        if(modal) modal.style.display='none'; 
        
        // Hava durumunu güncelle
        fetchWeather(city); 
        showToast("Konum Güncellendi: " + city + " 🌤️");
    }

    async function fetchWeather(c) {
        // EMNİYET KİLİDİ: Şehir listede yoksa İstanbul yap ve devam et
        if (!cityCoords[c]) { 
            console.error("Şehir verisi hatalı, İstanbul'a dönülüyor:", c); 
            c = "İstanbul";
            localStorage.setItem("userCity", "İstanbul");
        }

        try {
            const r = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${cityCoords[c].lat}&longitude=${cityCoords[c].lon}&current_weather=true`);
            const d = await r.json();
            const t = Math.round(d.current_weather.temperature);
            
            // Hava Durumu Göstergesini Güncelle
            document.getElementById("weather-display").innerHTML = `<i class='bx bx-map'></i> ${c} ${t}°C`;
            
            // Mevsime göre otomatik öneri metni
            let newText = "Mevsimlik";
            if (t >= 22) { activeSeasonFilter = 'yaz'; newText = "Yazlık"; } 
            else if (t <= 15) { activeSeasonFilter = 'kis'; newText = "Kışlık"; } 
            else { activeSeasonFilter = 'mevsimlik'; newText = "Mevsimlik"; }
            
            const seasonTextEl = document.getElementById('pill-season-text');
            if(seasonTextEl) seasonTextEl.innerText = newText;

        } catch (e) { 
            console.log("Hava durumu hatası:", e);
            document.getElementById("weather-display").innerHTML = `<i class='bx bx-map'></i> ${c} --°C`;
        }
    }
        function showHero(i){document.getElementById('daily-hero-card').style.display='flex';document.getElementById('hero-img').src=i.url;document.getElementById('hero-msg').innerText=i.message;}
        function openPlanModal(){document.getElementById('planModal').style.display='flex';}
        async function savePlan(d){const t=document.getElementById('img-ust').dataset.id;if(!t)return showToast("Kombin yok!");const date=new Date();d==='tomorrow'?date.setDate(date.getDate()+1):date.setDate(date.getDate()+2);await fetch('/calendar/add',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({date_str:date.toISOString().split('T')[0],top_id:t,bottom_id:document.getElementById('img-alt').dataset.id,shoe_id:document.getElementById('img-ayakkabi').dataset.id,username:localStorage.getItem("userName")})});showToast("Takvime Eklendi 📅");document.getElementById('planModal').style.display='none';}
        async function checkTodaysPlan(){const t=new Date().toISOString().split('T')[0];try{const r=await fetch(`/calendar/check/${localStorage.getItem("userName")}/${t}`);const d=await r.json();if(!d.empty){document.getElementById('today-plan-card').style.display='flex';document.getElementById('today-plan-card').onclick=()=>{updateCard('ust',{id:d.top_id,url:d.top_url});updateCard('alt',{id:d.bottom_id,url:d.bottom_url});if(d.shoe_id)updateCard('ayakkabi',{id:d.shoe_id,url:d.shoe_url});document.getElementById('today-plan-card').style.display='none';}}}catch(e){}}
        function openTravelModal(){document.getElementById('travelModal').style.display='flex';}
        // --- SEYAHAT MODÜLÜ YARDIMCILARI ---

// 1. Gün Sayısı Değiştirici (+ / - Butonları için)
function changeTravelDays(delta) {
    const input = document.getElementById('travelDays');
    let val = parseInt(input.value) + delta;
    if(val < 1) val = 1;   // En az 1 gün
    if(val > 14) val = 14; // En fazla 14 gün (Sınır koyalım)
    input.value = val;
}

// 2. Hava Durumu Seçimi (Kart Görünümü İçin)
function selTravelSeason(s, element) {
    travelSeason = s;
    // Tüm kartlardan 'sel' sınıfını kaldır
    const cards = element.parentElement.querySelectorAll('.travel-weather-card');
    cards.forEach(card => card.classList.remove('sel'));
    // Tıklanana ekle
    element.classList.add('sel');
}

// 3. Bavul Hazırlama (Animasyonlu)
async function packSuitcase() {
    const d = document.getElementById('travelDays').value;
    const dest = document.getElementById('travelDest').value;
    const btn = document.getElementById('btn-pack');
    
    // Basit doğrulama
    if(!dest) return showToast("Nereye gidiyorsun? ✈️");

    // Buton Animasyonu Başlat
    const originalText = btn.innerHTML;
    btn.innerHTML = "<i class='bx bx-loader-alt bx-spin'></i> Hazırlanıyor...";
    btn.disabled = true;

    try {
        const r = await fetch('/travel/pack', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                days: parseInt(d),
                season: travelSeason,
                destination: dest,
                username: localStorage.getItem("userName")
            })
        });
        
        const data = await r.json();
        
        if (data.error) {
            showToast(data.error);
        } else {
            // Başarılı!
            document.getElementById('travelModal').style.display = 'none';
            showToast("Bavulun Hazır! 🧳");
            
            // Konfeti Patlat
            try { confetti({ particleCount: 150, spread: 100, origin: { y: 0.6 } }); } catch(e){}
            
            // Planları Aç
            openPlansModal();
        }
    } catch (e) {
        console.error(e);
        showToast("Bir hata oluştu.");
    } finally {
        // Butonu eski haline getir
        btn.innerHTML = originalText;
        btn.disabled = false;
    }
}
// --- KİRLİ SEPETİ FONKSİYONLARI ---

let selectedDirtyItems = []; // Yıkanacakların ID listesi

async function openLaundryModal() {
    const modal = document.getElementById('laundryModal');
    const list = document.getElementById('laundry-list');
    const emptyMsg = document.getElementById('laundry-empty-msg');
    const actionArea = document.getElementById('laundry-actions');
    
    modal.style.display = 'flex';
    list.innerHTML = "<div style='grid-column:span 3; text-align:center; color:#888;'><i class='bx bx-loader-alt bx-spin'></i> Yükleniyor...</div>";
    actionArea.style.display = 'none';
    selectedDirtyItems = []; // Listeyi sıfırla

    try {
        const username = localStorage.getItem("userName");
        // Backend'den kirlileri çek
        const res = await fetch(`/clothes/dirty/${username}`);
        const items = await res.json();

        list.innerHTML = "";

        if (items.length === 0) {
            list.style.display = 'none';
            emptyMsg.style.display = 'block';
        } else {
            list.style.display = 'grid';
            emptyMsg.style.display = 'none';
            actionArea.style.display = 'block';

            items.forEach(item => {
                const div = document.createElement('div');
                div.className = 'laundry-item';
                div.setAttribute('data-id', item.id);
                // Varsayılan olarak hepsi seçili gelsin mi? Hayır, kullanıcı seçsin.
                
                div.style.cssText = `
                    position: relative; 
                    cursor: pointer; 
                    border-radius: 15px; 
                    overflow: hidden; 
                    border: 2px solid transparent;
                    transition: 0.2s;
                    aspect-ratio: 1/1;
                `;

                div.innerHTML = `
                    <div class="check-overlay" style="position:absolute; top:5px; right:5px; width:20px; height:20px; background:rgba(0,0,0,0.1); border-radius:50%; display:flex; align-items:center; justify-content:center; border:1px solid white;">
                        <i class='bx bx-check' style="color:white; display:none;"></i>
                    </div>
                    <img src="${item.url}" style="width:100%; height:100%; object-fit:contain; filter: grayscale(100%);">
                    <div style="position:absolute; bottom:0; width:100%; background:rgba(0,0,0,0.5); color:white; font-size:10px; text-align:center; padding:2px;">Kirli</div>
                `;

                div.onclick = () => toggleDirtySelection(div, item.id);
                list.appendChild(div);
            });
        }
    } catch (e) {
        console.error(e);
        list.innerHTML = "Hata oluştu.";
    }
}

function toggleDirtySelection(el, id) {
    const checkIcon = el.querySelector('.bx-check');
    const checkBg = el.querySelector('.check-overlay');
    
    if (selectedDirtyItems.includes(id)) {
        // Seçimi Kaldır
        selectedDirtyItems = selectedDirtyItems.filter(x => x !== id);
        el.style.borderColor = "transparent";
        checkBg.style.background = "rgba(0,0,0,0.1)";
        checkIcon.style.display = "none";
    } else {
        // Seç (Yıkanacak)
        selectedDirtyItems.push(id);
        el.style.borderColor = "#00bcd4"; // Mavi çerçeve
        checkBg.style.background = "#00bcd4";
        checkIcon.style.display = "block";
    }
}

async function washSelectedClothes() {
    if (selectedDirtyItems.length === 0) return showToast("Yıkanacak bir şey seçmedin.");
    
    const btn = document.querySelector('#laundry-actions .magic-btn');
    const oldHtml = btn.innerHTML;
    btn.innerHTML = "<i class='bx bx-loader-alt bx-spin'></i> Yıkanıyor...";
    btn.disabled = true;

    try {
        const res = await fetch('/clothes/wash_selected', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ item_ids: selectedDirtyItems })
        });
        
        const data = await res.json();
        
        if (data.status === 'success') {
            showToast("Giysiler yıkandı ve dolaba asıldı! 🧼✨");
            // Konfeti
            try { confetti({ colors: ['#a29bfe', '#74b9ff'] }); } catch(e){}
            
            // Listeyi yenile
            openLaundryModal(); 
            // Ana istatistikleri yenile (varsa)
            if(typeof loadStats === 'function') loadStats();
        } else {
            showToast("Hata oluştu.");
        }
    } catch(e) {
        console.error(e);
        showToast("Bağlantı hatası.");
    } finally {
        btn.innerHTML = oldHtml;
        btn.disabled = false;
    }
}

// Tekil bir ürünü kirli sepetine atma (Kombin ekranındaki su damlası butonu için)
async function markAsDirty(type) {
    let id = null;
    if (type === 'aksesuar') {
         // Aksesuar için
         const img = document.getElementById('img-aksesuar');
         if(img && img.style.display !== 'none') id = img.getAttribute('data-id');
    } else {
    }

    if (!id) return showToast("Seçili bir parça yok.");

    if(!confirm("Bu parçayı kirli sepetine atmak istiyor musun?")) return;

    try {
        await fetch('/clothes/dirty_selected', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ item_ids: [parseInt(id)] })
        });
        showToast("Kirli sepetine atıldı 🧺");
        // Ekrandan kaldırabiliriz veya olduğu gibi bırakabiliriz
    } catch(e) {
        showToast("Hata oluştu.");
    }
}
        function toggleTheme(){const b=document.body;const t=b.getAttribute('data-theme')==='dark'?'light':'dark';b.setAttribute('data-theme',t);localStorage.setItem('appTheme',t);document.getElementById('theme-switch').checked=(t==='dark');}
        function loadTheme(){const t=localStorage.getItem('appTheme');if(t){document.body.setAttribute('data-theme',t);document.getElementById('theme-switch').checked=(t==='dark');}}
        function resetApp(){if(confirm("Çıkış?")){localStorage.clear();location.reload();}}
        function openUploadModal() {
    document.getElementById('uploadModal').style.display = 'flex';
    
    // 1. Dropdown'da doğru kategoriyi seç
    const catSelect = document.getElementById('uploadCategorySelect');
    catSelect.value = activeWardrobeTab;

    // 2. ÖNEMLİ: Görünümü güncellemek için fonksiyonu manuel çalıştır!
    // Bu sayede modal açılır açılmaz "Mevsim" gizlenir, "Aksesuar Türü" gelir.
    toggleSubCategory(activeWardrobeTab);
}
        function closeUploadModal(){document.getElementById('uploadModal').style.display='none';document.getElementById('status').innerText="";}
        function selSeason(s,b){uploadSeason=s;b.parentNode.querySelectorAll('.option-btn').forEach(x=>x.classList.remove('sel'));b.classList.add('sel');}
        function selStyle(s,b){uploadStyle=s;b.parentNode.querySelectorAll('.option-btn').forEach(x=>x.classList.remove('sel'));b.classList.add('sel');}
        // --- YENİ EKLENECEK FONKSİYON ---
function toggleSubCategory(val) {
    // 1. Global değişkeni güncelle (Önemli)
    activeWardrobeTab = val; 
    
    // 2. Kutuları seç
    const subWrapper = document.getElementById('subCategoryWrapper');
    const seasonWrapper = document.getElementById('seasonWrapper');
    
    // 3. Kontrol Et: Seçilen şey 'aksesuar' mı?
    if (val === 'aksesuar') {
        // EVET, AKSESUAR:
        // - Aksesuar detaylarını (Saat, çanta vb.) GÖSTER
        if(subWrapper) subWrapper.style.display = 'block';
        
        // - Mevsim seçimini (Yazlık/Kışlık) GİZLE
        if(seasonWrapper) seasonWrapper.style.display = 'none';

        // - Arka planda hata vermemesi için mevsimi otomatik 'mevsimlik' yap
        uploadSeason = 'mevsimlik';

    } else {
        // HAYIR, AKSESUAR DEĞİL (Tişört, Pantolon vb.):
        // - Aksesuar detaylarını GİZLE
        if(subWrapper) subWrapper.style.display = 'none';
        
        // - Mevsim seçimini GÖSTER
        if(seasonWrapper) seasonWrapper.style.display = 'block';
    }
}

   async function uploadRun() {
    const f = document.getElementById('fileIn').files;
    const s = document.getElementById('status');

    // Dosya seçilip seçilmediğini kontrol et
    if (f.length === 0) return showToast("Fotoğraf Seçmelisin");

    // Butonu kilitle
    document.getElementById('saveBtn').disabled = true;

    // Seçilen dosyaları döngüyle yükle
    for (let i = 0; i < f.length; i++) {
        s.innerText = `${i + 1}/${f.length} Yükleniyor...`;

        const fd = new FormData();
        fd.append('file', f[i]);
        fd.append('category', activeWardrobeTab);

        // --- AKSESUAR ALT TÜRÜ ---
        let subCat = "";
        if (activeWardrobeTab === 'aksesuar') {
            const subSelect = document.getElementById('uploadSubCategory');
            if (subSelect) {
                subCat = subSelect.value;
            }
        }
        fd.append('sub_category', subCat);
        // -------------------------

        fd.append('season', uploadSeason);
        fd.append('style', uploadStyle);
        fd.append('username', localStorage.getItem("userName"));

        try {
            // Backend'e gönder
            const res = await fetch('/process/', { method: 'POST', body: fd });
            const data = await res.json(); // Cevabı JSON olarak al

            // --- GÜNCELLEME BURASI ---
            if (data.error) {
                // Eğer backend "Bu resim zaten var" derse:
                showToast("⚠️ " + data.error);
            } else if (data.message) {
                // Eğer başarılıysa ve XP mesajı varsa:
                // (Örn: "Kıyafet eklendi! (+5 XP)")
                showToast("✅ " + data.message);
            }
            // -------------------------

        } catch (e) {
            console.error("Yükleme hatası:", e);
            showToast("Bağlantı hatası oluştu.");
        }
    }

    s.innerText = "Bitti!";
    setTimeout(() => {
        closeUploadModal();
        loadWardrobe(); // Listeyi yenile
        loadStats();    // İstatistikleri (XP/Lig) yenile
        document.getElementById('saveBtn').disabled = false;
    }, 1000);
} 
        function switchPage(p,n){document.querySelectorAll('.page').forEach(x=>x.classList.remove('active'));document.getElementById('page-'+p).classList.add('active');document.querySelectorAll('.nav-item').forEach(x=>x.classList.remove('active-nav'));if(n)n.classList.add('active-nav');else if(p==='kombin')document.querySelectorAll('.nav-item')[1].classList.add('active-nav');if(p==='dolabim'){loadStats();document.getElementById('wardrobe-main-view').style.display='flex';document.getElementById('wardrobe-detail-view').style.display='none';}if(p==='profil'&&n)loadProfileData(localStorage.getItem("userName"));if(p==='kesfet')loadSocialFeed();}
            function openEventModal() {
            document.getElementById('eventModal').style.display = 'flex';
        }

        async function selectEvent(eventType) {
            document.getElementById('eventModal').style.display = 'none';
            const btn = document.querySelector('.magic-btn');
            const originalText = btn.innerHTML;
            btn.innerText = "Etkinlik Hazırlanıyor...";
            btn.disabled = true;

            try {
                const u = localStorage.getItem("userName");
                const r = await fetch(`/recommend/?season=${activeSeasonFilter}&style=${activeStyleFilter}&username=${u}&event=${eventType}`);
                const d = await r.json();
                
                if(d.error) { showToast(d.error); return; }
                
                if(d.ust) { updateCard('ust', d.ust); }
                if(d.alt) { updateCard('alt', d.alt); }
                if(d.ayakkabi) { updateCard('ayakkabi', d.ayakkabi); } else { hideCard('ayakkabi'); }
                
                try{ confetti({ particleCount: 150, spread: 100, origin: { y: 0.6 } }); } catch(e){}
                
                if(d.message) showToast("✨ " + d.message);

                showAffiliateSuggestion();

            } catch(e) {
                console.error(e);
                showToast("Bir hata oluştu.");
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        
        
        async function openPlansModal() {
            document.getElementById('settingsMenu').style.display = 'none';
            document.getElementById('plansModal').style.display = 'flex';
            
            const container = document.getElementById('plans-list-container');
            container.innerHTML = "<div style='text-align:center; color:#888;'>Yükleniyor...</div>";

            try {
                const u = localStorage.getItem("userName");
                const res = await fetch(`/plans/?username=${u}`);
                const plans = await res.json();

                container.innerHTML = "";
                
                if (plans.length === 0) {
                    container.innerHTML = "<div style='text-align:center; padding:20px; color:#aaa;'>Henüz bir planın yok.<br><small>Bavul hazırla veya takvime ekle!</small></div>";
                    return;
                }

                plans.forEach(plan => {
                    const icon = plan.type === 'travel' ? '🧳' : '📅';
                    const color = plan.type === 'travel' ? '#fff3e0' : '#e3f2fd'; // Turuncu veya Mavi
                    
                    const div = document.createElement('div');
                    div.style.cssText = `background:${color}; padding:15px; border-radius:15px; display:flex; align-items:center; gap:15px; cursor:pointer; border:1px solid rgba(0,0,0,0.05);`;
                    div.innerHTML = `
                        <div style="font-size:24px;">${icon}</div>
                        <div style="flex:1;">
                            <div style="font-weight:bold; font-size:14px; color:#333;">${plan.title}</div>
                            <div style="font-size:11px; color:#666;">${new Date(plan.created_at).toLocaleDateString('tr-TR')} tarihinde oluşturuldu.</div>
                        </div>
                        <i class='bx bx-chevron-right' style="font-size:24px; color:#888;"></i>
                    `;
                    div.onclick = () => showPlanDetails(plan);
                    
                    const delBtn = document.createElement('div');
                    delBtn.innerHTML = "<i class='bx bx-trash'></i>";
                    delBtn.style.cssText = "padding:10px; color:#ff7675; cursor:pointer; font-size:18px;";
                    delBtn.onclick = (e) => { e.stopPropagation(); deletePlan(plan.id); };
                    
                    div.appendChild(delBtn);
                    container.appendChild(div);
                });

            } catch (e) {
                console.error(e);
                container.innerHTML = "Hata oluştu.";
            }
        }

        
function showPlanDetails(plan) {
    const modal = document.getElementById('planDetailModal');
    const title = document.getElementById('plan-detail-title');
    const content = document.getElementById('plan-detail-content');
    
    title.innerText = plan.title;
    content.innerHTML = "";
    
    let data;
    try { data = JSON.parse(plan.data); } catch(e) { data = []; }

    if (plan.type === 'travel') {
        data.forEach(day => {
            const shoeHtml = day.shoe_url ? `<img src="${day.shoe_url}" style="width:40px; height:40px; object-fit:contain;">` : '';
            const clickFunc = `loadPlanToCombine(${day.ust_id}, ${day.alt_id || 0}, ${day.shoe_id || 'null'}, '${day.ust_url}', '${day.alt_url || ''}', '${day.shoe_url || ''}')`;

            let outfitHtml = '';
            if (!day.alt_url) {
                 outfitHtml = `
                    <div style="display:flex; flex-direction:column; align-items:center;">
                        <img src="${day.ust_url}" style="width:50px; height:60px; object-fit:contain; border-radius:5px;">
                        <span style="font-size:9px; color:#888;">Elbise</span>
                    </div>
                 `;
            } else {
                outfitHtml = `
                    <img src="${day.ust_url}" style="width:40px; height:40px; object-fit:contain;">
                    <img src="${day.alt_url}" style="width:40px; height:40px; object-fit:contain;">
                `;
            }

            content.innerHTML += `
                <div onclick="${clickFunc}" style="background:#fff; padding:10px; border-radius:12px; border:1px solid #eee; display:flex; align-items:center; justify-content:space-between; cursor:pointer; transition:background 0.2s;">
                    <div style="font-weight:bold; color:var(--primary-color);">Gün ${day.day} <i class='bx bx-check-circle' style="font-size:12px; color:#ccc;"></i></div>
                    <div style="display:flex; align-items:center; gap:8px;">
                        ${outfitHtml}
                        <div style="width:1px; height:30px; background:#eee;"></div>
                        ${shoeHtml}
                    </div>
                </div>
            `;
        });
    } else {
        const item = Array.isArray(data) ? data[0] : data; 
        if(item.preview_urls) {
             let imgs = "";
             item.preview_urls.forEach(u => imgs += `<img src="${u}" style="width:80px; height:80px; object-fit:contain; border:1px solid #eee; border-radius:10px;">`);
             const clickCalendar = `loadPlanToCombine(${item.top_id}, ${item.bottom_id || 0}, ${item.shoe_id || 'null'}, '', '', '')`; 
             content.innerHTML = `<div style="display:flex; justify-content:center; gap:10px;">${imgs}</div>`;
        }
    }

    modal.style.display = 'flex';
}

        async function deletePlan(id) {
            if(!confirm("Bu planı silmek istiyor musun?")) return;
            await fetch(`/plans/${id}`, { method: 'DELETE' });
            openPlansModal(); // Listeyi yenile
        }
function setOutfitMode(mode) {
    activeOutfitType = mode;

    const cardUst = document.getElementById('img-ust').parentElement;
    const cardAlt = document.getElementById('img-alt').parentElement;
    const cardElbise = document.getElementById('card-elbise');

    if (mode === 'elbise') {
        cardUst.style.display = 'none';
        cardAlt.style.display = 'none';
        cardElbise.style.display = 'flex';
        
    } else {
        cardElbise.style.display = 'none';
        cardUst.style.display = 'flex';
        cardAlt.style.display = 'flex';
    }
}

// index.html içindeki getSmartRecommendation fonksiyonunu bununla değiştir:

async function getSmartRecommendation(force = false) {
    const btn = document.querySelector('.magic-btn');
    
    if (!force) {
        btn.classList.add('is-animating');
        setTimeout(() => { btn.classList.remove('is-animating'); }, 600);
    }
    
    const originalText = force ? btn.innerHTML : "<i class='bx bxs-magic-wand'></i> Kombinle";
    btn.disabled = true;
    if(!force) btn.innerHTML = "<i class='bx bx-loader-alt bx-spin'></i> Bakılıyor...";

    try {
        const username = localStorage.getItem("userName");
        const season = activeSeasonFilter || 'yaz';
        const style = activeStyleFilter || 'gunluk';
        
        let url = `/recommend/?season=${season}&style=${style}&username=${username}&outfit_type=${activeOutfitType}`;
        if (force) url += "&force=true";

        const res = await fetch(url);
        const data = await res.json();

        if (data.error) { showToast(data.error); return; }

        // --- GÖRÜNÜM GÜNCELLEME ---
        
        // 1. ELBİSE MODU
        if (activeOutfitType === 'elbise') {
            if (data.dress) updateCard('elbise', data.dress);
            if (data.ayakkabi) updateCard('ayakkabi', data.ayakkabi); else hideCard('ayakkabi');
        } 
        // 2. NORMAL MOD (ALT-ÜST)
        else {
            if (data.ust) updateCard('ust', data.ust);
            if (data.alt) updateCard('alt', data.alt);
            if (data.ayakkabi) updateCard('ayakkabi', data.ayakkabi); else hideCard('ayakkabi');
        }

        // --- 3. AKSESUAR GÜNCELLEMESİ ---
        if (data.aksesuar) {
            updateCard('aksesuar', data.aksesuar);
            const subName = data.aksesuar.sub_category ? data.aksesuar.sub_category.toUpperCase() : "AKSESUAR";
            document.querySelector('.acc-label').innerText = subName;
            document.getElementById('acc-msg').innerText = `✨ ${data.aksesuar.color_name} ${data.aksesuar.category}`;
        } else {
            const accImg = document.getElementById('img-aksesuar');
            const accPh = document.getElementById('ph-aksesuar');
            if(accImg) accImg.style.display = 'none';
            if(accPh) accPh.style.display = 'flex';
            document.getElementById('acc-msg').innerText = "Bu kombine aksesuar gerekmedi.";
        }
        if(typeof showAffiliateSuggestion === 'function') showAffiliateSuggestion();
        
        document.getElementById('btn-wear-container').classList.add('show');

    } catch (e) {
        console.error(e);
        showToast("Hata oluştu.");
    } finally {
        btn.disabled = false;
        if(!force) btn.innerHTML = "<i class='bx bxs-magic-wand'></i> Kombinle";
    }
}

async function saveCurrentOutfit() {
    let t, b, s;
    const s_el = document.getElementById('img-ayakkabi');
    s = s_el.getAttribute('data-id') ? parseInt(s_el.getAttribute('data-id')) : null;

    if (activeOutfitType === 'elbise') {
        const dress_id = document.getElementById('img-elbise').getAttribute('data-id');
        if (!dress_id) return showToast("Önce bir elbise seçmelisin!");
        t = parseInt(dress_id);
        b = 0; // Elbise modunda alt giyim 0 gönderilir
    } else {
        const t_el = document.getElementById('img-ust');
        const b_el = document.getElementById('img-alt');
        t = t_el.getAttribute('data-id');
        b = b_el.getAttribute('data-id');
        if (!t || !b) return showToast("Önce kombin yap!");
        t = parseInt(t); b = parseInt(b);
    }

    try {
        const res = await fetch('/outfits/save', {
            method: 'POST', headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ top_id: t, bottom_id: b, shoe_id: s, username: localStorage.getItem("userName") })
        });
        if (res.ok) { showToast("Kombin Kaydedildi! ❤️"); } 
        else { showToast("Hata oluştu."); }
    } catch (e) { showToast("Sunucu hatası."); }
}

async function confirmWearToday() {
    let t, b, s;
    const s_el = document.getElementById('img-ayakkabi');
    const u = localStorage.getItem("userName"); // Username al

    await fetch('/wear/confirm', {
        method: 'POST', 
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 
            top_id: t, 
            bottom_id: b, 
            shoe_id: s ? parseInt(s) : null,
            username: u  // <--- BURASI EKLENDİ
        })
    });
    
    showToast("Kombin Giyildi ✨"); 
    loadStats();
    document.getElementById('btn-wear-container').classList.remove('show');
}
function loadPlanToCombine(t_id, b_id, s_id, t_url, b_url, s_url) {
    document.getElementById('planDetailModal').style.display = 'none';
    document.getElementById('plansModal').style.display = 'none';

    switchPage('kombin');

    if (!b_id || b_id == 0 || b_url === 'null' || b_url === '') {
        setOutfitMode('elbise');
        updateCard('elbise', { id: t_id, url: t_url });
    } else {
        setOutfitMode('normal');
        updateCard('ust', { id: t_id, url: t_url });
        updateCard('alt', { id: b_id, url: b_url });
    }

    if (s_id && s_url && s_url !== 'null') {
        updateCard('ayakkabi', { id: s_id, url: s_url });
    } else {
        hideCard('ayakkabi');
    }
    document.getElementById('btn-wear-container').classList.add('show');
}  

function toggleMode(selectedMode) {
    document.querySelectorAll('.mode-switch-btn').forEach(btn => btn.classList.remove('active'));
    document.getElementById(`btn-switch-${selectedMode}`).classList.add('active');
    setOutfitMode(selectedMode);
}

function useSuggestion(text) {
    const input = document.getElementById('aiUserIn');
    input.value = text; // Metni kutuya yaz
    sendAiMessage();    // Gönder
}

async function voteDuel(winnerId, side) {
    const selectedCard = document.getElementById(`card-${side}`);
    const otherSide = side === 'left' ? 'right' : 'left';
    const otherCard = document.getElementById(`card-${otherSide}`);

    if(selectedCard) {
        selectedCard.style.transform = "scale(1.05)";
        selectedCard.style.borderColor = "#00b894";
        const winnerOverlay = selectedCard.querySelector('.winner-overlay');
        if(winnerOverlay) winnerOverlay.style.display = 'flex';
    }

    if(otherCard) {
        otherCard.style.transform = "scale(0.9) grayscale(100%)";
        otherCard.style.opacity = "0.6";
    }

    try { 
        confetti({ 
            particleCount: 100, 
            spread: 70, 
            origin: { x: side === 'left' ? 0.25 : 0.75, y: 0.6 }, 
            colors: ['#00b894', '#fdcb6e', '#ff7675'] 
        }); 
    } catch(e){}

    const fd = new FormData(); 
    fd.append('winner_id', winnerId); 
    
    try {
        await fetch('/duel/vote', { method: 'POST', body: fd });
    } catch(e) {
        console.error("Oylama hatası:", e);
    }

    setTimeout(() => { 
        const arena = document.getElementById('duel-arena-content');
        if(arena) {
            arena.style.opacity = '0';
            arena.style.transform = 'scale(0.9)';
        }
        
        setTimeout(() => { 
            loadDuelPair(true); // Yeni veriyi yükle
            if(arena) {
                arena.style.opacity = '1';
                arena.style.transform = 'scale(1)';
            }
        }, 400); 
    }, 1500);
}

function openSavedOutfitsModal(){
    document.getElementById('savedOutfitsModal').style.display='flex';
    loadSavedOutfits();
}

function closeSavedOutfitsModal(){
    document.getElementById('savedOutfitsModal').style.display='none';
}

window.savedOutfitsData = [];

function openSavedOutfitsModal(){
    document.getElementById('savedOutfitsModal').style.display='flex';
    loadSavedOutfits();
}

function closeSavedOutfitsModal(){
    document.getElementById('savedOutfitsModal').style.display='none';
}

async function loadSavedOutfits() {
    const listContainer = document.getElementById('saved-list-modal');
    listContainer.innerHTML = "<div style='grid-column:span 2; text-align:center; color:#888; margin-top:20px;'><i class='bx bx-loader-alt bx-spin' style='font-size:30px;'></i><br>Yükleniyor...</div>";

    try {
        const username = localStorage.getItem("userName");
        const res = await fetch(`/outfits/?username=${username}`);
        const data = await res.json();
        
        window.savedOutfitsData = data; 

        listContainer.innerHTML = "";
        
        if (!data || data.length === 0) {
            listContainer.innerHTML = `<div style='grid-column:span 2; text-align:center; padding:30px; color:#aaa;'><div style="font-size:40px; margin-bottom:10px;">💔</div>Henüz favori kombinin yok.</div>`;
            return;
        }

        data.forEach((item, index) => {
            const div = document.createElement('div');
            div.className = 'saved-card';
            const shoeHtml = item.shoe_url ? `<img src="${item.shoe_url}" style="width:35px; height:35px; object-fit:contain; background:#f9f9f9; border-radius:8px; padding:2px;">` : '';

            div.innerHTML = `
                <div class="saved-delete" onclick="event.stopPropagation(); delSave(${item.id})"><i class='bx bx-trash'></i></div>
                <div class="saved-outfit-row">
                    <img src="${item.top_url}" style="width:50px; height:70px; object-fit:contain;">
                    ${item.bottom_url ? `<img src="${item.bottom_url}" style="width:50px; height:70px; object-fit:contain;">` : ''}
                </div>
                <div style="margin-top:5px; width:100%; display:flex; justify-content:center;">${shoeHtml}</div>
            `;
            div.onclick = () => { loadOutfitFromProfile(index); };
            listContainer.appendChild(div);
        });
    } catch (e) {
        listContainer.innerHTML = "<div style='grid-column:span 2; text-align:center; color:red;'>Bağlantı hatası.</div>";
    }
}

function loadOutfitFromProfile(index) {
    const item = window.savedOutfitsData[index];
    
    if (!item) {
        showToast("Veri bulunamadı.");
        return;
    }

    closeSavedOutfitsModal();
    switchPage('kombin');

    if (!item.bottom_id || item.bottom_id == 0) {
        toggleMode('elbise'); // Elbise modunu aç
        
        updateCard('elbise', { 
            id: item.top_id, 
            url: item.top_url, 
            color_name: item.top_color 
        });
        
    } else {
        toggleMode('normal'); // Normal modu aç
        
        updateCard('ust', { 
            id: item.top_id, 
            url: item.top_url, 
            color_name: item.top_color 
        });
        
        updateCard('alt', { 
            id: item.bottom_id, 
            url: item.bottom_url, 
            color_name: item.bottom_color 
        });
    }

    if (item.shoe_id && item.shoe_url) {
        updateCard('ayakkabi', { 
            id: item.shoe_id, 
            url: item.shoe_url, 
            color_name: item.shoe_color 
        });
    } else {
        hideCard('ayakkabi');
    }

    const wearBtn = document.getElementById('btn-wear-container');
    if(wearBtn) wearBtn.classList.add('show');
    
    setTimeout(() => {
        if(typeof showAffiliateSuggestion === 'function') {
            showAffiliateSuggestion();
        }
    }, 500);
}

async function delSave(id) {
    if(!confirm("Silmek istiyor musun?")) return;
    try {
        await fetch(`/outfits/${id}`, { method: 'DELETE' });
        loadSavedOutfits();
    } catch(e) { showToast("Hata oluştu."); }
}

async function delSave(id) {
    if(!confirm("Bu kombini favorilerden kaldırmak istiyor musun?")) return;
    
    const btn = event.target.closest('.saved-delete');
    if(btn) btn.parentElement.style.opacity = '0.5';

    try {
        await fetch(`/outfits/${id}`, { method: 'DELETE' });
        loadSavedOutfits(); // Listeyi yenile
    } catch(e) {
        showToast("Hata oluştu.");
    }
}

document.addEventListener("DOMContentLoaded", function() {
    setTimeout(checkYesterdayOutfit, 2000); // 2 saniye bekle sonra sor (Kullanıcı arayüzü görsün)
});

let currentLogId = 0;
let pendingDirtyItems = []; // Ekranda gösterilen öğelerin listesi

async function checkYesterdayOutfit() {
    const user = localStorage.getItem("userName");
    if(!user) return;

    try {
        const res = await fetch(`/wear/pending_review/${user}`);
        const data = await res.json();

        if (data.status !== "no_pending" && data.id) {
            currentLogId = data.id;
            openYesterdayModal(data);
        }
    } catch(e) {
        console.error("Geçmiş kontrol hatası:", e);
    }
}

function openYesterdayModal(data) {
    const modal = document.getElementById('yesterdayModal');
    const grid = document.getElementById('yesterday-items-grid');
    grid.innerHTML = "";
    const items = [
        {id: data.top_id, url: data.top_url, name: "Üst"},
        {id: data.bottom_id, url: data.bottom_url, name: "Alt"},
        {id: data.shoe_id, url: data.shoe_url, name: "Ayakkabı"}
    ];

    items.forEach(item => {
        if(item.id && item.url && item.url !== 'null') {
            const div = document.createElement('div');
            div.className = 'yesterday-item';
            div.style.cssText = "position:relative; width:80px; cursor:pointer; transition:0.2s;";
            div.setAttribute('data-id', item.id);
            div.setAttribute('data-selected', 'false'); // Seçili değil (Temiz)
            
            div.innerHTML = `
                <div class="selection-indicator" style="position:absolute; top:-5px; right:-5px; width:25px; height:25px; background:#eee; border-radius:50%; display:flex; align-items:center; justify-content:center; border:2px solid white; box-shadow:0 2px 5px rgba(0,0,0,0.1);">
                    <i class='bx bx-check' style="color:#ccc;"></i>
                </div>
                <img src="${item.url}" style="width:80px; height:80px; object-fit:contain; border-radius:15px; border:1px solid #eee;">
                <div style="font-size:11px; margin-top:5px; color:#888;">${item.name}</div>
            `;
            
            div.onclick = function() {
                const isSelected = this.getAttribute('data-selected') === 'true';
                this.setAttribute('data-selected', !isSelected);
                
                const indicator = this.querySelector('.selection-indicator');
                const icon = indicator.querySelector('i');
                const img = this.querySelector('img');

                if (!isSelected) {
                    indicator.style.background = "#ff7675";
                    icon.className = 'bx bx-water'; // Su ikonu (Yıkanacak)
                    icon.style.color = "white";
                    img.style.filter = "grayscale(100%) opacity(0.7)";
                    img.style.border = "2px solid #ff7675";
                } else {
                    indicator.style.background = "#eee";
                    icon.className = 'bx bx-check';
                    icon.style.color = "#ccc";
                    img.style.filter = "none";
                    img.style.border = "1px solid #eee";
                }
            };
            
            grid.appendChild(div);
        }
    });

    modal.style.display = 'flex';
}

async function submitYesterdayReview() {
    const dirtyIds = [];
    document.querySelectorAll('.yesterday-item').forEach(el => {
        if(el.getAttribute('data-selected') === 'true') {
            dirtyIds.push(parseInt(el.getAttribute('data-id')));
        }
    });

    await fetch('/wear/submit_review', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            log_id: currentLogId,
            dirty_ids: dirtyIds
        })
    });

    document.getElementById('yesterdayModal').style.display = 'none';
    if(dirtyIds.length > 0) {
        showToast(`${dirtyIds.length} parça kirli sepetine yollandı. 🧺`);
        loadStats(); // Sayaçları güncelle (Kirli sayısı arttı çünkü)
    } else {
        showToast("Her şey temiz! Harika. ✨");
    }
}

async function generateStoryImage() {
    const btn = document.querySelector('.story-btn');
    const originalIcon = btn.innerHTML;
    btn.innerHTML = "<i class='bx bx-loader-alt bx-spin'></i>"; // Yükleniyor ikonu

    const templateUst = document.getElementById('story-img-ust');
    const templateAlt = document.getElementById('story-img-alt');
    const templateShoeBox = document.getElementById('story-shoe-box');
    const templateShoe = document.getElementById('story-img-shoe');

    const srcUst = document.getElementById('img-ust');
    const srcAlt = document.getElementById('img-alt');
    const srcElbise = document.getElementById('img-elbise');
    const srcShoe = document.getElementById('img-ayakkabi');

    if(activeOutfitType === 'elbise') {
        if(srcElbise.src && srcElbise.style.display !== 'none') {
            templateUst.src = srcElbise.src;
            templateUst.style.maxHeight = "85%"; 
            templateUst.style.marginBottom = "0";
            
            templateAlt.style.display = "none";
        }
    } else {
        if(srcUst.src && srcUst.style.display !== 'none') {
            templateUst.src = srcUst.src;
            templateUst.style.maxHeight = "42%"; // Normale döndür
            templateUst.style.marginBottom = "-10px"; // Biraz iç içe geçsin
            templateUst.style.display = "block";
        } else {
            templateUst.style.display = "none";
        }

        if(srcAlt.src && srcAlt.style.display !== 'none') {
            templateAlt.src = srcAlt.src;
            templateAlt.style.display = "block";
        } else {
            templateAlt.style.display = "none";
        }
    }

    if(srcShoe.src && srcShoe.style.display !== 'none' && srcShoe.getAttribute('data-id')) {
        templateShoe.src = srcShoe.src;
        templateShoeBox.style.display = "flex";
    } else {
        templateShoeBox.style.display = "none";
    }

    const uName = localStorage.getItem("userName");
    const uAvatarSrc = document.getElementById('profile-img-real').src;
    
    document.getElementById('story-username').innerText = '@' + uName;
    const avatarEl = document.getElementById('story-user-avatar');
    
    if(uAvatarSrc && uAvatarSrc !== window.location.href) {
        avatarEl.src = uAvatarSrc;
    } else {
        avatarEl.parentElement.style.background = "#eee";
        avatarEl.style.display = "none"; 
    }

    const element = document.getElementById('story-template');
    
    try {
        await new Promise(r => setTimeout(r, 100));

        const canvas = await html2canvas(element, {
            scale: 2, // Retine ekran kalitesi
            useCORS: true, 
            backgroundColor: null,
            logging: false
        });

        const link = document.createElement('a');
        link.download = `BugunNeGiysem_Story_${uName}_${Date.now()}.png`;
        link.href = canvas.toDataURL("image/png");
        link.click();
        
        showToast("Story Kartı Hazır! 📸");
        
    } catch (e) {
        console.error("Story Hatası:", e);
        showToast("Görsel oluşturulamadı.");
    } finally {
        btn.innerHTML = originalIcon;
    }
}

function switchUploadTab(tab) {
    const photoContent = document.getElementById('upload-content-photo');
    const linkContent = document.getElementById('upload-content-link');
    const tabPhoto = document.getElementById('tab-photo');
    const tabLink = document.getElementById('tab-link');

    if (tab === 'photo') {
        photoContent.style.display = 'block';
        linkContent.style.display = 'none';
        tabPhoto.style.background = 'white';
        tabPhoto.style.color = '#333';
        tabLink.style.background = 'transparent';
        tabLink.style.color = '#888';
    } else {
        photoContent.style.display = 'none';
        linkContent.style.display = 'block';
        tabLink.style.background = 'white';
        tabLink.style.color = '#0984e3';
        tabPhoto.style.background = 'transparent';
        tabPhoto.style.color = '#888';
    }
}


async function uploadFromLink() {
    const link = document.getElementById('linkInput').value.trim();
    const btn = document.getElementById('linkSaveBtn');
    const status = document.getElementById('status');

    if (!link) return showToast("Lütfen bir link yapıştırın.");

    // Yükleniyor durumu
    btn.disabled = true;
    btn.innerHTML = "<i class='bx bx-loader-alt bx-spin'></i> Analiz Ediliyor...";
    status.innerText = "Ürün bilgileri ve kategori taranıyor...";

    try {
        const res = await fetch('/import/url', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                url: link,
                username: localStorage.getItem("userName"),
                // KRİTİK NOKTA: O an hangi sekmedeysek o bilgiyi gönderiyoruz
                category: activeWardrobeTab 
            })
        });
        const data = await res.json();

        if (res.ok) {
            // Başarı Mesajı Hazırla
            let msg = "Ürün Eklendi! 🎉";
            
            // Eğer aksesuar eklediysek detaylı bilgi verelim
            if (data.category === 'aksesuar' && data.sub_category) {
                const subNames = {
                    'gozluk': 'Gözlük', 'canta': 'Çanta', 'saat': 'Saat', 
                    'sapka': 'Şapka', 'taki': 'Takı', 'kemer': 'Kemer'
                };
                const subTr = subNames[data.sub_category] || 'Aksesuar';
                msg = `${subTr} olarak kaydedildi! 😎`;
            }

            showToast(msg);
            status.innerText = `Başarılı: ${data.title}`;
            document.getElementById('linkInput').value = "";
            
            // Ekranı Yenile
            if(typeof loadWardrobe === 'function') loadWardrobe();
            if(typeof loadStats === 'function') loadStats();
            
            // 2 saniye sonra modalı kapat
            setTimeout(() => { 
                closeUploadModal(); 
                btn.disabled=false; 
                btn.innerHTML="<i class='bx bx-cloud-download'></i> İçe Aktar"; 
                status.innerText=""; 
            }, 2000);

        } else {
            showToast("Hata: " + data.detail);
            status.innerText = "Hata oluştu.";
            btn.disabled = false;
            btn.innerHTML = "<i class='bx bx-cloud-download'></i> İçe Aktar";
        }
    } catch (e) {
        console.error(e);
        showToast("Sunucu hatası.");
        btn.disabled = false;
        btn.innerHTML = "<i class='bx bx-cloud-download'></i> İçe Aktar";
    }
}

let currentEditItem = null;
let editSeasonVal = 'mevsimlik';
let editStyleVal = 'gunluk';

function openEditModalFromAction() {
    document.getElementById('itemActionModal').style.display = 'none'; // Menüyü kapat
    if (!currentItemIdToDelete) return; // Seçili ürün yoksa çık (Silme fonksiyonundaki ID değişkenini kullanıyoruz)
    
    document.getElementById('editModal').style.display = 'flex';
    
    resetEditSelection(); 
}

function populateEditModal(item) {
    currentEditItem = item;
    currentItemIdToDelete = item.id; // ID'yi güncelleyelim
    
    document.getElementById('editCategory').value = item.category;
    
    editSeasonVal = item.season || 'mevsimlik';
    document.querySelectorAll('#edit-season-opts .option-btn').forEach(btn => btn.classList.remove('sel'));
    const seasonBtns = document.querySelectorAll('#edit-season-opts .option-btn');
    seasonBtns.forEach(btn => {
        if(btn.getAttribute('onclick').includes(`'${editSeasonVal}'`)) {
            btn.classList.add('sel');
        }
    });

    editStyleVal = item.style || 'gunluk';
    document.querySelectorAll('#edit-style-opts .option-btn').forEach(btn => btn.classList.remove('sel'));
    const styleBtns = document.querySelectorAll('#edit-style-opts .option-btn');
    styleBtns.forEach(btn => {
        if(btn.getAttribute('onclick').includes(`'${editStyleVal}'`)) {
            btn.classList.add('sel');
        }
    });
}

function selEditSeason(val, btn) {
    editSeasonVal = val;
    document.querySelectorAll('#edit-season-opts .option-btn').forEach(b => b.classList.remove('sel'));
    btn.classList.add('sel');
}

function selEditStyle(val, btn) {
    editStyleVal = val;
    document.querySelectorAll('#edit-style-opts .option-btn').forEach(b => b.classList.remove('sel'));
    btn.classList.add('sel');
}

function closeEditModal() {
    document.getElementById('editModal').style.display = 'none';
}

function resetEditSelection() {
    selEditSeason('mevsimlik', document.querySelector('#edit-season-opts .option-btn:nth-child(3)'));
    selEditStyle('gunluk', document.querySelector('#edit-style-opts .option-btn:nth-child(1)'));
}

async function saveEditChanges() {
    if(!currentEditItem && !currentItemIdToDelete) return;
    
    const id = currentEditItem ? currentEditItem.id : currentItemIdToDelete;
    const cat = document.getElementById('editCategory').value;
    
    const payload = {
        id: id,
        category: cat,
        season: editSeasonVal,
        style: editStyleVal,
        sub_category: null // Gerekirse bunu da ekleyebilirsiniz
    };

    try {
        const res = await fetch('/clothes/update', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(payload)
        });
        const data = await res.json();
        
        if(data.status === 'success') {
            showToast("Parça güncellendi! ✅");
            closeEditModal();
            // Sayfayı yenile veya listeyi güncelle
            if(activeWardrobeTab) openCategory(activeWardrobeTab, document.getElementById('detail-title').innerText);
        } else {
            showToast("Hata: " + data.error);
        }
    } catch(e) {
        showToast("Bağlantı hatası.");
    }
}

// --- YÖNETİCİ PANELİ (GÜNCELLENMİŞ - EDİT & ÇOKLU KELİME) ---

async function openAffiliateAdmin() {
    const modal = document.getElementById('affiliateAdminModal');
    if (!modal) return alert("Modal bulunamadı!");
    
    modal.style.display = 'flex';
    const settings = document.getElementById('settingsMenu');
    if(settings) settings.style.display = 'none';

    resetAffiliateForm(); // Formu temizle
    await updateRecentLinks();
}

async function updateRecentLinks() {
    const container = document.getElementById('recent-links-list');
    if(!container) return;

    try {
        const res = await fetch('/affiliate/list');
        const data = await res.json();
        
        container.innerHTML = "";
        
        if(!data || data.length === 0) {
            container.innerHTML = "<div style='text-align:center; color:#ddd; font-size:12px; padding:10px;'>Henüz link eklenmemiş.</div>";
            return;
        }

        data.forEach(item => {
            const div = document.createElement('div');
            div.className = 'recent-link-item';
            
            // Satır Yapısı: Sol (Bilgi) - Sağ (Butonlar)
            div.innerHTML = `
                <div style="flex:1; overflow:hidden; text-align:left;">
                    <div style="font-weight:700; color:#2d3436; font-size:13px;">${item.keyword}</div>
                    <div style="font-size:10px; color:#aaa; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">${item.link}</div>
                </div>
                <div style="display:flex; align-items:center; gap:5px;">
                    <div class="link-badge">${item.click_count || 0} Tık</div>
                    
                    <div class="admin-delete-btn" style="background:#e3f2fd; color:#0984e3;" onclick="editAffiliateLink(${item.id}, '${item.keyword}', '${item.link}')">
                        <i class='bx bx-pencil'></i>
                    </div>

                    <div class="admin-delete-btn" onclick="deleteAffiliateLink(${item.id})">
                        <i class='bx bx-trash'></i>
                    </div>
                </div>
            `;
            container.appendChild(div);
        });

    } catch(e) {
        console.error("Hata:", e);
        container.innerHTML = "<div style='color:red; font-size:10px; text-align:center;'>Liste yüklenemedi.</div>";
    }
}

// --- DÜZENLEME MODUNU AÇAN FONKSİYON ---
function editAffiliateLink(id, keyword, link) {
    // Verileri kutulara doldur
    document.getElementById('editLinkId').value = id;
    document.getElementById('affKeyword').value = keyword;
    document.getElementById('affLink').value = link;

    // Butonu ve yazıyı değiştir
    document.getElementById('affBtnText').innerText = "Linki Güncelle";
    document.getElementById('affSaveBtn').style.background = "#00b894"; // Yeşil yap
    document.getElementById('affCancelBtn').style.display = "block"; // İptal butonunu göster
}

// --- FORMU SIFIRLAMA ---
function resetAffiliateForm() {
    document.getElementById('editLinkId').value = ""; // ID'yi sil
    document.getElementById('affKeyword').value = "";
    document.getElementById('affLink').value = "";

    // Butonu eski haline getir
    document.getElementById('affBtnText').innerText = "Linki Sisteme Ekle";
    document.getElementById('affSaveBtn').style.background = "#2d3436"; // Siyah yap
    document.getElementById('affCancelBtn').style.display = "none"; // İptal butonunu gizle
}

// --- KAYDETME VEYA GÜNCELLEME ---
async function saveAffiliateLink() {
    const id = document.getElementById('editLinkId').value; // ID var mı?
    const key = document.getElementById('affKeyword').value.trim();
    const link = document.getElementById('affLink').value.trim();
    
    if(!key || !link) return showToast("Bilgiler eksik!");

    const btn = document.getElementById('affSaveBtn');
    const originalText = document.getElementById('affBtnText').innerText;
    
    document.getElementById('affBtnText').innerText = "İşleniyor...";
    btn.disabled = true;

    try {
        let url, method, bodyData;

        if (id) {
            // ID VARSA -> GÜNCELLEME (UPDATE)
            url = '/affiliate/update';
            method = 'POST';
            bodyData = { id: parseInt(id), keyword: key, link: link };
        } else {
            // ID YOKSA -> YENİ EKLEME (CREATE)
            url = '/affiliate/add-link';
            method = 'POST';
            bodyData = { keyword: key, link: link };
        }

        const res = await fetch(url, {
            method: method,
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(bodyData)
        });
        
        const data = await res.json();
        
        if(data.status === 'success') {
            showToast(id ? "✅ Güncellendi!" : "✅ Eklendi!");
            resetAffiliateForm(); // Formu sıfırla
            await updateRecentLinks(); // Listeyi yenile
        } else {
            showToast(data.message || "Hata oluştu.");
        }
    } catch(e) {
        showToast("Sunucu hatası.");
    } finally {
        document.getElementById('affBtnText').innerText = originalText;
        btn.disabled = false;
    }
}

// --- PREMIUM FONKSİYONLARI ---

function openPremium() {
    document.getElementById('premiumModal').style.display = 'flex';
}

function closePremium() {
    document.getElementById('premiumModal').style.display = 'none';
}

async function buyPremium() {
    const btn = document.getElementById('buyBtn');
    
    // 1. Ödeme Simülasyonu (Bekletme)
    btn.innerHTML = "<i class='bx bx-loader-alt bx-spin'></i> İşleniyor...";
    btn.disabled = true;

    // 2 saniye bekle (sanki bankaya soruyor gibi)
    await new Promise(r => setTimeout(r, 2000));

    // 2. Backend'e Gönder
    try {
        const username = localStorage.getItem("userName");
        const res = await fetch('/user/upgrade', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ username: username })
        });
        const data = await res.json();

        if (data.status === 'success') {
            // 3. Başarılı!
            closePremium();
            
            // Konfeti ve Kutlama
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
            
            Swal.fire({
                title: 'HOŞ GELDİN PATRON! 👑',
                text: 'Hesabın Premium\'a yükseltildi. Tüm sınırlar kalktı!',
                icon: 'success',
                confirmButtonText: 'Hadi Başlayalım',
                confirmButtonColor: '#ffd700',
                background: '#000',
                color: '#fff'
            }).then(() => {
                location.reload(); // Sayfayı yenile ki özellikler açılsın
            });
            
        } else {
            showToast("Hata: " + data.message);
            btn.innerHTML = "HEMEN YÜKSELT";
            btn.disabled = false;
        }

    } catch (e) {
        showToast("Bağlantı hatası.");
        btn.innerHTML = "HEMEN YÜKSELT";
        btn.disabled = false;
    }
}

// --- SİLME FONKSİYONU ---
async function deleteAffiliateLink(id) {
    if(!confirm("Silmek istediğine emin misin?")) return;

    try {
        const res = await fetch(`/affiliate/delete/${id}`, { method: 'DELETE' });
        if (res.ok) {
            showToast("Silindi 🗑️");
            // Eğer düzenleme modundaysak formu temizle (silineni düzenliyor olabiliriz)
            if(document.getElementById('editLinkId').value == id) {
                resetAffiliateForm();
            }
            await updateRecentLinks();
        } else {
            showToast("Silinemedi.");
        }
    } catch(e) {
        showToast("Hata oluştu.");
    }
}



</script>
<script>

    
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/sw.js')
        .then(() => console.log("Uygulama Hazır! 🚀"));
    }

function toggleChatWindow() {
    const w = document.getElementById('ai-chat-window');
    w.style.display = w.style.display === 'flex' ? 'none' : 'flex';
    if(w.style.display === 'flex') document.getElementById('aiUserIn').focus();
}

function handleChatEnter(e) { if(e.key === 'Enter') sendAiMessage(); }

// --- VİTRİNDEN PAYLAŞIM SİLME ---
async function deleteSocialPost(postId) {
    // 1. Onay İste
    if(!confirm("Bu kombini vitrininden kaldırmak istiyor musun?")) return;

    try {
        // 2. Backend'e İstek At
        const res = await fetch(`/social/post/${postId}`, {
            method: 'DELETE'
        });
        const data = await res.json();

        if (data.status === 'success') {
            showToast("Vitrin güncellendi 🧹");
            // 3. Listeyi Yenile (Sayfayı yenilemeden)
            loadProfileData(localStorage.getItem("userName"));
        } else {
            showToast("Hata: " + data.message);
        }
    } catch (e) {
        showToast("Bağlantı hatası.");
    }
}

// --- YENİ CHAT VE SANAL MANKEN ENTEGRASYONU ---

async function sendAiMessage() {
    const input = document.getElementById('aiUserIn');
    const txt = input.value.trim();
    if(!txt) return;

    // Kullanıcı mesajını ekle
    addMessage(txt, 'user');
    input.value = "";

    // Loading balonu oluştur (id ile takip etmek için)
    const loadingId = "loading-" + Math.random().toString(36).substr(2, 9);
    const c = document.getElementById('chat-messages');
    const loadDiv = document.createElement('div');
    loadDiv.id = loadingId;
    loadDiv.className = 'msg ai';
    loadDiv.innerHTML = "<i class='bx bx-dots-horizontal-rounded bx-burst'></i> Yazıyor...";
    c.appendChild(loadDiv);
    c.scrollTop = c.scrollHeight;

    try {
        const res = await fetch('/ai/ask', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                username: localStorage.getItem("userName"),
                message: txt
            })
        });
        const data = await res.json();

        // Loading'i kaldır
        const loadMsg = document.getElementById(loadingId);
        if(loadMsg) loadMsg.remove();

        // 1. ID Metinlerini Temizle (Kullanıcıya ID gösterme)
        let cleanResponse = data.response;
        if(cleanResponse) {
            cleanResponse = cleanResponse.replace(/\(ID:\d+\)/g, "").replace(/ID:\d+/g, "");
        }

        // 2. Mesajı ve Varsa Ürünleri Ekle
        addMessage(cleanResponse, 'ai', data.items);

    } catch(e) {
        console.error(e);
        const loadMsg = document.getElementById(loadingId);
        if(loadMsg) loadMsg.remove();
        addMessage("Bağlantı hatası oluştu.", 'ai');
    }
}

function addMessage(text, sender, items = []) {
    const c = document.getElementById('chat-messages');
    const div = document.createElement('div');
    div.className = `msg ${sender}`;

    // Metni düzenle (Satır başları ve kalın yazılar)
    let formattedText = text.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>').replace(/\n/g, '<br>');
    
    let contentHtml = `<div>${formattedText}</div>`;

    // EĞER KIYAFET ÖNERİSİ VARSA: Sadece Görsel Galeri
    if (items && items.length > 0) {
        contentHtml += `
            <div style="display:flex; gap:10px; margin-top:15px; overflow-x:auto; padding-bottom:5px; scrollbar-width:none;">
        `;
        
        items.forEach(item => {
            // Resim yolunu güvenli hale getir
            let imgUrl = item.url; 
            if (!imgUrl.startsWith('/') && !imgUrl.startsWith('http')) {
                imgUrl = '/' + imgUrl;
            }

            contentHtml += `
                <div onclick="previewChatImage('${imgUrl}')" style="flex:0 0 auto; width:100px; background:rgba(255,255,255,0.95); border-radius:12px; padding:8px; text-align:center; box-shadow: 0 4px 10px rgba(0,0,0,0.1); border:1px solid #eee; cursor:pointer; transition:transform 0.2s;">
                    
                    <div style="width:100%; height:80px; margin-bottom:5px; border-radius:8px; overflow:hidden; background:#fff; display:flex; align-items:center; justify-content:center;">
                        <img src="${imgUrl}" style="width:100%; height:100%; object-fit:contain;" onerror="this.src='https://via.placeholder.com/100?text=Resim+Yok'">
                    </div>
                    
                    <div style="font-size:10px; color:#333; font-weight:700; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">
                        ${item.color_name} ${item.category}
                    </div>

                </div>
            `;
        });
        
        contentHtml += `</div>`;
    }

    div.innerHTML = contentHtml;
    c.appendChild(div);
    c.scrollTop = c.scrollHeight;
}

</script>

<div id="ai-chat-btn" onclick="toggleChatWindow()">
    <i class='bx bx-bot'></i>
    <span class="chat-badge">AI</span>
</div>

<div id="ai-chat-window" style="display: none;">
    <div class="chat-header">
        <div style="display:flex; align-items:center; gap:10px;">
            <i class='bx bx-bot' style="font-size:24px;"></i>
            <div>
                <div style="font-weight:bold; font-size:14px;">AI Stilist</div>
                <div style="font-size:10px; opacity:0.8;">Çevrimiçi</div>
            </div>
        </div>
        <i class='bx bx-x' style="cursor:pointer; font-size:24px;" onclick="toggleChatWindow()"></i>
    </div>
    
    <div id="chat-messages" class="chat-content">
        <div class="msg ai">
            Merhaba! Ben senin kişisel stilistin. ✨<br>
            Sana nasıl yardımcı olabilirim?
        </div>
    </div>

    <div class="chat-suggestions-area">
        <div class="suggestion-chip" onclick="useSuggestion('Bugün ne giysem? Karar veremedim.')">🤔 Bugün ne giysem?</div>
        <div class="suggestion-chip" onclick="useSuggestion('Yarın hava yağmurlu, ne önerirsin?')">☔ Yarın yağmur var</div>
        <div class="suggestion-chip" onclick="useSuggestion('İş için şık ve resmi bir kombin yap.')">💼 İş görüşmesi</div>
        <div class="suggestion-chip" onclick="useSuggestion('Hafta sonu rahat bir şeyler giymek istiyorum.')">☕ Hafta sonu</div>
        <div class="suggestion-chip" onclick="useSuggestion('İlk buluşma için etkileyici bir kombin öner.')">💖 İlk Buluşma</div>
        <div class="suggestion-chip" onclick="useSuggestion('Siyah parçalarla bir kombin yap.')">🖤 Simsiyah Modu</div>
    </div>

    <div class="chat-input-area">
        <input type="text" id="aiUserIn" placeholder="Bir şeyler sor..." onkeypress="handleChatEnter(event)">
        <button onclick="sendAiMessage()"><i class='bx bxs-send'></i></button>
    </div>
</div>

<div class="modal-overlay" id="editItemModal">
    <div class="modal-card">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
            <h3 style="margin:0;">Parçayı Düzenle</h3>
            <i class='bx bx-x' style="font-size:28px; cursor:pointer;" onclick="document.getElementById('editItemModal').style.display='none'"></i>
        </div>

        <input type="hidden" id="editItemId"> <div class="neon-input-group" style="text-align:left;">
            <label style="color:#888; font-size:12px; margin-left:5px;">Kategori</label>
            <select id="editCategory" class="city-select">
    <option value="ust_giyim">Üst Giyim</option>
    <option value="alt_giyim">Alt Giyim</option>
    <option value="elbise">Elbise</option>
    <option value="ayakkabi">Ayakkabı</option>
    
            
        </div>

        <div class="neon-input-group" style="text-align:left;">
            <label style="color:#888; font-size:12px; margin-left:5px;">Mevsim</label>
            <select id="editSeason" class="city-select">
                <option value="yaz">Yazlık</option>
                <option value="kis">Kışlık</option>
                <option value="mevsimlik">Mevsimlik</option>
            </select>
        </div>

        <div class="neon-input-group" style="text-align:left;">
            <label style="color:#888; font-size:12px; margin-left:5px;">Tarz</label>
            <select id="editStyle" class="city-select">
                <option value="gunluk">Günlük</option>
                <option value="ofis">Ofis</option>
                <option value="spor">Spor</option>
                <option value="ozel">Özel</option>
            </select>
        </div>

        <button class="magic-btn" onclick="saveItemUpdate()" style="width:100%; margin-top:10px;">Kaydet</button>
    </div>
</div>

<div id="duelModal" class="duel-modal" style="display: none;">
    <div class="duel-header">
        <span style="background: rgba(255,255,255,0.2); padding: 5px 15px; border-radius: 20px; font-size: 16px;">
            🔥 Hangisi Daha İyi?
        </span>
    </div>
    
    <div class="duel-close" onclick="closeDuel()">
        <i class='bx bx-x'></i>
    </div>

    <div id="duel-arena-content" class="duel-arena">
        </div>
</div>

<div class="modal-overlay" id="leaderboardModal" style="display: none;">
    <div class="modal-card">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
            <h3 style="margin:0; display:flex; align-items:center; gap:10px;">
                <i class='bx bxs-trophy' style="color:#ffd700;"></i> Liderler
            </h3>
            <i class='bx bx-x' style="font-size:28px; cursor:pointer; color:#aaa;" onclick="document.getElementById('leaderboardModal').style.display='none'"></i>
        </div>
        
        <div id="leaderboard-content" class="leaderboard-list">
            </div>
    </div>
</div>

<div class="modal-overlay" id="yesterdayModal" style="display: none; z-index: 9999;">
    <div class="modal-card" style="text-align: center;">
        <h3>Dün Bunları Giydin 👀</h3>
        <p style="color:#888; font-size:13px; margin-bottom:20px;">Hangileri kirlendi? Kirlenenleri seç, sepete atalım.</p>
        
        <div id="yesterday-items-grid" style="display: flex; justify-content: center; gap: 15px; margin-bottom: 25px;">
            </div>

        <button class="magic-btn" onclick="submitYesterdayReview()" style="width:100%; background: linear-gradient(135deg, #00b09b 0%, #96c93d 100%);">
            <i class='bx bx-check'></i> Tamamla
        </button>
    </div>
</div>

<div id="story-template" style="position: fixed; left: -9999px; top:0; width: 540px; height: 960px; background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%); display: flex; flex-direction: column; align-items: center; justify-content: space-between; padding: 40px; font-family: 'Poppins', sans-serif; color: #333; z-index: 99999; box-sizing: border-box;">
    
    <div style="text-align: center; margin-top: 20px;">
        <div style="font-size: 14px; letter-spacing: 4px; color: #888; text-transform: uppercase; margin-bottom: 5px;">Bugünkü Modum</div>
        <div style="font-size: 32px; font-weight: 800; color: #2d3436; display: flex; align-items: center; justify-content: center; gap: 10px;">
            <span style="background: #2d3436; color: white; padding: 0 10px; border-radius: 8px;">SANAL</span> MANKEN
        </div>
    </div>

    <div id="outfit-stage" style="flex: 1; width: 100%; margin: 30px 0; background: white; border-radius: 30px; box-shadow: 0 20px 60px rgba(0,0,0,0.08); border: 1px solid rgba(0,0,0,0.03); display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; padding: 20px; overflow: hidden;">
        
        <div style="position: absolute; width: 350px; height: 350px; background: radial-gradient(circle, rgba(140, 139, 251, 0.2) 0%, transparent 70%); border-radius: 50%; z-index: 0; filter: blur(20px);"></div>

        <img id="story-img-ust" src="" style="max-width: 90%; max-height: 42%; width: auto; object-fit: contain; filter: drop-shadow(0 10px 20px rgba(0,0,0,0.15)); z-index: 2; margin-bottom: -10px;">
        
        <img id="story-img-alt" src="" style="max-width: 90%; max-height: 42%; width: auto; object-fit: contain; filter: drop-shadow(0 10px 20px rgba(0,0,0,0.15)); z-index: 1;">
        
        <div id="story-shoe-box" style="position: absolute; bottom: 20px; right: 20px; width: 100px; height: 100px; background: #fff; border-radius: 20px; display: flex; align-items: center; justify-content: center; box-shadow: 0 10px 25px rgba(0,0,0,0.1); transform: rotate(-8deg); z-index: 3; border: 1px solid #eee;">
            <img id="story-img-shoe" src="" style="max-width: 90%; max-height: 90%; object-fit: contain;">
        </div>

    </div>

    <div style="width: 100%; display: flex; justify-content: space-between; align-items: center; padding: 0 10px;">
        <div style="display: flex; align-items: center; gap: 15px;">
            <div style="width: 60px; height: 60px; border-radius: 50%; border: 3px solid white; box-shadow: 0 5px 15px rgba(0,0,0,0.1); overflow: hidden;">
                <img id="story-user-avatar" src="" style="width: 100%; height: 100%; object-fit: cover;">
            </div>
            <div>
                <div style="font-size: 18px; font-weight: 800; color: #2d3436;" id="story-username">@kullanici</div>
                <div style="font-size: 12px; color: #aaa; font-weight: 500;">Benim Tarzım, Benim Kurallarım</div>
            </div>
        </div>
        
        <div style="text-align: right;">
            <div style="font-size: 24px; color: #2d3436;"><i class='bx bxs-camera'></i></div>
        </div>
    </div>

</div>

<div class="modal-overlay" id="laundryModal" style="display: none;">
    <div class="modal-card">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
            <h3 style="margin:0; display:flex; align-items:center; gap:10px;">
                <i class='bx bx-water' style="color:#00bcd4;"></i> Kirli Sepeti
            </h3>
            <i class='bx bx-x' style="font-size:28px; cursor:pointer; color:#aaa;" onclick="document.getElementById('laundryModal').style.display='none'"></i>
        </div>

        <p style="font-size:12px; color:#888; margin-bottom:20px;">
            Yıkamak istediklerini seç ve makineye at. 🧺
        </p>
        
        <div id="laundry-list" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; max-height: 50vh; overflow-y: auto; padding: 5px;">
            </div>

        <div id="laundry-actions" style="margin-top:20px; display:none;">
            <button class="magic-btn" onclick="washSelectedClothes()" style="width:100%; background: linear-gradient(135deg, #00bcd4 0%, #2980b9 100%);">
                <i class='bx bx-loader-circle'></i> Seçilenleri Yıka
            </button>
        </div>

        <div id="laundry-empty-msg" style="display:none; text-align:center; padding:30px; color:#ccc;">
            <i class='bx bx-smile' style="font-size:40px;"></i><br>
            Sepet boş! Her şey tertemiz.
        </div>
    </div>
</div>

<div class="modal-overlay" id="affiliateAdminModal">
    <div class="modal-card" style="background: #fff; padding: 0; overflow: hidden;">
        
        <div style="background: #2d3436; padding: 25px 20px; color: white; text-align: left; position: relative;">
            <i class='bx bx-x' style="position: absolute; top: 15px; right: 15px; font-size: 26px; cursor: pointer; opacity: 0.7;" onclick="document.getElementById('affiliateAdminModal').style.display='none'"></i>
            <div style="font-size: 22px; font-weight: 800;">Link Kasası 💰</div>
            <div style="font-size: 12px; opacity: 0.7; margin-top: 5px;">Yapay zekayı yönlendir, kazanmaya başla.</div>
        </div>

        <div style="padding: 25px;">
    
    <input type="hidden" id="editLinkId"> 

    <div class="neon-input-group" style="text-align:left; margin-bottom: 15px;">
        <label style="color:#636e72; font-weight:700; font-size:11px; text-transform:uppercase;">Anahtar Kelimeler</label>
        <div style="position: relative;">
            <i class='bx bx-key' style="position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #b2bec3;"></i>
            <input type="text" id="affKeyword" placeholder="Örn: Ceket, Mont, Kaban" style="width: 100%; padding: 14px 14px 14px 40px; border-radius: 12px; border: 1px solid #dfe6e9; background: #fdfdfd; font-weight: 600; color: #2d3436; outline: none; transition: 0.3s;">
        </div>
        <div style="font-size:10px; color:#aaa; margin-top:5px;">💡 Birden fazla kelime için virgül kullanın.</div>
    </div>

    <div class="neon-input-group" style="text-align:left; margin-bottom: 20px;">
        <label style="color:#636e72; font-weight:700; font-size:11px; text-transform:uppercase;">Affiliate Linki</label>
        <div style="position: relative;">
            <i class='bx bx-link' style="position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #b2bec3;"></i>
            <input type="text" id="affLink" placeholder="https://ty.gl/..." style="width: 100%; padding: 14px 14px 14px 40px; border-radius: 12px; border: 1px solid #dfe6e9; background: #fdfdfd; color: #0984e3; outline: none; transition: 0.3s;">
        </div>
    </div>

    <div style="display:flex; gap:10px;">
        <button class="magic-btn" id="affSaveBtn" onclick="saveAffiliateLink()" style="width:100%; background: #2d3436; box-shadow: 0 5px 15px rgba(45, 52, 54, 0.3);">
            <i class='bx bx-plus-circle'></i> <span id="affBtnText">Linki Sisteme Ekle</span>
        </button>
        
        <button class="magic-btn" id="affCancelBtn" onclick="resetAffiliateForm()" style="width:40%; background: #dfe6e9; color:#636e72; display:none; box-shadow:none;">
            İptal
        </button>
    </div>

    <div style="margin-top: 25px; text-align: left;">
        <div style="font-size: 11px; font-weight: 700; color: #b2bec3; margin-bottom: 10px; text-transform: uppercase;">Son Eklenenler</div>
        <div id="recent-links-list">
            <div style="text-align:center; color:#ccc; font-size:12px;">Yükleniyor...</div>
        </div>
    </div>
</div>
    </div>
</div>

<div class="modal-overlay" id="premiumModal" style="z-index: 100000;">
    <div class="modal-card" style="background: #000; color: #fff; border: 1px solid #333; max-width: 350px; padding: 0; overflow: hidden;">
        
        <i class='bx bx-x' style="position:absolute; top:15px; right:15px; font-size:24px; cursor:pointer; color:#fff; z-index:2;" onclick="closePremium()"></i>

        <div style="height: 150px; background: linear-gradient(135deg, #ffd700 0%, #fdb931 100%); display: flex; align-items: center; justify-content: center; position: relative;">
            <div style="font-size: 80px;">👑</div>
            <div style="position: absolute; bottom: -1px; left: 0; width: 100%; height: 30px; background: #000; border-radius: 50% 50% 0 0 / 100% 100% 0 0; transform: scaleX(1.5);"></div>
        </div>

        <div style="padding: 20px; text-align: center;">
            <h2 style="font-size: 24px; font-weight: 800; background: linear-gradient(to bottom, #eee, #999); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; color: transparent;">PREMIUM'A GEÇ</h2>
            <p style="color: #888; font-size: 12px; margin-bottom: 20px;">Sınırları kaldır ve stilini özgür bırak.</p>

            <div style="text-align: left; margin-bottom: 25px;">
                <div style="display: flex; gap: 10px; margin-bottom: 12px;">
                    <i class='bx bxs-check-circle' style="color: #ffd700; font-size: 20px;"></i>
                    <span style="font-size: 14px;">Sınırsız Dolap Kapasitesi</span>
                </div>
                <div style="display: flex; gap: 10px; margin-bottom: 12px;">
                    <i class='bx bxs-check-circle' style="color: #ffd700; font-size: 20px;"></i>
                    <span style="font-size: 14px;">Sınırsız AI Stilist Hakkı</span>
                </div>
                <div style="display: flex; gap: 10px; margin-bottom: 12px;">
                    <i class='bx bxs-plane-alt' style="color: #ffd700; font-size: 20px;"></i>
                    <span style="font-size: 14px;">Seyahat Modu (Otomatik Valiz)</span>
                </div>
                <div style="display: flex; gap: 10px; margin-bottom: 12px;">
                    <i class='bx bxs-star' style="color: #ffd700; font-size: 20px;"></i>
                    <span style="font-size: 14px;">Profilde VIP Rozeti</span>
                </div>
            </div>

            <div style="background: #111; border-radius: 15px; padding: 15px; border: 1px solid #333; margin-bottom: 20px;">
                <div style="font-size: 12px; color: #888; text-decoration: line-through;">Aylık 59.99 ₺</div>
                <div style="font-size: 28px; font-weight: 800; color: #fff;">29.99 ₺ <span style="font-size: 12px; font-weight: 400;">/ Ay</span></div>
                <div style="font-size: 10px; color: #ffd700; margin-top: 5px;">%50 İNDİRİM (SADECE BUGÜN)</div>
            </div>

            <button id="buyBtn" class="magic-btn" onclick="buyPremium()" style="width: 100%; background: linear-gradient(90deg, #ffd700, #fdb931); color: #000; font-weight: 800; border: none;">
                HEMEN YÜKSELT
            </button>
            <div style="font-size: 10px; color: #555; margin-top: 10px;">İstediğin zaman iptal edebilirsin.</div>
        </div>
    </div>
</div>

<script>
// --- GERİ TUŞU YÖNETİMİ (ANDROID BACK BUTTON FIX) ---
window.addEventListener('load', function() {
    window.history.pushState({page: "home"}, "", "");
});

window.addEventListener('popstate', function(event) {
    let handled = false;

    // 1. Açık Modal varsa kapat
    const modals = document.querySelectorAll('.modal-overlay');
    modals.forEach(m => {
        if(m.style.display === 'flex' || m.style.display === 'block') {
            m.style.display = 'none';
            handled = true;
        }
    });

    // 2. Chat açıksa kapat
    const chatWin = document.getElementById('ai-chat-window');
    if(!handled && chatWin && chatWin.style.display === 'flex') {
        toggleChatWindow();
        handled = true;
    }

    // 3. Dolap Detayı açıksa kapat
    const wardrobeDetail = document.getElementById('wardrobe-detail-view');
    if(!handled && wardrobeDetail && wardrobeDetail.style.display === 'block') {
        closeCategory();
        handled = true;
    }

    // Geçmişi yeniden doldur ki bir sonraki geri tuşu da çalışsın
    if (handled) {
        window.history.pushState({page: "home"}, "", "");
    }
});
</script>

<div class="modal-overlay" id="yeniBildirimKutusu_v4" style="display: none; z-index: 2147483647 !important; background: rgba(0,0,0,0.85); backdrop-filter: blur(4px); align-items: center; justify-content: center; position: fixed; top: 0; left: 0; width: 100%; height: 100%;">
    <div class="modal-card" style="background: #fff; width: 90%; max-width: 400px; border-radius: 20px; overflow: hidden; position: relative; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);">
        
        <div style="background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%); padding: 16px 20px; display: flex; justify-content: space-between; align-items: center; color: white;">
            <h3 style="margin:0; font-size: 16px; font-weight: 600; display:flex; align-items:center; gap:8px;">
                <i class='bx bxs-bell-ring'></i> Bildirimler
            </h3>
            <div onclick="kapatBildirimKutusu()" style="cursor:pointer; background:rgba(255,255,255,0.2); width:28px; height:28px; border-radius:50%; display:flex; align-items:center; justify-content:center; transition:0.2s;">
                <i class='bx bx-x' style="font-size:20px;"></i>
            </div>
        </div>

        <div id="bildirimListesi_v4" class="notif-list" style="max-height: 50vh; overflow-y: auto; padding: 15px; background: #f8fafc; min-height: 150px;">
            </div>
    </div>
</div>

<div class="modal-overlay" id="ziyaretciProfilModal" style="display: none; z-index: 2147483648 !important; background: rgba(0,0,0,0.9); backdrop-filter: blur(5px); align-items: center; justify-content: center; position: fixed; top: 0; left: 0; width: 100%; height: 100%;">
    <div class="modal-card" style="background: #ffffff; width: 85%; max-width: 340px; border-radius: 24px; padding: 0; overflow: hidden; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.4); position: relative;">
        
        <div style="height: 80px; background: linear-gradient(135deg, #a8c0ff 0%, #3f2b96 100%);"></div>

        <div onclick="document.getElementById('ziyaretciProfilModal').style.display='none'" 
             style="position: absolute; top: 15px; right: 15px; width: 30px; height: 30px; background: rgba(255,255,255,0.3); backdrop-filter: blur(4px); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; color: white;">
            <i class='bx bx-x' style="font-size: 24px;"></i>
        </div>

        <div id="ziyaretciIcerik" style="padding: 0 25px 25px 25px; margin-top: -50px; text-align: center;">
            <div style="padding: 40px;">
                <div style="width: 80px; height: 80px; background: #fff; border-radius: 50%; margin: 0 auto; display: flex; align-items: center; justify-content: center;">
                    <i class='bx bx-loader-alt bx-spin' style="font-size: 30px; color: #6c5ce7;"></i>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // --- Bildirim Kutusunu Kapat ---
    function kapatBildirimKutusu() {
        const modal = document.getElementById('yeniBildirimKutusu_v4');
        if(modal) modal.style.display = 'none';
    }

    // --- Başkasının Profilini Getir (FİNAL) ---
    async function profilZiyaretEt(hedefKullanici) {
        console.log("Ziyaret ediliyor: " + hedefKullanici);
        
        // Önce bildirim kutusunu kapat
        kapatBildirimKutusu();

        // Modalı Bul
        const modal = document.getElementById('ziyaretciProfilModal');
        const icerik = document.getElementById('ziyaretciIcerik');
        
        if(!modal) return;
        
        // Modalı Aç
        modal.style.setProperty('display', 'flex', 'important');

        // Yükleniyor Animasyonu
        icerik.innerHTML = `
            <div style="width: 100px; height: 100px; background: #fff; border-radius: 50%; margin: 0 auto 10px auto; display: flex; align-items: center; justify-content: center; border: 4px solid #fff;">
                <i class='bx bx-loader-alt bx-spin' style="font-size: 35px; color: #6c5ce7;"></i>
            </div>
            <p style="color:#666; font-size:13px;">@${hedefKullanici} bilgileri yükleniyor...</p>
        `;

        try {
            // Backend'den veriyi çek (main.py'ye eklediğimiz endpoint)
            const res = await fetch(`/user/public_profile/${hedefKullanici}`);
            const data = await res.json();

            if (data.status === "error") {
                icerik.innerHTML = `<p style="color:red; padding-top:50px;">Kullanıcı bulunamadı!</p>`;
                return;
            }

            // Profil resmi kontrolü
            let avatarUrl = data.profile_pic ? `/static/uploads/${data.profile_pic}` : "https://cdn-icons-png.flaticon.com/512/847/847969.png";
            
            // HTML Doldurma
            icerik.innerHTML = `
                <div style="width: 100px; height: 100px; border-radius: 50%; overflow: hidden; margin: 0 auto 10px auto; border: 4px solid #fff; box-shadow: 0 4px 15px rgba(0,0,0,0.1); background:#fff;">
                    <img src="${avatarUrl}" style="width: 100%; height: 100%; object-fit: cover;">
                </div>
                
                <h3 style="margin: 0; font-size: 18px; color: #2d3436; display:flex; align-items:center; justify-content:center; gap:5px; font-weight:700;">
                    @${data.username}
                    ${data.is_premium ? "<i class='bx bxs-badge-check' style='color:#3498db; font-size:18px;' title='Onaylı Üye'></i>" : ""}
                </h3>
                
                <p style="color: #636e72; font-size: 13px; margin: 8px 0 20px 0; line-height: 1.4; padding:0 5px;">
                    ${data.bio}
                </p>

                <div style="display: flex; justify-content: center; gap:25px; margin-bottom: 25px; background: #f8f9fa; padding: 10px; border-radius: 12px;">
                    <div style="text-align:center;">
                        <div style="font-weight: 700; font-size: 16px; color: #2d3436;">${data.followers}</div>
                        <div style="font-size: 11px; color: #b2bec3; font-weight:500;">Takipçi</div>
                    </div>
                    <div style="width:1px; height:30px; background:#dfe6e9;"></div>
                    <div style="text-align:center;">
                        <div style="font-weight: 700; font-size: 16px; color: #2d3436;">${data.following}</div>
                        <div style="font-size: 11px; color: #b2bec3; font-weight:500;">Takip</div>
                    </div>
                </div>

                <button onclick="alert('Takip etme özelliği çok yakında!')" 
                        style="width: 100%; background: #2d3436; color: white; border: none; padding: 14px; border-radius: 16px; font-weight: 600; cursor: pointer; transition: transform 0.1s; box-shadow: 0 4px 12px rgba(45, 52, 54, 0.2);">
                    Takip Et
                </button>
            `;

        } catch (e) {
            console.error(e);
            icerik.innerHTML = `<p style="color:red; padding-top:50px;">Bağlantı hatası!</p>`;
        }
    }

    // --- Bildirim Sistemini Başlat ---
    async function bildirimSisteminiBaslat() {
        console.log("🔔 Bildirim sistemi başlatılıyor...");
        
        const modal = document.getElementById('yeniBildirimKutusu_v4');
        const container = document.getElementById('bildirimListesi_v4');

        if (!modal) { alert("HATA: Bildirim kutusu eksik!"); return; }

        modal.style.setProperty('display', 'flex', 'important');

        // Yükleniyor...
        container.innerHTML = `
            <div style="display:flex; flex-direction:column; align-items:center; justify-content:center; padding:40px; color:#64748b;">
                <i class='bx bx-loader-alt bx-spin' style="font-size:32px; color:#6366f1; margin-bottom:10px;"></i>
                <span style="font-size:13px; font-weight:500;">Yükleniyor...</span>
            </div>`;

        try {
            const username = localStorage.getItem("userName");
            if (!username) {
                container.innerHTML = `<div style="text-align:center; padding:20px; color:red;">Giriş yapmalısın.</div>`;
                return;
            }

            const response = await fetch(`/notifications/${username}?t=${Date.now()}`);
            const data = await response.json();
            container.innerHTML = ""; 

            if (!data || data.length === 0) {
                container.innerHTML = `<div style="text-align:center; padding:40px; color:#999;">Henüz bildirim yok.</div>`;
                return;
            }

            // Listeyi Doldur
            data.forEach(item => {
                const itemDiv = document.createElement('div');
                
                // İkonlar
                let icon = `<div style="min-width:40px; height:40px; border-radius:12px; background:#e2e8f0; display:flex; align-items:center; justify-content:center; color:#64748b;"><i class='bx bx-bell'></i></div>`;
                if (item.type === 'like') icon = `<div style="min-width:40px; height:40px; border-radius:12px; background:#ffe4e6; color:#f43f5e; display:flex; align-items:center; justify-content:center;"><i class='bx bxs-heart'></i></div>`;
                else if (item.type === 'follow') icon = `<div style="min-width:40px; height:40px; border-radius:12px; background:#e0e7ff; color:#4f46e5; display:flex; align-items:center; justify-content:center;"><i class='bx bxs-user-plus'></i></div>`;

                // Link Oluşturma
                let formatliMesaj = item.message;
                const gonderen = item.user_from;

                if (gonderen) {
                    const linkHTML = `<span onclick="profilZiyaretEt('${gonderen}')" style="color:#4f46e5; font-weight:700; cursor:pointer;">@${gonderen}</span>`;
                    formatliMesaj = formatliMesaj.replace(`@${gonderen}`, linkHTML);
                }

                itemDiv.innerHTML = `
                    <div style="display:flex; align-items:center; gap:12px; padding:12px; background:#fff; border:1px solid #f1f5f9; border-radius:12px; margin-bottom:8px;">
                        ${icon}
                        <div style="flex:1;">
                            <div style="font-size:13px; color:#1e293b; font-weight:500;">${formatliMesaj}</div>
                            <div style="font-size:10px; color:#94a3b8;">Az önce</div>
                        </div>
                    </div>`;
                
                container.appendChild(itemDiv);
            });

        } catch (e) {
            console.error(e);
            container.innerHTML = `<div style="text-align:center; color:red;">Hata oluştu!</div>`;
        }
    }
</script>

</body>
</html>


